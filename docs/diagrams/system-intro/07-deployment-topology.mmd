flowchart LR
  subgraph Clients["访问方"]
    UserUI["用户侧前端(生产)"]
    DebugUI["调试前端(开发)"]
    AdminUI["管理端调试 UI"]
    ApiClient["API/SDK 调用方"]
  end

  subgraph Runtime["运行服务"]
    Nginx["前端静态服务<br/>wunder_nginx"]
    FrontendDev["前端开发服务<br/>wunder_frontend"]
    RustAPI["核心服务/网关<br/>wunder_server"]
    Sandbox["沙盒<br/>sandbox"]
    MCP["MCP 服务<br/>wunder_mcp"]
    PG[("数据库<br/>postgres")]
    VectorDB["向量数据库<br/>Weaviate"]
  end

  subgraph RightSide[" "]
    direction TB
    subgraph External["外部依赖"]
      LLM["大模型 API"]
      ExtDB["业务数据库"]
      KB["RAG 知识库/外部工具"]
    end
    subgraph Mounts["挂载目录"]
      WS[("Workspaces 卷")]
    end
  end

  UserUI -->|静态资源| Nginx
  DebugUI -->|静态资源| FrontendDev

  UserUI -->|HTTP/WS| RustAPI
  DebugUI -->|HTTP/WS| RustAPI
  AdminUI -->|HTTP/WS| RustAPI
  ApiClient -->|HTTP/WS| RustAPI

  RustAPI --> PG
  RustAPI --> WS
  RustAPI --> LLM
  RustAPI --> VectorDB
  RustAPI --> Sandbox
  RustAPI --> MCP

  MCP --> ExtDB
  MCP --> KB

  classDef client fill:#eef6ff,stroke:#5b8ff9,stroke-width:1.2px,color:#1d39c4;
  classDef runtime fill:#fff7e6,stroke:#fa8c16,stroke-width:1.2px,color:#873800;
  classDef external fill:#f6ffed,stroke:#73d13d,stroke-width:1.2px,color:#135200;
  classDef volume fill:#f5f5f5,stroke:#bfbfbf,stroke-width:1.2px,color:#434343;

  class UserUI,DebugUI,AdminUI,ApiClient client;
  class Nginx,FrontendDev,RustAPI,Sandbox,MCP,PG,VectorDB runtime;
  class LLM,ExtDB,KB external;
  class WS volume;

  style Clients fill:#f0f5ff,stroke:#adc6ff,stroke-width:1px,color:#1f1f1f;
  style Runtime fill:#fff7e6,stroke:#ffd591,stroke-width:1px,color:#1f1f1f;
  style External fill:#f6ffed,stroke:#b7eb8f,stroke-width:1px,color:#1f1f1f;
  style Mounts fill:#ffffff,stroke:#d9d9d9,stroke-width:1px,color:#1f1f1f;
  style RightSide fill:transparent,stroke:transparent,color:transparent;
