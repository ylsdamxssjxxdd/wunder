flowchart LR
  subgraph Clients["访问方"]
    UserUI["用户前端"]
    AdminUI["管理前端"]
    ApiClient["API/SDK 调用方"]
  end

  subgraph Runtime["运行服务"]
    Nginx["前端<br/>wunder_nginx"]
    RustAPI["核心<br/>wunder_rust"]
    Sandbox["沙盒<br/>sandbox"]
    MCP["MCP服务<br/>wunder-mcp"]
    PG[(数据库<br/>postgres)]
  end

  subgraph RightSide[" "]
    direction TB
    subgraph External["外部依赖"]
      LLM["大模型 API"]
      ExtDB["业务数据库"]
      KB["RAG知识库"]
    end
    subgraph Mounts["挂载目录"]
      WS[(Workspaces 卷)]
    end
  end

  UserUI -->|静态资源| Nginx
  UserUI -->|HTTP/SSE| RustAPI
  AdminUI -->|静态资源 + API| RustAPI
  ApiClient -->|HTTP/SSE| RustAPI

  RustAPI --> PG
  RustAPI --> WS
  RustAPI --> LLM
  RustAPI --> Sandbox
  RustAPI --> MCP

  MCP --> ExtDB
  MCP --> KB

  classDef client fill:#eef6ff,stroke:#5b8ff9,stroke-width:1.2px,color:#1d39c4;
  classDef runtime fill:#fff7e6,stroke:#fa8c16,stroke-width:1.2px,color:#873800;
  classDef external fill:#f6ffed,stroke:#73d13d,stroke-width:1.2px,color:#135200;
  classDef volume fill:#f5f5f5,stroke:#bfbfbf,stroke-width:1.2px,color:#434343;

  class UserUI,AdminUI,ApiClient client;
  class Nginx,RustAPI,Sandbox,MCP,PG runtime;
  class LLM,ExtDB,KB external;
  class WS volume;

  style Clients fill:#f0f5ff,stroke:#adc6ff,stroke-width:1px,color:#1f1f1f;
  style Runtime fill:#fff7e6,stroke:#ffd591,stroke-width:1px,color:#1f1f1f;
  style External fill:#f6ffed,stroke:#b7eb8f,stroke-width:1px,color:#1f1f1f;
  style Mounts fill:#ffffff,stroke:#d9d9d9,stroke-width:1px,color:#1f1f1f;
  style RightSide fill:transparent,stroke:transparent,color:transparent;
