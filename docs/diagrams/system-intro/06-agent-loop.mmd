flowchart LR
  User["用户输入(user_round)"] --> Context["上下文构建<br/>(历史/工具/记忆)"]
  Context --> LLM["模型调用(model_round)"]
  LLM --> Decide{输出类型}
  Decide -- "工具调用" --> ToolPlan["解析工具意图"]
  ToolPlan --> ToolExec["执行工具/沙盒"]
  ToolExec --> Observe["结果回填<br/>事件记录"]
  Observe --> LLM
  Decide -- "最终回复" --> Final["最终回复<br/>释放会话锁"]
