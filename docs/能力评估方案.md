# wunder 鑳藉姏璇勪及鏂规锛堜粎鑳藉姏缁村害锛?
## 1. 鐩爣涓庤寖鍥?
- 鐩爣锛氭瀯寤衡€滆兘鍔涜瘎浼扳€濋〉闈笌鍚庣璇勪及鑳藉姏锛岀敤缁撴瀯鍖栫敤渚嬮獙璇佹櫤鑳戒綋鍦ㄥ伐鍏疯皟鐢ㄣ€侀€昏緫鎺ㄧ悊銆佸父璇嗛棶绛斻€佸鏉備换鍔″洓绫昏兘鍔涗笂鐨勮〃鐜帮紝骞舵敮鎸佹寔涔呭寲銆佸巻鍙插洖婧笌鎶ュ憡瀵煎嚭銆?- 鑼冨洿锛氬彧鍋氳兘鍔涚淮搴﹁瘎浼帮紝涓嶇撼鍏?TTFB/鐢熸垚閫熷害绛夋€ц兘鎸囨爣锛涜瘎浼扮粨鏋滀互鍙垽瀹氳鍒欎负鍑嗭紝閬垮厤涓昏璇勫垎銆?- 鍘熷垯锛氱敤渚嬪彲閲嶅銆佽瘎鍒嗗彲瑙ｉ噴銆佸伐鍏疯鐩栧敖閲忓叏銆佺粨鏋滃彲杩芥函銆?
## 2. 璇勪及缁村害涓庤瘎鍒嗗彛寰?
### 2.1 宸ュ叿璋冪敤锛堟潈閲嶅彲閰嶇疆锛?- 鐩殑锛氶獙璇佹ā鍨嬫槸鍚﹁兘鍦ㄧ粰瀹氫换鍔′腑姝ｇ‘閫夋嫨宸ュ叿锛屽苟杈撳嚭鍚堣鐨?`<tool_call>` JSON銆?- 璇勫垎锛氭寜鐢ㄤ緥璁＄畻锛?/1 鎴?0/0.5/1锛夛紱婊¤冻鈥滃懡涓伐鍏?+ 鍩烘湰鍙傛暟婊¤冻 + 杈撳嚭鏍煎紡鍚堣鈥濊鍒嗐€?- 鍒ゅ畾渚濇嵁锛歋SE 鐨?`tool_call` 浜嬩欢 + `<tool_call>` 杈撳嚭瑙ｆ瀽锛涘伐鍏峰悕闇€閫氳繃鍒悕鏄犲皠缁熶竴涓?canonical锛堝弬鑰?`resolve_tool_name`锛夈€?
### 2.2 閫昏緫鎺ㄧ悊
- 鐩殑锛氶獙璇侀€昏緫鎺ㄦ柇涓庤鍒欐帹鐞嗚兘鍔涖€?- 璇勫垎锛氬崟閫夐锛圓-D锛夋垨绠€绛旈锛涙寜瑙勫垯绮剧‘鍖归厤鎴栨鍒欏尮閰嶃€?- 鍒ゅ畾渚濇嵁锛氭渶缁堣緭鍑烘枃鏈紙鍓ョ tool_call 涓庢棤鍏冲墠缂€锛夈€?
### 2.3 甯歌瘑闂瓟
- 鐩殑锛氶獙璇佸熀纭€甯歌瘑姝ｇ‘鎬т笌绋冲畾鎬с€?- 璇勫垎锛氬崟閫夐鎴栫煭绛旀锛涙寜 exact/choice/regex/contains 瑙勫垯鍒ゅ畾銆?
### 2.4 澶嶆潅浠诲姟
- 鐩殑锛氶獙璇佸姝ユ搷浣滀笌宸ュ叿閾剧粍鍚堣兘鍔涖€?- 璇勫垎锛氫互鈥滃彲楠岃瘉浜х墿鈥濆垽瀹氾紙鏂囦欢瀛樺湪銆佸唴瀹瑰尮閰嶃€佺洰褰曠粨鏋勩€丣SON schema 绛夛級銆?- 鍒ゅ畾渚濇嵁锛氳瘎浼拌繍琛屾椂宸ヤ綔鍖轰笌鎺ュ彛杩斿洖浜х墿锛堥伩鍏嶄富瑙傛墦鍒嗭級銆?
### 2.5 鎬诲垎璁＄畻
- 姣忎釜缁村害鎸夌敤渚嬪姞鏉冨钩鍧囷紝缁村害鏉冮噸鍙厤缃紙榛樿寤鸿锛氬伐鍏?35%銆侀€昏緫 25%銆佸父璇?20%銆佸鏉?20%锛夈€?- 瀵逛笉鍙敤/鏈厤缃殑鐢ㄤ緥锛堝缂哄け MCP 鎴栨妧鑳斤級鏍囪涓?`skipped`锛屼笉璁″叆鍒嗘瘝锛屼絾鍦ㄦ姤鍛婁腑鏄惧紡灞曠ず銆?
## 3. 鐢ㄤ緥浣撶郴涓庤鍒?
### 3.1 鐢ㄤ緥瀛樺偍
- 璺緞寤鸿锛歚data/evaluation/cases/*.json`锛堟寜缁村害鎴栬瑷€鎷嗗垎锛夛紱鏀寔鐗堟湰鍙蜂笌鏍囩銆?- 鐢ㄤ緥瀛楁寤鸿锛?  - `id`锛氬敮涓€鏍囪瘑
  - `dimension`锛歵ool/logic/common/complex
  - `language`锛歾h-CN/en-US
  - `prompt`锛氱敤鎴烽棶棰?  - `weight`锛氳棰樻潈閲?  - `timeout_s`锛氬崟棰樿秴鏃?  - `checker`锛氬垽瀹氳鍒欙紙choice/exact/regex/contains/tool_called/tool_args/file_exists/file_contains/json_schema锛?  - `expected`锛氭湡鏈涚瓟妗堟垨鏈熸湜宸ュ叿鍚?鍙傛暟
  - `prerequisites`锛氭墍闇€宸ュ叿鎴栬兘鍔涳紙宸ュ叿鍚嶅垪琛級
  - `tags`锛氬垎绫绘爣绛撅紙濡?builtin/mcp/skill/knowledge/user/shared锛?
### 3.2 宸ュ叿瑕嗙洊绛栫暐锛堝敖閲忚鐩栵級
- 鍐呯疆宸ュ叿锛歳ead/write/edit/replace/search/list/execute_command/ptc/鏈€缁堝洖澶嶃€?- MCP锛氫紭鍏堣鐩栧凡鍚敤鐨?server@tool锛涜嫢鏃?MCP 鏈嶅姟鍒欒嚜鍔ㄨ烦杩囪瀛愰泦銆?- Skills锛氳嚦灏戣鐩?1-2 涓凡鍚敤鎶€鑳斤紱鑻ユ棤鎶€鑳藉垯璺宠繃銆?- 鐭ヨ瘑搴擄細瑕嗙洊绯荤粺鐭ヨ瘑搴撲笌鐢ㄦ埛鐭ヨ瘑搴擄紙瀛樺湪鍗崇敤锛夈€?- 鑷缓/鍏变韩宸ュ叿锛氳嫢瀛樺湪鍒欏姞鍏ヨ瘎浼扮敤渚嬶紝纭繚浠庡伐鍏锋竻鍗曞揩鐓т腑鍙彂鐜般€?- 鍒ゅ畾缁熶竴浣跨敤 canonical 宸ュ叿鍚嶏紝閬垮厤涓嫳鏂囧埆鍚嶅樊寮傚鑷磋鍒ゃ€?
### 3.3 澶嶆潅浠诲姟鐢ㄤ緥璁捐
- 浠モ€滄湁浜х墿 + 鍙獙璇佲€濅负鍘熷垯锛屼緥濡傦細
  - 鍐欏叆宸ヤ綔鍖哄浐瀹氳矾寰勬枃浠讹紝楠岃瘉鏂囦欢瀛樺湪涓庡唴瀹圭墖娈点€?  - 鐢熸垚 JSON 鏂囦欢骞堕€氳繃 schema 楠岃瘉瀛楁銆?  - 澶氭浠诲姟锛氭悳绱?鈫?璇诲彇 鈫?鏇挎崲 鈫?鍐欏洖锛岄獙璇佸墠鍚庡樊寮傘€?- 杩愯鏃堕殧绂伙細姣忔璇勪及杩愯鍦?`eval/<run_id>` 瀛愮洰褰曪紝閬垮厤姹℃煋鐪熷疄鐢ㄦ埛宸ヤ綔鍖恒€?
## 4. 鎵ц娴佺▼锛堝悗绔級

1. 鍒涘缓璇勪及杩愯锛坮un锛夛細鐢熸垚 `run_id`銆佸揩鐓у綋鍓嶉厤缃紙妯″瀷銆佸伐鍏锋竻鍗曘€佽瑷€銆乧onfig_overrides锛夈€?2. 閫夋嫨鐢ㄤ緥闆嗗悎锛氭寜缁村害/璇█/鍙敤宸ュ叿杩囨护锛岃绠楀疄闄呯敤渚嬪垪琛ㄤ笌鎬绘潈閲嶃€?3. 閫愭潯鎵ц锛?   - 涓烘瘡棰樺垱寤虹嫭绔?`session_id`锛屾瀯閫?`/wunder` 璇锋眰骞跺惎鐢?SSE銆?   - 鐩戝惉 `tool_call`/`tool_result`/`llm_output`/`final` 浜嬩欢锛屾敹闆嗚緭鍑轰笌宸ュ叿璋冪敤杞ㄨ抗銆?   - 杩愯 checker 鍒ゅ畾锛屼骇鍑?`score`銆乣status` 涓?`detail`銆?4. 姹囨€昏瘎鍒嗭細鎸夌淮搴?鏉冮噸鐢熸垚鎬诲垎涓庢憳瑕併€?5. 鎸佷箙鍖栵細鍐欏叆 run/item 璁板綍锛屾敮鎸佸巻鍙插洖婧€?6. 杩愯缁堟锛氭敮鎸?cancel锛坮un 绾у埆锛夛紝鍙栨秷鍚庢爣璁?`cancelled` 骞朵繚鐣欏凡瀹屾垚缁撴灉銆?
## 5. 鎸佷箙鍖栬璁?
### 5.1 琛ㄧ粨鏋勫缓璁?- `evaluation_runs`
  - `run_id`銆乣user_id`銆乣model_name`銆乣language`銆乣status`
  - `case_set`銆乣config_snapshot`銆乣tool_snapshot`
  - `dimension_scores`锛圝SON锛夈€乣total_score`
  - `started_at`銆乣finished_at`銆乣elapsed_s`銆乣error`
- `evaluation_items`
  - `run_id`銆乣case_id`銆乣dimension`銆乣status`
  - `score`銆乣max_score`銆乣weight`
  - `prompt`銆乣final_answer`銆乣tool_calls`銆乣checker_detail`
  - `started_at`銆乣finished_at`銆乣elapsed_s`銆乣error`
- 鍙€夛細`evaluation_case_sets`锛堟寔涔呭寲鐢ㄤ緥鐗堟湰蹇収锛屼究浜庤拷婧級

### 5.2 StorageBackend 鎵╁睍
- 鏂板缁熶竴鎺ュ彛锛歚create_eval_run`銆乣update_eval_run`銆乣append_eval_item`銆乣list_eval_runs`銆乣get_eval_run_detail`?`delete_eval_run`銆乣`銆?- SQLite/Postgres 鍚屾瀹炵幇锛岃〃鍒濆鍖栭殢 `ensure_initialized` 瀹屾垚銆?
## 6. API 璁捐锛堢鐞嗗憳锛?
- `POST /wunder/admin/evaluation/start`
  - 鍏ュ弬锛歚user_id`銆乣model_name`銆乣language`銆乣case_set`銆乣dimensions`銆乣tool_names`銆乣config_overrides`銆乣stream`
  - 杩斿洖锛歚run_id`銆乣status`銆乣selected_cases`
- `POST /wunder/admin/evaluation/{run_id}/cancel`
  - 鍙栨秷璇勪及杩愯
- `GET /wunder/admin/evaluation/runs`
  - 鏀寔杩囨护锛歚user_id`銆乣model_name`銆乣status`銆乣time_range`
- `GET /wunder/admin/evaluation/{run_id}`
  - 杩愯璇︽儏 + items 鍒楄〃
- `DELETE /wunder/admin/evaluation/{run_id}`
  - 删除历史评估记录
- 杩斿洖鍘嗗彶璇勪及鏄庣粏
- `GET /wunder/admin/evaluation/stream/{run_id}`锛圫SE锛?  - 浜嬩欢寤鸿锛歚eval_progress`銆乣eval_item`銆乣eval_log`銆乣eval_finished`

## 7. 鍓嶇椤甸潰璁捐

- 鏇挎崲璇勪及鍗犱綅椤碉細
  - 杩愯鍙傛暟鍖猴細user_id銆佹ā鍨嬨€佽瑷€銆佺敤渚嬮泦銆佺淮搴︺€佸伐鍏疯鐩栧紑鍏?  - 杩愯鎺у埗锛歋tart/Stop銆佽繘搴︽潯銆佸綋鍓嶇敤渚嬬姸鎬?  - 璇勫垎闈㈡澘锛氱淮搴﹀垎鏁?+ 鎬诲垎锛涙敮鎸佹煴鐘跺浘/闆疯揪鍥?  - 鏃ュ織鍖猴細閫愰鍒ゅ畾杈撳嚭锛堝伐鍏疯皟鐢ㄣ€佹渶缁堢瓟妗堛€佸垽瀹氱粨鏋滐級
- 鍘嗗彶鍖猴細璇勪及璁板綍鍒楄〃锛屾敮鎸佹煡鐪嬪巻鍙茶褰曡鎯?- 澶嶇敤璋冭瘯闈㈡澘 SSE 瑙ｆ瀽涓庝簨浠跺睍绀洪€昏緫锛岄伩鍏嶉噸澶嶅疄鐜般€?
## 8. 瀹炴柦鑺傜偣锛堟寜闃舵钀藉湴锛?
### 鑺傜偣 1锛氱敤渚嬩笌鎸佷箙鍖栭鏋?- 杈撳嚭锛氱敤渚嬬粨鏋勪笌绀轰緥闆嗐€佽瘎浼版暟鎹洰褰曘€丼torageBackend 鎵╁睍涓庤〃缁撴瀯钀藉湴銆?- 楠屾敹锛氳兘鍒涘缓 run 骞舵寔涔呭寲绌虹粨鏋滐紱鐢ㄤ緥鍙璇诲彇骞惰繃婊ゃ€?
### 鑺傜偣 2锛氳瘎浼版墽琛屽櫒涓庡垽瀹氬櫒
- 杈撳嚭锛氳瘎浼拌繍琛屽櫒锛堥€愰鎵ц + 鍒ゅ畾 + 璇勫垎锛夛紝SSE 杩涘害浜嬩欢銆?- 楠屾敹锛氬悗绔彲瀹屾暣璺戦€氫竴缁勭敤渚嬪苟鐢熸垚缁村害鍒嗘暟涓庢€诲垎銆?
### 鑺傜偣 3锛氱鐞?API + 鍓嶇椤甸潰
- 杈撳嚭锛氳瘎浼?API锛坰tart/cancel/list/detail锛夈€佸墠绔瘎浼伴〉闈笌鍘嗗彶鏌ョ湅銆?- 楠屾敹锛氭祻瑙堝櫒鍙彂璧疯瘎浼般€佸疄鏃剁湅鍒拌繘搴︿笌缁撴灉銆佹敮鎸佸巻鍙插洖婧€?
### 鑺傜偣 4锛氱敤渚嬭鐩栦笌绋冲畾鎬?- 杈撳嚭锛氬伐鍏疯鐩栫敤渚嬭ˉ榻愶紙鍐呯疆/MCP/鎶€鑳?鐭ヨ瘑搴?鑷缓/鍏变韩锛夛紝澶嶆潅浠诲姟鐢ㄤ緥瀹屽杽銆?- 楠屾敹锛氳鐩栫巼缁熻鍙锛岃瘎浼扮粨鏋滅ǔ瀹氬彲澶嶇幇锛屽紓甯?瓒呮椂鍙洖鏀躲€?
## 9. 椋庨櫓涓庣害鏉?
- 宸ュ叿缂哄け鎴栨湭鍚敤浼氬鑷寸敤渚嬭烦杩囷紝闇€鍦ㄧ粨鏋滈噷鏄庣‘ `skipped` 鍘熷洜銆?- 澶嶆潅浠诲姟娑夊強宸ヤ綔鍖哄啓鍏ワ紝蹇呴』闅旂鐩綍骞舵彁渚涜嚜鍔ㄦ竻鐞嗙瓥鐣ャ€?- 璇勪及杩囩▼鑰楁椂杈冮暱锛岄渶闄愬埗骞跺彂涓庤秴鏃讹紝闃叉褰卞搷绾夸笂鏈嶅姟銆?

