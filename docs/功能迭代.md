# 功能迭代

<!-- changelog:start -->
## 2026-01-28
### 新增
- [frontend][backend][docs] 新增共享智能体能力：支持共享标记与共享列表接口，同等级可见，并在功能广场新增共享智能体区域与共享开关
- [mcp_server] 新增知识库检索 MCP 工具 kb_query 并接入 RAGFlow 配置
### 变更
- [frontend] 智能体应用支持头像图标/颜色选择，通用聊天头像改为纯图标
- [frontend] 功能广场移除智能体空态提示，调整共享区域间距并为智能体卡片添加头像与质感样式
- [frontend] 功能广场搜索框移至标题栏中部并将智能体卡片编辑/删除改为图标按钮
- [frontend][backend][api] 智能体会话支持按智能体恢复上次会话，并在问询面板等待时保留提示与广场状态展示
- [frontend] 优化功能广场顶部栏搜索位置与智能体卡片操作交互，调整工具管理布局留足自建工具空间
- [frontend] 补充广场智能体卡片操作按钮悬停反馈并提升浅色主题删除按钮可读性
- [mcp_server] 精简 kb_query 描述，移除数据集ID显示
- [mcp_server] 配置 kb_query 连接到 RAGFlow 知识库并完成连通性验证
- [frontend] 修复智能体会话新建跳回通用聊天的问题，并按智能体隔离历史记录与草稿会话
- [frontend] 对齐用户侧今日额度与管理员口径，并加粗概况页额度环图
- [frontend] 概况页额度环改为 ECharts 环图以对齐管理员侧线程状态展示
- [frontend] 概况页额度环样式调整为更接近管理员侧线程状态环图
- [frontend] 调整功能广场搜索框从标题区移出并优化顶部栏布局
- [frontend] 调整聊天页顶部布局与按钮排序，收紧功能广场搜索位置，并优化概况页额度环样式与导航入口展示
- [frontend] 工具管理将共享工具并入自建工具分类并压缩左栏宽度，功能广场标题栏移除新建与聊天入口，聊天工具调整面板移除搜索/禁用开关并优化暗色按钮样式
- [frontend] 对齐用户侧标题栏样式与布局，聊天页补回广场入口并将工具调整改为图标按钮，智能体创建工具分组支持全选/取消，问候语采用智能体描述

### 修复
- [frontend][backend][api] 通用聊天卡片联动运行中/待选择状态展示
- [frontend][backend][tools] 问询面板待选择状态默认保持开启并确保工具事件/历史记录携带面板信息
- [frontend] 修复智能体聊天保持 agent_id 避免新建会话跳回通用，并对齐今日额度展示与环图表现
- [docs] 修复架构设计图 Mermaid 语法以避免解析错误
### 文档
- [docs] 新增数据库设计字段级ER图
- [docs] 补充数据库设计图示
- [docs] 补充数据库设计逻辑关系图
- [docs] 新增 wunder 视频介绍 PPT 初稿
- [docs] 新增数据库设计文档
- [docs] 新增 wunder 视频介绍脚本
- [docs] 更新 API 文档、系统介绍与智能体拓展方案的 agent_id 工作区与运行中智能体说明
- [mcp_server] README 补充数据库描述建议以提升表选择准确性
- [web][docs] 论文部署拓扑改为引用图片并补充对应图文件
- [web][docs] 补充论文架构设计章节并追加部署拓扑图
- [docs] 重构部署拓扑布局，保持外部依赖置顶并与运行服务对齐
- [docs] 调整部署拓扑为上下分区布局以对齐挂载目录与运行服务
- [docs] 调整部署拓扑运行服务命名，并将 Workspaces 卷移到外部依赖下方
- [docs] 回退部署拓扑布局为上一版
- [docs] 简化部署拓扑节点命名并优化分组布局
- [docs] 调整部署拓扑运行服务与外部依赖配色，突出 Rust 区域
- [docs] 调整部署拓扑分组标题颜色以提升可读性
- [docs] 美化部署拓扑图样式，区分内部服务与外部依赖
- [docs] 新增架构设计文档，补充部署拓扑与组件说明
- [docs] 补充 UserProfile 额度字段说明，并更新智能体拓展方案的等级与工具描述
## 2026-01-27
### 新增
- [mcp] 新增 mcp_server MCP 配置文件并支持 MCP_CONFIG_PATH
- [eva_skills][人员成长路径规划] 新增人员成长路径规划技能，补充分析流程与图表生成脚本
- [docker][mcp] 新增 wunder-mcp 服务与 mcp_server MCP 示例脚本
- [scripts] 新增人员数据库 FastMCP 示例脚本
- [eva_skills][电子表格处理] 生成电子表格技能评估样例（temp_dir/spreadsheet_skill_review.xlsx）
- [PPTX生成][eva_skills] 生成环保主题PPTX示例（含图表）用于技能评估
- [eva_skills][电子表格处理] 生成电子表格处理示例报表与图表（temp_dir/spreadsheet_analysis_demo.xlsx）
### 变更
- [frontend] 功能广场恢复通用聊天卡片并移除欢迎文案，工具管理页面去掉介绍标题并让自建工具区撑满高度
- [web][docs] 管理端移除附加提示词输入与接口文档说明
- [frontend][backend][config] 清理智能体广场页面入口与路由，移除用户额外提示词接口/存储，i18n 读取支持 BOM 防止乱码
- [mcp_server] 精简 mcp_config.json，移除 mcp 运行配置段
- [frontend][backend][docs] 功能广场聚焦智能体应用入口，工具管理重排并移除额外提示词
- [mcp_server] 数据库配置仅从 mcp_config.json 读取，移除 PERSONNEL_DB_* 环境变量
- [mcp][db] 数据库工具移除 db_key 入参
- [backend][frontend][docs] 智能体广场与工具管理落地，新增会话工具调整与ABC等级覆盖策略
- [mcp][db] 数据库用途说明支持 target_descriptions 补充
- [mcp][db] 数据库工具描述支持从配置文件读取用途说明
- [mcp] 精简 MCP 数据库工具并改为中文输入描述
- [mcp][db] 人员数据库 MCP 支持 MySQL/PostgreSQL 多库配置
- [PPTX生成][eva_skills] PPTX模板中文黑体英文Times New Roman并自动按字符切换字体
- [PPTX生成][eva_skills] PPTX模板标题条置顶并改为全幅内容区布局
- [eva_skills][电子表格处理] 优化电子表格处理技能文档，补充快速流程/图表模板/质量检查并完成测试
- [PPTX生成][eva_skills] PPTX生成脚本新增图表支持并瘦身标题栏布局
- [frontend] 调整个人概况信息卡布局并改进额度环形图展示
- [frontend] 优化今日额度环形图尺寸与样式，移除中心文字
- [frontend] 调整个人概况额度卡片拉伸与统计卡片网格布局
- [frontend] 概况页精简统计项，新增今日额度环状图并修复刷新后统计归零
- [orchestrator][tool_result] 工具结果截断改为保留前后各 2000 字符，便于定位常见报错
- [frontend] 我的概况补充额度与上下文占用统计，支持工具/Token汇总
- [frontend] 聊天页用户信息支持直达我的概况，概况页补充对话统计数据
- [frontend] 聊天页隐藏功能广场按钮，主题切换改为太阳/月亮按钮
- [frontend] 广场搜索移至标题栏，移除设置按钮与概况卡片，概况入口改为用户信息区
- [frontend] 广场入口改为单列展示，移除核心功能/设置与侧边栏入口，外链统一合并到主入口列表
- [frontend] 聊天恢复为默认入口，功能广场调整为 /home 并移除临时文件区入口

### 修复
- [mcp_server] 调整 MCP 数据库连接配置以通过鉴权
- [mcp_server] wunder-mcp 默认不再注入 PERSONNEL_DB_* 环境变量，优先使用配置文件数据库地址
- [mcp][db] 默认数据库 description 会自动用于多库描述提示
- [mcp][db] MCP PostgreSQL 非查询语句兼容缺失 lastrowid
- [frontend] 优化图片预览放大尺寸并防止历史问询面板复显
- [frontend] 修复图片预览弹窗宽度与历史问询面板重复弹出
- [frontend] 修复聊天图片资源卡片对 SVG 预览的兼容性
- [frontend][backend] 优化个人概况统计布局并修复上下文占用刷新后缺失
- [frontend] 资源图片缺失时提示已移除并同步下载错误提示
- [frontend] 修复 portal.css 多余括号导致的构建错误
- [docs][readme] 修复README中文乱码并重写中文版说明
- [docs][readme] 修复README增量编译说明中文乱码
### 性能
- [sandbox] 沙盒规则与路径派生结果加入 LRU 缓存，降低高并发重复归一化开销
- [sandbox][tools] 沙盒命令执行优先直通启动，减少 bash 解析开销以降低高并发延迟
### 文档
- [docs] 清理设计方案与工具调用文档中已移除的附加提示词描述
- [docs] 更新 MCP 数据库配置说明为仅使用 mcp_config.json
- [mcp] 更新 mcp_server README 连接示例名称
- [mcp] 更新 mcp_server README：补充 MCP 连接示例并精简说明
- [mcp] 补充 mcp_server README 部署与 IP/DB 配置说明
- [docs][智能体] 补充智能体功能拓展方案的ABC等级与管理员覆盖策略
- [docs][智能体] 新增智能体功能拓展方案文档
### 工程
- [sandbox][build] 移除 tools.rs 中未使用的 Command 引用以清理编译告警
## 2026-01-26
### 新增
- [frontend] 新增用户侧功能广场与个人概况页，默认入口切换为广场并支持模块化外链配置
### 变更
- [frontend] 优化功能广场布局为单页内滚动面板，外链入口改由 external-links 配置集中管理
- [sandbox][admin][docs] 移除沙盒镜像配置项并同步配置示例与接口文档
- [skills][公文写作] 公文写作默认字体名称修正为仿宋_GB2312与楷体_GB2312
- [优化wunder] PPTX 视觉评分口径补充：空文本形状计入 non_text_shapes
- [技能][PPTX生成] PPTX 生成模板新增多套内置版式（report/lecture/education/defense/simple）并补充背景卡片
- [优化wunder] PPTX 熟练度评分权重调整：强调视觉与样式，降低流程/产物/内容权重
- [web] 为工作区文件读写接口补充 Python 示例
- [优化wunder] PPTX 评分用例增加前置清理要求：请求前删除 user_id 工作区与历史
- [优化wunder] PPTX 熟练度评分增加门槛：无非文本形状时视觉与样式整块记 0 分
- [web] 将接口示例从 curl 替换为 Python requests
- [web][docs] 重构管理端接口文档页面，改为左侧接口列表+右侧详情，并将接口信息维护到 web/docs/api-docs.json
- [技能][优化wunder] 调整PPTX熟练度评分权重并强调视觉样式
- [frontend][chat] 用户侧聊天输入支持拖拽上传，并将问询面板选择改为随发送按钮一起提交
- [技能][优化wunder] 补充PPTX生成任务的熟练度评分机制
- [技能][PPTX生成] 补充PPTX生成技能编辑约束与失败处理说明
- [技能][PPTX生成] 拆分字体与颜色常量并加标记，降低样式修改出错率
- [技能][PPTX生成] 简化PPTX生成模板输出路径，避免路径模块导致脚本失败
- [技能][PPTX生成] 优化PPTX生成技能模板与流程，增加可替换标记与输出文件变量
- [frontend] 前端支持从仓库根目录 .env 读取 VITE_API_BASE 作为 API 基础地址
- [web][debug] 调试面板稳定性按钮移至操作行最左侧

### 修复
- [技能][PPTX生成] PPTX 模板兼容旧版 PptxGenJS：ShapeType 缺失时回退为字符串形状
- [web] 修复工作区文件读写示例标题乱码
- [web] 修复接口文档 Python 示例中的中文乱码
- [web] 修复接口列表点击后折叠状态被重置导致跳回核心对话的问题
- [frontend][chat] 修复问询面板在同会话内二次弹出不显示的问题
- [公文写作] 二级/三级标题改为加粗并取消三级标题斜体
- [公文写作] 修复公文写作 DOCX 标题颜色默认变蓝的问题
### 性能
- [storage][postgres] 优化Postgres存储连接池与日志索引并改进会话锁并发
### 文档
- [docs][readme] 补充 docker compose 启动时增量编译判断说明
- [docs] 智能体调度平台的设计与实现 DOCX 补齐图片并通过 pandoc 重新生成
- [web][docs] 调整 paper2.md 的本体论表述为轻量补充
- [web][docs] 优化 paper2.md 结构，弱化本体论并作为补充说明
- [web][docs] 重构 paper.md，强化本体论语义层叙事与结构
- [readme] README-English 补充前端 API 基地址使用根目录 .env 配置说明
## 2026-01-25
### 新增
- [工具] 增加技能调用内置工具用于按技能名返回SKILL.md与目录结构
- [frontend] 聊天消息内的工作区资源链接支持图片预览与下载。
- [skills][优化wunder] 新增调试技能优化wunder，沉淀wunder调试流程与注意事项
- [skills][公文写作] 新增一键嵌图 DOCX 转换脚本并补充使用说明
- [web][debug] 调试面板新增长对话稳定性预设与自动化执行
### 变更
- [工具][sandbox] 执行命令移除shell参数并默认使用shell执行
- [工具][sandbox] 执行命令默认启用shell并放开限制
- [提示词][工具] 执行命令工具说明补充workdir仅限工作区相对路径且content不限制
- [工具][技能] 技能调用返回SKILL.md路径与技能根目录的绝对路径
- [提示词][技能] 技能使用协议移除第五条并同步英文描述
- [提示词][技能] 已挂载技能列表恢复输出SKILL.md路径与Frontmatter
- [提示词][技能] 已挂载技能列表补充描述字段展示
- [docker] wunder_rust 启动前检查目标二进制是否过期，等待 sandbox 重新编译后再启动
- [web][monitor] 内部状态工具热力图中技能调用使用魔法棒图标
- [提示词][技能] 已挂载技能列表不再输出SKILL.md路径与Frontmatter
- [frontend] 窄屏时侧栏改为顶部按钮并弹窗展示临时文件区/历史记录
- [frontend] 窄屏时隐藏侧栏并在顶部提供临时文件区/历史记录按钮弹窗查看
- [提示词][工具] 技能提示词规则改为使用技能调用获取SKILL.md
- [frontend] 图片资源卡片标题与元信息合并同行展示，缩紧图片信息区
- [frontend] 优化图片资源卡片尺寸贴合预览，并支持点击放大查看
- [docker] wunder_rust 不再等待 sandbox 健康检查，改为 service_started 以适配首次编译耗时
- [docker] 将 sandbox 的 CARGO_HOME 调整为 /app/.cargo，统一使用项目内 .cargo
- [docker] 放开 sandbox 容器对 /app 的只读挂载，允许写入 target 产物
- [docker] 调整 x86/arm compose 的 CARGO_TARGET_DIR 为项目内 target/x86 与 target/arm 目录，便于打包移植
- [prompt] 系统提示词补充资源输出指引，要求提供可访问的工作区路径与预览/下载链接。
- [frontend] 缩小聊天资源图片预览尺寸以避免占用过多空间。
- [frontend] 优化用户侧聊天窄屏布局：临时文件区与历史记录顶部并排，聊天区下置。
- [skills][优化wunder] 将实战示例移动至 examples 并细化流程
- [skills] 补充技能创建器脚本参数约束与最短执行清单
- [skills][优化wunder] 补充优化wunder技能的上下文压缩实战示例
- [prompts][skills] 优化问询面板规则与技能脚本指引，补充python3与路径/依赖检查要求
- [skills][优化wunder] 强调调试时必须设置 debug_payload 为 true
- [skills][公文写作] 代码块段落增加边框与底色
- [skills][公文写作] 代码块英文字体改为 Times New Roman
- [prompts] 系统提示词补充上下文摘要使用规则，避免摘要结构被直接复述
- [backend][prompts] 优化上下文压缩摘要结构并将摘要按系统上下文注入
- [skills][公文写作] 补充引用上标规范并在转换后自动将正文[数字]转为上标
- [skills][公文写作] DOCX 转换改用 pypandoc 并统一表格字体小一号/表头居中
- [skills][公文写作] 合并嵌图流程到 convert_markdown_to_docx 并移除独立嵌图脚本
- [web][debug] 调试面板模型输出轮次展示补齐总轮次/用户轮次/模型轮次三段信息
- [skills][公文写作] 一键转换脚本自动将 SVG 渲染为高分辨率 PNG 并移除手动嵌图说明
- [web][useraccounts] 用户管理设置的用户权限改为下拉选择 user/admin
- [backend][api] 事件流与会话事件移除 round 兼容字段，仅保留 user_round/model_round。
- [轮次] 明确用户轮次与模型轮次定义并在事件流监控与会话事件中补充 user_round/model_round 字段
- [web][debug] 增强长对话稳定性测试为图表与打包自动化流程
- [web][debug] 增强长对话稳定性测试题目难度与步骤
- [web][debug] 调试面板将长对话稳定性测试折叠为按钮并隐藏流式/新会话/锁定工具集选项
### 修复
- [frontend] 修复历史会话重放工作流事件时耗时统计被当前时间拉长的问题
- [docker] 修复 ARM 版 compose 复用 x86 构建产物导致的启动失败，隔离 CARGO_TARGET_DIR
- [frontend] 补齐浅色主题下发送/上传按钮悬停反馈样式
- [frontend] 模型输出结束后自动刷新临时文件区并重试资源卡片加载
- [frontend] 修复历史会话加载时按 user_round 关联工作流事件，避免工作流信息丢失
- [frontend] 修复工作区资源中文文件名显示与下载乱码问题。
- [frontend] 修复浅色主题下资源卡片样式与非图片资源误渲染为图片的问题。
- [skills][公文写作] pypandoc 调用增加 --quiet 以避免非 UTF-8 输出导致失败
- [skills][公文写作] 参考文献自动分段并优化代码块样式
- [skills][公文写作] 修正引用上标处理以覆盖表格并跳过参考文献段落
- [skills][公文写作] 表格单元格内容改为垂直居中
- [skills][公文写作] 清理样式主题字体并同步字符样式，避免标题回退到 MS 字体
- [backend][orchestrator] 修复上下文压缩在附件场景下可能遗漏当前问题，并裁剪摘要以确保回填后占用可控
- [skills][公文写作] pandoc 输出后补齐正文/标题样式字体并统一表格边框
- [web][debug] 调试面板 Token 占用改用上下文占用并补充计费 Token 消耗展示
- [web][debug] 调试面板统计信息 Token 文案改为占用用于上下文占用提示
- [skills][公文写作] 一键嵌图脚本优先复用已有 PNG 并修正 SVG 处理逻辑
- [web][debug] 调整调试面板模型输出按模型轮次渲染并展示用户轮次，避免不同用户轮次混淆
- [docs][web] 调整 docx 图片段落行距避免遮挡
- [web][backend] 修复管理端监控线程详情解码速度统计，按轮次累计排除工具耗时，并修复管理端中文文案乱码
- [docs][web] 修复 docx 表格样式与图片排版问题
- [frontend] 美化浅色主题系统提示词预览关闭按钮悬停交互样式
- [frontend] 浅色主题系统提示词预览关闭按钮补充悬停交互
- [frontend] 浅色主题下系统提示词预览关闭按钮改为浅色样式
- [skills][公文写作] 公文写作脚本识别已有标题编号避免重复编号
- [frontend][workspace] 用户侧临时文件区 SVG 预览改用 content 接口构建
- [frontend][workspace] 用户侧临时文件区 SVG 预览改用 iframe 并补白底
- [web][workspace] LSP 工作区双击非文本文件时改为预览而非编辑
- [web][frontend][workspace] 改用 Blob MIME 修正方式提升 SVG 预览兼容性
- [frontend][workspace] 用户侧临时文件区 SVG 预览补齐 MIME 处理
- [web][workspace] 修复临时文件区 SVG 预览未正确显示的问题
- [web][frontend] 修复管理端线程详情耗时与统计信息展示，并校准用户端会话耗时为完整交互时长
- [backend][orchestrator] 补齐工具执行结果截断与输出统计辅助，修正 llm_output_delta 回放过滤测试

### 性能
- [mcp][backend] MCP 工具清单拉取增加短 TTL 缓存，降低重复刷新开销
### 文档
- [prompts] 同步 system.txt 中英文提示词
- [docs] 重写系统介绍为管理层完整版，保留流程图并补充治理与工具细节
- [docs] 重写系统介绍为管理层版本，突出原理流程与价值
- [技能] 强化优化wunder对乱码样本的规避说明
- [技能][提示词] 补充优化wunder技能调试流程与实战示例
- [技能] 调整技能脚本执行示例，去除工作目录外的绝对路径
- [技能] 修正技能脚本执行说明，强调在工作目录执行
- [readme] 修复 README.md 中文乱码并统一为 UTF-8
- [readme][docs] 更新 README 与请求示例，补充 A2A/调试入口/存储与 Skills 说明并修正文档过时路径
- [skills][公文写作] 将图片段落修正流程设为必做并提供修复脚本
- [skills][公文写作] 补充 Linux 下 pandoc resource path 分隔与示例
- [skills][公文写作] 补充 pandoc 嵌图流程与图片段落排版说明
- [docs][web] 使用 pandoc 嵌入论文图示生成 docx
- [docs][web] 修复工具管理流程图中文乱码，新增 Agent Loop 图并同步论文 docx
- [docs][系统优化] 补充节点任务拆解与发布门槛三件套
- [docs][系统优化] 深化系统优化方案的可行性评估与节点细化
- [docs][系统优化] 补充系统优化方案的深入分析与持续推进节点
- [docs][web] 补充论文多轮对话 Agent Loop 与长期稳定运行方法说明
- [docs] 修复系统优化方案与设计/API文档中审批与缓存描述的乱码与字段说明
- [docs] 更新系统优化方案节点状态并补充审批缓存/MCP 缓存说明
- [docs] 同步 exec_policy_mode 与 context_usage/tool_result 事件说明
### 安全
- [backend][exec_policy] exec_policy 高风险命令支持审批标记与会话级缓存
### 工程
- [sandbox] 移除执行命令中未使用的shell解析辅助函数
- [backend] 移除提示词构建中的未使用路径辅助函数以消除编译警告
### 移除
- [skills][公文写作] 移除独立的 docx 图片修复脚本
## 2026-01-24
### 变更
- [管理端][性能测试] 性能测试增加权限/工具解析耗时指标
- [admin] 技能管理选择技能时默认打开 SKILL.md
- [admin] 内部状态热力图问询面板使用提问图标
- [skills][eva_skills] EVA_SKILLS 技能目录与名称统一为中文（公文写作、MCP服务构建、PDF处理、PPTX生成、SVG生成、技能创建器、电子表格处理）
### 修复
- [skills][公文写作] Markdown 转 DOCX 标题字体未按配置生效的问题
### 性能
- [sandbox][command_exec] 沙盒命令执行支持异步子进程，减少高并发排队
- [sandbox] 为沙盒命令执行增加线程池与 worker 可配置项
- [backend] 缓存工具路径根目录，减少高并发文件操作的路径归一化开销
### 文档
- [docs][系统优化] 新增系统优化方案文档
- [docs] 同步论文与架构图副本
- [docs] 更新架构图 SVG 与用户前端文档中的模块路径说明
- [docs] 更新设计/系统/API 文档与性能优化说明，补充 sandbox 模式与 prompts 路径。
- [docs] 补充沙盒命令执行并发优化说明
- [docs] 补充工具路径根目录缓存优化说明与指导
- [docs] 在AGENTS.md补充功能迭代类型清单
- [docs] 迁移旧记录至功能迭代-old.md并将记录规范移至AGENTS.md
- [docs][scripts] 建立分类化变更记录规范并升级写入脚本。
### 重构
- [backend][src] 整理 src 目录结构为 core/services/ops/sandbox，并移除未使用的旧后端代理代码。
- [sandbox][backend] 沙盒服务改为 Rust sandbox 模式运行，移除 app 并将提示词迁移至 prompts/。
### 工程
- [docker][sandbox] docker compose 改为由 sandbox 先编译共享产物，主服务直接启动 wunder-server。
- [infra] 补充沙盒并发调优环境变量示例
<!-- changelog:end -->

