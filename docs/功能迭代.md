# 功能迭代

<!-- changelog:start -->
## 2026-02-24
### 变更
- [skills][server][desktop][docs] 将仓库内置技能目录从 EVA_SKILLS 重命名为 skills，并同步更新 server/desktop 技能扫描路径、安全白名单与管理端文案/文档引用。
- [docker][mcp][config][docs] 统一容器命名并将独立 MCP 服务从 wunder-mcp/wunder_mcp 更名为 extra-mcp/extra_mcp（compose、配置、README 与架构文档同步）
- [config][mcp_server] wunder-example.yaml 的 wunder_mcp 默认 headers 改为 Authorization: Bearer ${WUNDER_API_KEY}，并同步 README 接入示例
### 修复
- [admin][skills][web][config] 修复管理端技能页删除按钮目录判定仍匹配 EVA_SKILLS 的问题，改为匹配 skills，并同步运行时覆盖配置中的技能目录引用。
- [docker][frontend] 前端容器启动前增加后端健康等待（wait-backend.mjs），减少 wunder-server 尚未就绪时 Vite 代理 ECONNREFUSED 警告
- [mcp][docker][config] 修复 Docker 下 wunder-server 连接 wunder_mcp 使用 127.0.0.1 导致拒连：新增 WUNDER_MCP_HOST 环境变量默认 extra-mcp，并将 wunder_mcp endpoint 改为主机可配置
### 文档
- [mcp_server][config] 更新 mcp_server README 对齐现有代码与接入流程，并在 wunder-example.yaml 的 mcp.servers 新增 wunder_mcp 默认配置示例
- [mcp_server][readme] 精简 mcp_server README，突出 MCP 连接示例与关键检查项

### 重构
- [extra_mcp][docker][docs] 将目录 mcp_server 重命名为 extra_mcp，并同步 compose 启动命令、配置注释与文档中的路径/名称引用
## 2026-02-23
### 修复
- [wunder-cli][tui] 修复流式文本拼接在无重叠 delta 下强制插入换行的问题：merge_stream_text 改为直接追加，消除模型输出按 token 换行显示的异常。
- [wunder-cli][tui] 修复 TUI 会话区换行渲染与行数统计不一致导致的空白与错位：日志渲染改为按 '\\n' 展开为多行并与 Paragraph::line_count 对齐，避免模型流式输出后界面看似消失、第二轮消息不可见。
- [wunder-cli][tui] 修复 TUI 会话区行数估算与 ratatui 实际换行不一致导致的抖动/空白问题：改为使用 Paragraph::line_count 计算可视行，并将滚动偏移与总行数统一提升为 usize，确保流式输出与 /system 长提示词可稳定显示和滚动。
- [docker][frontend][nginx] docker compose 前端容器增加 FRONTEND_UMASK 入口并在入口点统一应用，避免 frontend/dist 产物权限过严导致 wunder-nginx 读取失败；同时 nginx 挂载支持 NGINX_BIND_OPTS 以兼容 SELinux 标签场景

### 重构
- [wunder-cli][tui] 重构 TUI app 代码结构：将超大 app.rs 拆分为 app/commands.rs（slash 与会话命令处理）、app/helpers.rs（文本处理/滚动计算/工具结果格式化等通用函数）与 app/tests.rs（单测），并保持功能行为不变。
## 2026-02-22
### 变更
- [cli][tui][docs][测试] wunder-cli 继续对齐 codex：line-chat /mcp 与 TUI 保持管理语义一致（add/get/enable/disable/remove/login/logout/test），新增 mcp test 子命令，并补充 diff/notify 解析单元测试。
- [cli][tui][docs] wunder-cli 补齐 /edit、/branches 与 /diff 子操作，/notify 新增 osc9/失焦触发，TUI /mcp 支持增删改鉴权测试，并为 /debug-config 增加 source_chain 与日志字符预算裁剪。
- [cli][tui][docs] wunder-cli 新增附件流初版：支持 --attach 预加载与 /attach 队列管理（list/clear/drop/add），line-chat 与 TUI 在下一轮自动携带附件；图片自动转 data URL，文档/代码优先 doc2md 转 Markdown，/status 与 debug 配置同步展示附件状态。

### 修复
- [cli][line-chat] line-chat slash 分发增加统一异步 future 堆化（Box::pin）并对 /system 提示词构建路径做任务解耦，进一步降低主线程栈溢出风险。
- [cli][line-chat] 修复 line-chat 下 /status、/model、/system、/mcp list、/skills list、/apps list 等 slash 命令在特定路径触发主线程栈溢出的问题，交互命令稳定性恢复。
### 性能
- [cli][tui] wunder-cli TUI 会话区改为窗口化渲染，仅按可见范围绘制 transcript，并补齐滚动窗口计算单测，降低长会话重绘开销。
### 测试
- [cli][line-chat] 新增集成回归测试 tests/wunder_cli_line_chat_smoke.rs，覆盖 /status /model /system /mcp list /skills list /apps list 的中英 line-chat 稳定性，并纳入 cargo test --all-targets。
- [cli][line-chat] 补充并执行扩展命令冒烟矩阵（中/英）：/status /model /system /mcp list /skills list /apps list /debug-config /statusline 等，全部通过且未复现栈溢出。
- [cli][line-chat] 补充 wunder-cli 效果冒烟验证矩阵，覆盖 doctor/completion/mcp/skills 以及 line-chat 关键 slash（status/model/system/mcp/apps/debug-config/statusline）命令回归。
## 2026-02-21
### 新增
- [wunder-cli][slash] wunder-cli 新增 /plan /personality /init /agent 四个交互命令，并支持 --agent 全局参数覆盖请求 agent_id。
### 变更
- [cli][tui][docs] wunder-cli 新增 /notify 回合完成通知（off/bell/command），line-chat 与 TUI 在回合结束可触发 BEL 或外部脚本钩子；/agent 新增 list 可快速发现并切换最近会话 agent_id，/status 与 /debug-config 同步显示通知配置。
- [wunder-cli][apps] wunder-cli /apps 新增 info 子命令，并增强 test 在 GET=405 时自动回退 POST 探测，提升连接器诊断准确性。
- [wunder-cli][tui] wunder-cli 新增 /backtrack [list|index]，支持在 TUI 与行式交互中回溯最近用户消息并快速回填/重发。
- [wunder-cli][tui] TUI 输入补全支持最近使用优先排序并持久化，# 技能补全增加未启用提示与 /skills enable 指引。
- [cli][tui][docs] wunder-cli 新增输出焦点回溯编辑：选中用户消息后 Enter 回填输入区继续编辑；快捷键说明与 API/实现方案文档同步更新。
- [cli][tui][docs] wunder-cli 输入补全继续对齐 codex：新增 $ 应用连接器与 # 技能提示补全（Tab 首项补全），并在粘贴换行判定中排除 slash 上下文；/apps 连接器管理与 TUI popup 目录联动刷新。
- [cli][tui][docs] wunder-cli 继续对齐 codex：新增 /apps 连接器管理子命令（connect/install/enable/disable/disconnect/auth/logout/remove/test）并补齐运行中 slash 命令门控；同步更新 API 与实现方案文档。
- [cli][tui][docs] wunder-cli TUI 鼠标交互改为默认 auto 模式（滚轮+临时选择透传），降低对 F2/F3 手动切换依赖；/mouse 扩展为 auto|scroll|select，并同步更新文档与提示。
- [cli][docs] wunder-cli 对齐 codex 补齐 /skills /apps /ps /clean /fork /rename /compact /debug-config /statusline，新增 TUI 状态栏可配置持久化、Windows 粘贴 burst 防误提交与流式背压，并同步更新 CLI 方案/API/系统文档。

### 文档
- [docs][cli] 补充 wunder-cli 优化方案下一轮 P0/P1/P2 对齐排期，覆盖输入状态机、apps 可操作化、busy 命令门控、会话回溯、多模态与性能治理。
## 2026-02-20
### 新增
- [channels][wechat_mp][api] 新增微信公众号渠道专用接入：支持 /wunder/channel/wechat_mp/webhook URL 验证、明文/加密回调签名校验与 AES 解密，并支持公众号客服消息直连出站。
- [channels][wechat][api] 新增企业微信渠道专用接入：支持 /wunder/channel/wechat/webhook 的 URL 验证与加密回调解析（签名校验+AESCBC解密），并支持企业微信 API 直连发送回复。
### 变更
- [cli][docs] wunder-cli MCP 对齐 codex：新增 mcp login/logout 鉴权管理、mcp list/get 显示鉴权状态与快捷操作，并在 TUI/交互态新增 /mcp [name|list] 查看 MCP 配置。
- [frontend][channels] 用户侧渠道设置补充 wechat_mp 渠道展示并对 wechat/wechat_mp 默认 peer_kind 强制为 user，避免创建配置时报错。
- [channels][wechat_mp][user_channels] 用户侧渠道配置新增 wechat_mp 快捷配置与账号识别规则（token/ToUserName），并约束默认 peer_kind 为 user。
- [channels][wechat] 企业微信渠道标准化增强：回调签名参数兼容 msg_signature/signature，支持 voice 语音识别文本与可映射 event 入站，并补齐无 MsgId 场景去重ID生成。
- [wunder-cli][skills][prompt] wunder-cli 对齐 codex 技能管理体验：新增 skills upload/remove/root 与列表 JSON 输出，默认技能与用户工具目录迁移到用户主目录 .wunder，并将本地运行时系统提示词工作目录改为真实路径显示
- [channels][feishu] 飞书渠道处理中问候语改为可回收：发送最终回复后自动撤回前置‘已收到消息，正在处理中，请稍后。’提示，避免会话中残留等待文案。
- [wunder-cli][tui] 优化 CLI TUI 输入区粘贴体验：支持 Ctrl+V、Shift+Insert 与右键粘贴，并增加系统剪贴板读取失败的双语提示
### 性能
- [channels][wechat] 企业微信出站 token 获取加入内存缓存并提前刷新，降低每次回包都请求 gettoken 的额外开销。
- [channels][wechat] 企业微信入站改为异步处理并立即返回 success，避免模型推理耗时触发渠道 5 秒超时重试；实际回复由后台任务完成后再出站发送。
### 文档
- [docs][wechat_mp] 补充 API 文档、设计方案与系统介绍中的微信公众号渠道路由、签名鉴权、异步回包与配置字段说明。
- [docs][cli] 补充 wunder-cli 优化方案近期落地：真实工作目录路径提示、默认技能目录迁移到 .wunder、技能上传/删除管理能力
- [docs][ppt] 重绘 multi-entry-collaboration 配图，调整连线层级到节点下方并改为左右入口汇聚到中心主链路，避免线条压盖文本。

## 2026-02-19
### 变更
- [cli][docs] 完成 codex 差距复审并更新 CLI 优化方案：新增 2026-02-19 对比结论与 R3 优先级；同时补齐 TUI 工具阶段提示与 /mouse 状态文案双语化。
- [cli][docs] 进一步完善 CLI i18n：新增 --language 兼容别名、补齐 prompt/stdin 等错误提示本地化、doctor 检查项中文标签、TUI 模型/审批/系统提示词及恢复流程提示翻译覆盖。
- [cli][docs] 继续推进 wunder-cli 双语化：补全 --help 参数/子命令说明中英对照，增强 TUI 会话状态/审批弹窗/系统提示词与恢复流程提示双语输出，并扩展日志本地化映射。
- [cli][docs] wunder-cli 新增中/英 i18n：交互模式、/status /session /model /tool-call-mode /approvals /resume /system /config 指引与日志、MCP/skills/doctor 输出及 TUI 关键状态文本均按语言切换。
### 修复
- [backend][cli] 修复 approval 模块引用路径与 TUI /review 闭包所有权问题，恢复 cargo check/cargo test 可通过
- [backend][tools] 补齐 sessions_continue/sessions_spawn 构造 WunderRequest 的 approval_tx 字段，避免审批通道接入后编译失败

### 文档
- [docs][ppt] 重绘 swarm-teamrun-flow 配图，调整连线层级到节点下方并优化环形流程视觉，避免线条压盖节点文本。
- [docs][ppt] 移除 PPT 配图顶部蓝色装饰线，修正 architecture-four-layers 右侧卡片对齐并将左侧说明统一为单行，优化 context-memory-compaction 左侧标题与说明重叠问题。
- [docs][ppt] 优化 core-three-modes/context-memory-compaction/org-governance-model 三张配图布局，修复元素重叠与越界，并调整结构层次与信息区块排布。
- [docs][ppt] 将 PPT 18 张配图按实际内容重命名并同步更新页面引用，重绘 SVG 为多模板风格（辐射/泳道/时间线/分层/矩阵/路线图）以提升视觉区分度。
- [docs][ppt] 重写叙事主线并按重构后的系统能力重构 20 页 PPT，同时更新全部宣讲配图为新架构口径。
### 工程
- [backend] 按 clippy 校验收敛 sim_lab/sqlite 细节告警并补齐 exec_policy 缓存测试断言
## 2026-02-18
### 变更
- [cli][backend][docs] wunder-cli 对齐 codex 体验落地：新增 approval-mode（含 /approvals 与 config set-approval-mode）、TUI/命令行审批交互、/diff /review /mention、completion 命令、Ctrl+C 中断与双击退出、跨会话输入历史与粘贴事件处理，并补充 API/设计/系统文档
### 文档
- [docs][cli] 新增 wunder-cli 对标 codex-main 的优化方案文档，补充现状差距分析、审批/沙盒/交互/diff-review 闭环与分阶段落地计划（M0-M3）

## 2026-02-17
### 新增
- [backend][frontend][docs][auth] 支持外部系统 iframe 嵌入免登录：新增 /wunder/auth/external/* 自动建号/对齐登录与一次性 code 兑换，前端支持 wunder_code/wunder_token 引导登录并自动清理 URL 敏感参数，补充接入方案文档

### 文档
- [docs][auth] 补充外部系统嵌入方案中一次性 code 的内存态说明（服务重启后失效）
## 2026-02-16
### 新增
- [frontend][design] 新增 5 版初号机风格 Q 机器人 SVG 头像及本地预览页（/agent-avatars/preview.html）
### 变更
- [frontend][ui] 世界页移除 我的智能体应用标题，进一步压缩首屏纵向空间
- [frontend][ui] 世界页隐藏应用搜索框与更多应用按钮，进一步压缩头部操作区并减少视觉干扰
- [frontend][ui] 世界页移除 section 描述与数量 meta 行节省空间，并将浅色主题卡片改为扁平化风格（去除卡片阴影与悬浮阴影）
- [frontend][ui][responsive] 用户侧前端响应式布局升级：世界页与顶部导航改为弹性栅格与换行策略，补齐手机和平板断点；智能体卡片与新建智能体弹窗、工具/定时任务/渠道管理页在窄屏下自适应并避免溢出。
- [frontend][ui] 回退浅色主题智能体卡片到上一版稳定视觉（移除科技扁平试验样式），保留运行态动效并修复卡片显示问题
- [frontend][ui] 世界页浅色主题进一步改为科技扁平风：卡片去重渐变与厚阴影、增加科技顶线，运行中状态改为扫描流光+边框脉冲动画
- [frontend][ui] 优化世界页浅色主题智能体卡片：背景改为蓝紫轻渐变、文本与元信息提亮并增加层次，运行中状态在浅色下增强脉冲/发光动效
- [frontend][ui] 优化世界页智能体卡片视觉：提升标题/描述/元信息色彩层次，运行中状态增加头像脉冲与标签呼吸动效，减少页面 灰暗感
- [web][frontend] 管理员工具管理-内置工具页隐藏顶部 自建工具按钮；用户世界页智能体卡片改为仅在非待命状态显示状态标签，且完成态在用户再次进入后立即重置为待命
- [backend][api] GET /wunder/agents/running 聚合每个智能体状态（idle/waiting/running/cancelling/done/error），并在 error 时补充 last_error 供前端展示
- [frontend] 调整新建智能体应用弹窗：复制已有应用移至标题行，并用机器人头像+颜色标签重做卡片状态展示（移除状态灯）
- [backend][prompt] system prompt: function_call 模式下不再拼接 tools_protocol 段（工具协议仅在 tool_call 模式输出），减少冗余
- [docker][docs] [docker][ops] temp_dir 默认改为本地 ./temp_dir（容器内 /app/temp_dir），不再落在 workspaces 卷；同步更新 .env.example 与相关文档
### 修复
- [web][admin][ui] 管理员侧工具管理-内置工具面板隐藏误显示的自建工具入口（若存在）
- [backend][knowledge] [admin][knowledge] 删除字面知识库配置时同步清理 ./knowledge/<base> 目录（仅在目录未被其他知识库复用时）
- [web][prompt] 系统提示词预览工具名称高亮渲染修复：按工具类别补齐 tool-highlight 样式类，并收窄左侧分段文件栏给右侧预览留空间。

### 文档
- [docs][api] 更新 API 文档：补充 /wunder/agents/running 的 state 枚举、pending_question 与 last_error 说明
### 移除
- [frontend] 移除智能体应用头像自定义设置，智能体应用卡片统一使用机器人头像
## 2026-02-15
### 变更
- [prompting][cli][desktop][docs] 统一 WUNDER_PROMPTS_ROOT 语义为包含 prompts/ 的项目根目录，并兼容旧值为 prompts 目录；修复 CLI/Desktop 运行时默认提示词路径注入，避免默认模板在非仓库启动目录下加载失败。
### 修复
- [docker] docker compose 修复：wunder-sandbox 增加对 wunder-volume-init 的 depends_on（service_completed_successfully），避免首次启动时 volume.subpath 目录未创建导致挂载失败
### 性能
- [backend][prompts] 系统提示词构建：提示词模板文件读取改为基于模板 revision 的缓存，避免每次构建触发 bind mount stat/mtime 开销，热路径耗时恢复到 ~2-5ms。

### 文档
- [docs][readme] [docs][docker] 同步 README/API/设计/系统介绍/配置与状态存储梳理：明确两卷模型（workspaces+logs）与本地 data/ 治理、迁移方式
- [docs][ops] 补充 Docker 持久化卷 wunder_persist 的备份/迁移（换机部署）指引：停机打包整卷与 DB 逻辑备份两种方案
- [docs][docker] 更新 README/API/设计/系统介绍/docker-extra/README：同步说明 docker compose 使用 wunder_persist 单卷分区挂载与相关路径
- [docs][docker] 更新 API/设计/系统介绍文档：temp_dir 支持 WUNDER_TEMP_DIR_ROOT，docker compose 运行态目录改为命名卷挂载（wunder_data/wunder_target/wunder_cargo 等）
- [docs][storage] 补充 配置与状态存储梳理：加入 data 目录配置整合到 Postgres 的可行性/性能影响/迁移路径建议
- [docs][config] 新增 配置与状态存储梳理文档，区分固定/活动配置与本地/数据库存储位置
### 工程
- [docker][storage] docker compose 持久化调整：运行态可写配置保留本地 data/；仅保留两卷 wunder_workspaces(/workspaces+temp_dir) 与 wunder_logs(Postgres/Weaviate)
- [scripts][ops] 卷备份/恢复脚本升级：默认同时备份/恢复 wunder_logs+wunder_workspaces，tar 运行镜像改为 postgres:16（避免额外 alpine 依赖）
- [scripts][ops] 新增 Docker 持久化卷 wunder_persist 的一键备份/恢复脚本（scripts/backup_persist_volume.ps1、scripts/restore_persist_volume.ps1），并将 backups/ 加入 .gitignore
- [docker][storage] docker compose 调整：wunder_persist 仅持久化 data/workspaces/postgres/weaviate；cargo/target/frontend node_modules 回退写入仓库 bind mount，便于本地清理管理
- [docker][storage] docker compose 持久化卷从多卷合并为单卷 wunder_persist（volume.subpath 分区），新增 wunder-volume-init 预创建分区目录，减少卷数量并保持仓库 bind mount 干净
- [docker][frontend] docker compose 为 wunder-frontend 挂载 node_modules 命名卷（wunder_frontend_node_modules），避免将依赖安装写入仓库目录
- [docker][storage][config] docker compose 将 data/、target/、.cargo/ 挂载到命名卷（wunder_data/wunder_target/wunder_cargo），并新增 WUNDER_TEMP_DIR_ROOT/WUNDER_VECTOR_KNOWLEDGE_ROOT 等路径变量避免运行态写入仓库目录
## 2026-02-14
### 变更
- [web][prompt] 系统提示词预览不再依赖工具选择 tool_names，改为直接使用默认工具集构建预览（与提示词页不挂载工具一致）。
- [web][prompt] 系统提示词模板包下拉不再追加 * 标记，启用状态仅用按钮高亮；分段文件侧栏宽度缩窄，为编辑/预览留更多空间。
- [backend][prompts] 提示词模板包 API 将 default 包设为只读（禁止修改），并将 locale 默认值改为跟随系统语言设置。
- [web][prompt] 系统提示词页面头部操作改为 icon-only，并压缩布局/高亮当前启用模板包，减少拥挤。
### 修复
- [web][prompt] 系统提示词预览的工具名高亮改为对所有包含 "name": 的 JSON 行生效，避免依赖 <tools> 标签分段导致漏渲染。
- [web][prompt] 修复系统提示词预览中 <tools> 段工具名高亮渲染（正则写法错误导致未命中）。
- [backend][prompts] 修复提示词模板包 API / 提示词渲染中的未使用变量与 import 警告（cargo check 无 warning）。
- [web][prompt] 系统提示词预览请求自动带上 tool_names（复用工具选择），避免预览缺失工具列表。
- [backend][docker][config] docker compose 开箱即用：extra-mcp 加入 build 并为本地镜像设置 pull_policy: never，避免首次启动在镜像未构建完成时拉取失败；同时 config/wunder.yaml 缺失时自动回退 config/wunder-example.yaml，允许无 .env 直接启动。

### 文档
- [readme][docker][config] 更新 README/API/设计/系统介绍文档：说明 config/wunder.yaml 缺失自动回退示例配置、.env 为可选项，以及 compose 复用同名本地镜像的启动策略。
### 重构
- [backend][web][prompts] 系统提示词模板改为分段文件+模板包管理：新增 /wunder/admin/prompt_templates API 与管理端模板包页面，可切换启用模板包并编辑 role/engineering/tools_protocol/skills_protocol/memory/extra 分段文件，同时提示词构建移除 prompting.rs 内嵌模板。
### 移除
- [prompts] 清理历史提示词文件：删除 prompts/{zh|en} 下旧版 system_*/engineer_*/plan/question_panel/a2ui 等文件，仅保留 prompts/{zh|en}/system/ 分段文件以及 compact_prompt/memory_summary。
## 2026-02-12
### 新增
- [wunder-cli][tui][session] wunder-cli 新增 /resume 历史会话恢复能力：命令行支持 list/last/index/session_id，TUI 新增会话选择弹窗并可从历史重建对话记录。
- [backend][docker][build] 在 docker-build 新增 docker-compose-ubuntu20.yml，提供 x86/arm 两个编译服务（profile 切换），复用项目目录与 workspaces/font 挂载并预置 CARGO_HOME/CARGO_TARGET_DIR、WUNDER 配置环境，便于在容器内编译 wunder-server/wunder-cli/wunder-desktop。
### 变更
- [backend][docker][build] 调整 docker-build/docker-compose-ubuntu20.yml 的 Cargo 缓存策略：x86/arm 编译容器改为复用仓库内 .cargo/x86 与 .cargo/arm64，并将目标目录对齐为 target/x86 与 target/arm64；workspaces 卷名对齐主 compose 的 wunder_workspaces。
- [backend][docker][build] 为 Dockerfile.ubuntu20 的 Tauri Linux 构建依赖增加版本兼容分支：优先使用 WebKitGTK 4.1 + libsoup3，若不可用则自动回退到 WebKitGTK 4.0 + libsoup2.4，避免旧发行版 apt 安装失败。
- [backend][docker][build] 将 Dockerfile.ubuntu20 改为直接复制主 Dockerfile 的完整依赖与流程，仅将基础编译镜像调整为 rust:1.92-slim-bullseye，并将回退 apt 源 codename 改为 bullseye 系列以兼容 Ubuntu 20.04（glibc 2.31）。
### 修复
- [workspace][cli][desktop] 修复单根工作区误删风险：当启用 single_root 且 workspace_root 等于全局根目录时，purge_user_data 不再递归删除根目录，避免删除 src/config/.cargo 等项目目录。
- [wunder-cli][session] 修复 /resume 空列表问题：发送消息前自动创建/更新 chat_session 记录，并在仅有历史消息缺少会话元数据时按历史回填会话记录，保证历史会话可被列出和恢复。
- [backend][llm][兼容性] 修复 OpenAI 兼容端点拼接：标准化 base_url 时识别并保留现有版本段（如 /api/paas/v4），自动剥离误填的 /chat/completions|/embeddings|/models 后缀，避免重复追加 /v1 导致 /v4/v1/* 404。
- [backend][docker][build] 修复 Ubuntu20 构建镜像中的 pip 参数兼容性：在 Dockerfile.ubuntu20-x86 与 Dockerfile.ubuntu20-arm 中移除 --break-system-packages，适配 bullseye 自带 pip 版本，避免构建报 no such option。
- [desktop][orchestrator][llm] 修复 desktop 工具链路空响应误报最大轮次：当未触发 max_rounds 且最终答复为空时改为 empty_response 并返回专用提示；同时在流式响应无 [DONE] 且无有效 payload 时自动回退一次非流式请求，降低工具调用后无最终回复问题。

### 文档
- [docker][desktop] 更新 docker-build/README.md，补充在构建容器内执行 cargo tauri build --bundles appimage 的示例，并注明 Linux 容器无法产出 Windows MSI。
- [backend][docker][build] 新增 docker-build/README.md，整理 Ubuntu20 x86/arm 编译容器的启动、进入容器编译、产物路径、Cargo 缓存复用与清理命令，便于按 compose 快速出包。
- [docs][api] 更新 API 文档 stop_reason 枚举，新增 empty_response（模型未返回可展示最终答复）说明，便于排查 desktop/cli 流式空响应场景。
### 重构
- [backend][docker][build] 重写 Dockerfile.ubuntu20-x86 与 Dockerfile.ubuntu20-arm 为精简编译镜像：仅保留 Rust/Cargo 与 wunder CLI/Desktop/Server 编译所需系统依赖，移除 Python/Node/Office/GIS 等无关组件；基础镜像与 apt 源改写结构沿用现有 Dockerfile。
### 工程
- [backend][docker][desktop] 在根目录 Dockerfile 与 docker-build 的 ubuntu20 x86/arm Dockerfile 末尾追加 tauri-cli 安装和 AppImage 相关基础工具（file/wget/xdg-utils），避免改动上方层影响既有构建缓存。
- [backend][docker][build] 新增 Dockerfile.ubuntu20（同步自 x86 版本），可直接按 -f Dockerfile.ubuntu20 构建 Ubuntu20 兼容镜像，避免文件名差异造成误用。
- [backend][docker][build] 新增 Dockerfile.ubuntu20：使用 glibc 2.31 基线（bullseye）编译 wunder-server，并提供 ubuntu:20.04 运行时镜像与二进制导出示例命令。
### 测试
- [backend][llm] 新增 LLM URL 规范化回归测试，覆盖 /api/paas/v4 版本路径保留、资源后缀剥离、chat/embeddings 端点拼接与根路径推导。
## 2026-02-11
### 新增
- [desktop][frontend][backend] 桌面端容器管理新增本机目录浏览器：本地模式下可通过目录选择弹窗按驱动器/目录层级浏览并回填容器工作目录。
- [desktop][frontend][tauri] wunder-desktop 默认改为 Tauri GUI 启动，双击程序直接打开桌面窗口并默认免登录进入 /desktop/home。
- [desktop][backend] 新增 wunder-desktop 本地桥接入口，支持托管 frontend/dist 并注入本地 token 自动进入用户会话。
### 变更
- [wunder-cli][tui] wunder-cli TUI 新增模型思考流展示（think>），支持 reasoning_delta/reasoning 合并输出，便于观察模型推理过程。
- [desktop][backend][docs] wunder-desktop 本地桥接默认端口由 18000 调整为 27653，并同步更新桌面运行文档说明。
- [deploy][frontend] docker-compose 支持单端口访问：用户仅通过 18001，同源代理 /wunder /a2a /.well-known 到内部后端，默认避免外网直连 18000/数据库端口
- [desktop][frontend][ui] 修正系统设置侧栏高度策略：恢复底部说明区为固定高度并采用粘性整栏高度，避免说明区域被拉伸变形，同时侧栏可滚动以保持可用性。
- [desktop][frontend][ui] 进一步调整系统设置侧栏占位：侧栏高度随内容区拉伸，底部说明卡改为填充剩余空间，消除侧栏底部空白截断感。
- [desktop][frontend][ui] 优化桌面端系统设置侧栏布局：侧栏高度随页面撑满并新增说明区，减少底部留白；主题切换浅色图标由圆形调整为灯泡图标。
- [backend][prompts] 将 prompts/zh/system.txt 与 prompts/en/system.txt 改为模块化模板（SYSTEM_ROLE/SAFETY/PRODUCT/PROGRAMMING/RUNTIME 占位符），由 Prompt Builder 按 server.mode 注入 server 或 local 运行环境模块后组装。
- [desktop][frontend][ui] 统一桌面端导航入口：聊天页移除独立容器管理快捷按钮，系统设置入口图标改为齿轮，并保持容器管理在系统设置侧栏中集中管理。
- [desktop][frontend] 重构桌面端系统设置页为侧边栏分区（模型配置/容器管理/服务端连接），统一在单页完成配置与保存操作。
- [wunder-cli][tui] 优化鼠标交互默认行为：TUI 默认进入 scroll 模式（开箱即用滚轮滚动输出区），并在快捷键帮助中补充 Shift+Drag 复制提示，减少 scroll/select 手动切换成本。
- [backend][prompts] 系统提示词改为按职能模块组装（角色/安全/产品/编程/运行环境），新增 server 与 cli/desktop 运行环境模块分离；提示词优先读取 prompts/zh|en 并补齐 en question_panel，英文模式内置工具名统一优先英文别名。
- [desktop][frontend] desktop 服务端接入流程简化为仅配置服务端地址，接入后跳转常规登录/注册页面，不再自动创建账号或自动登录。
- [backend][tools][wunder-cli] 命令执行工具按操作系统自动选择 shell：Windows 优先 powershell.exe，不可用时回退 cmd.exe；非 Windows 保持 bash -lc，避免在 Windows CLI 中默认落入 /mnt 路径语义。
- [desktop][frontend][ui] Desktop topbar now exposes container and system settings as always-visible icon buttons (portal and chat), with one-click navigation to /desktop/containers and /desktop/system.
- [desktop][auth][frontend] 调整 desktop 远端接入逻辑：不再自动注册或自动登录远端账号，改为用户按常规 register/login 流程完成鉴权；远端模式下本地设置继续使用 desktop_token 独立鉴权。
- [desktop][backend][frontend] Desktop remote access phase-1: resolve/switch runtime api_base and ws_base by remote_gateway; no auto register/login; users finish auth in regular register/login pages; local desktop settings keep using desktop_token.
- [web][simlab] 蜂群测试性能曲线移除 峰值并发折线，仅保留总耗时与端到端P95，避免多指标叠加干扰读图。
- [wunder-cli][tui][输入] wunder-cli TUI 输入区进一步对齐 codex：新增 Ctrl+B/F、Alt+Left/Right、Alt+Delete 等编辑键位，输入内容按面板宽度自动折行，并在 KeyEvent Repeat 下保持连续光标移动。
- [wunder-cli][tui][输入] wunder-cli TUI 输入区新增多行编辑能力：支持 Shift+Enter/Ctrl+J 换行、左右与行内 Home/End 光标移动，并保持 codex 风格快捷提示面板。
- [desktop][frontend] desktop UI 取消专属侧边栏，改为复用用户侧 UserLayout 与现有页面结构，默认入口调整为 /desktop/home。
- [desktop][api][chat] chat HTTP/WS 请求新增 tool_call_mode 可选字段，desktop 设置页可在 tool_call/function_call 间切换并按请求注入 overrides。
- [wunder-cli][tui][交互] wunder-cli TUI 对齐 codex 风格：顶部状态改为 shortcuts/context 视图，新增 ? 快捷键面板与 Ctrl+N/Ctrl+L 快捷操作，并复用统一模型配置写入逻辑。
- [wunder-cli][runtime][tui][docs][测试] wunder-cli 继续落地：默认不再强制设置 WUNDER_PROMPTS_ROOT（优先走内嵌提示词，外部可选覆盖）；TUI 流式过程实时更新上下文与调用统计；补充 max_context/上下文余量相关单元测试，并修正 CLI 方案/API/系统文档中的乱码片段。
- [wunder-cli][tui][docs] wunder-cli 完成交互增强：TUI 顶部显示 context left、支持鼠标滚轮滚动；新增 /session 统计与 /system 提示词管理；/config 支持 max_context 向导与自动探测，并同步更新方案/API/系统介绍文档。
- [desktop][api] 调整 desktop 路由聚合并补齐 auth/external_links，新增 /config.json 与 /wunder/desktop/bootstrap 运行时引导接口。
### 修复
- [desktop][orchestrator] desktop 模式下模型轮次上限改为始终不限制，避免工具调用后误触发 max_rounds 终止
- [desktop][network] wunder-desktop 默认桥接端口调整为 18123，端口被占用时自动回退到随机可用端口以确保启动
- [desktop][orchestrator] desktop 本地身份初始化统一提升为 admin 并自动修复已有非管理员账户，确保桌面会话不受最大轮次限制
- [desktop][backend][orchestrator] 恢复并加固最大轮次保护：非管理员在可调用工具时最小模型轮次强制为 8（无工具调用保持最小 2），避免工具首轮后直接触发 max_rounds。
- [wunder-cli][tui][stream] 修复 wunder-cli 流式输出重复与工具标签泄漏：新增分块 tool_call 标签剥离与流式内容去重合并，避免 assistant 回复重复显示。
- [desktop][frontend] 前端启动仅在桌面壳环境请求 /wunder/desktop/bootstrap，避免 server/web 模式出现 401；世界页改为有缓存卡片时不再显示全量加载占位，切页回显更快。
- [wunder-cli][tools][windows] 修复 Windows 命令输出解码：增加 UTF-16/GBK 判定与回退策略，并在 PowerShell shell 模式下统一 UTF-8 输出配置，缓解中文乱码。
- [wunder-cli][tui][tools] 优化 wunder-cli 工具结果展示：执行命令结果按成功/失败分类展示，优先突出 stderr 并限制长输出预览，减少无关噪声。
- [desktop][backend][orchestrator] 修复 desktop 工具链路首轮即触发最大轮次问题：非管理员会话在未配置或低配置 max_rounds 时自动提升到安全下限（默认8，最少2），确保工具调用后可继续请求模型。
- [wunder-cli][tui] 修复 /system 长文本下滚动无法到底：接入 ratatui 渲染后的真实行数（line_count）计算滚动上限，替换近似估算，确保输出区可滚到最新内容并在追加消息后正确回到底部。
- [desktop][frontend][ui] 修复系统设置侧栏提示区溢出：移除基于 viewport 的强制高度，改为容器内 100% 拉伸布局，使侧栏与内容区同高且不再底部截断。
- [desktop][frontend][ui] 修复系统设置侧栏底部被截断问题：侧栏改为 border-box 计算并使用 dVH 高度，限制横向溢出，避免底部提示区域超出可视范围。
- [wunder-cli][tui] 修复 /system 等大内容场景下滚动卡住与闪退：滚动偏移改为按当前可滚动范围实时夹紧，避免从极大偏移回落时 堵住；同时修复 compact_json 的 UTF-8 截断边界，消除中文内容导致的 truncate panic。
- [frontend][i18n] 修复 zh-CN 国际化文件中 desktop.system.defaultModelConfigRequired 文案乱码，恢复为 UTF-8 中文文本。
- [wunder-cli][tui] 移除鼠标滚轮对输入区的影响：scroll 模式下滚轮统一只驱动会话输出区滚动，不再做输入区滚动判定与区域交叉逻辑。
- [wunder-cli][tui][orchestrator] 修复 XML 风格工具调用未触发：新增 <tool_call><name>..</name><arguments>..</arguments></tool_call> 解析并兼容字符串化 arguments；同时将鼠标滚轮事件严格限制在会话输出区（输入区不再触发滚动）。
- [desktop][frontend] 修复 desktop 远端接入后切回本地时 API 基址/鉴权模式仍残留远端状态的问题，改为以远端地址覆盖项作为单一开关并自动回落本地桥接。
- [desktop][frontend] 修复 desktop 容器管理与系统设置页面在深色主题下的卡片、表格与输入框配色，统一跟随用户主题变量。
- [desktop][backend] 修复 desktop 系统设置中模型配置未持久化问题，保存后会写入 desktop.settings.json 并同步到运行时 ConfigStore。
- [wunder-cli][tui] 修复 CLI 对话流中工具调用阶段的日志顺序：在工具调用前规范化 assistant 文本并分段展示，避免 tool_call 前后回复粘连；新增仅在会话内容区响应鼠标滚轮，防止滚轮误影响输入区。
- [desktop][frontend][ui] Desktop container/system pages now reuse UserTopbar + portal shell layout, restoring consistent title bar style and one-click return to world via topbar navigation.
- [wunder-cli][tui][orchestrator][tools] wunder-cli 修复交互稳定性：默认鼠标模式改为 select 并按模式动态启停鼠标捕获；会话区按真实换行宽度统计滚动行数，/system 长提示词可完整滚动查看，发送新消息时自动回到底部。并增强工具调用解析（支持前缀+JSON 围栏提取）及 read_file 参数兼容（path/file_path/file）。
- [desktop][auth][frontend][backend] Desktop remote mode now requires regular login/register and preserves local desktop token fallback when remote gateway endpoint is invalid.
- [backend][test][build] 修复 tool_calls 测试中的多行字符串语法错误，恢复 cargo check 全量编译通过。
- [wunder-cli][tui][llm] wunder-cli 继续对齐 codex：状态栏移除 ? for shortcuts 文案并显示鼠标模式/F2 提示；修复中文输入在宽字符边界时光标定位异常；增强流式 SSE 与 tool_calls 解析，支持无事件分隔的多行 data 和 message.tool_calls，降低工具调用后无最终回复。
- [backend][subagent][build] 子会话后台运行改为专用 runtime + spawn_blocking，规避 tokio::spawn 的非 Send future 问题，恢复 wunder-server/wunder-desktop 的 cargo check 与 clippy 全绿。
- [蜂群测试][并发统计] 蜂群测试会话子运行改为纯异步调度，移除 spawn_blocking+block_on 带来的并发瓶颈；峰值并发统计新增工蜂口径并将表格默认展示工蜂峰值，避免母蜂计入导致 1 工蜂显示为 2。
- [backend][desktop][build] 移除 src/api/desktop.rs 未使用的 routing::put 导入，恢复 cargo clippy -D warnings 全量通过。
- [backend][build][docker][desktop] 将 tauri/tauri-build 改为 desktop feature 可选依赖并为 wunder-desktop 添加 required-features，默认构建仅编译 wunder-server，避免容器因缺少 GTK 开发包触发 gdk-sys 构建失败。
- [desktop][frontend] desktop 模式退出按钮统一回到 /desktop/home，移除残留 /desktop/chat 跳转，避免页面路径与默认入口不一致。
- [wunder-cli][chat][config] 修复 wunder-cli chat 行式模式在 stdin EOF 下的无限提示循环，并让 /config 优先解析行内参数避免误入交互向导。
### 性能
- [backend][swarm][simlab] 会话子运行调度改为 async spawn_session_run，并将 queued/running/finished 的存储写入移到 spawn_blocking，消除高扇出场景下同步数据库写阻塞事件循环导致的启动节流（峰值并发被压在约20）的瓶颈。
- [backend][swarm][simlab] 放宽蜂群并发上限：默认与示例配置的 max_parallel_tasks_per_team / max_active_team_runs 均提升到 256，并将 server.max_active_sessions 默认提升到 300，避免未加载外部配置时并发被 16/30 限制。

### 文档
- [docs] 补充单端口部署说明，明确 docker compose 下 18001 作为公网入口与内部端口绑定策略
- [docs] 同步更新设计方案/API文档/系统介绍的提示词治理说明，明确 zh/en 目录化、server 与 cli/desktop 运行环境差异及提示词文件优先加载策略。
- [docs][desktop] 同步更新 desktop 实现方案、设计方案、系统介绍与 API 文档，明确 remote_gateway 字段简化与远端登录流程。
- [docs][paper][cli][desktop] 更新 web/docs/paper.md 论文内容：补充 server/cli/desktop 三形态统一内核设计，新增多形态运行架构章节与对比表，并同步到摘要、关键词、部署拓扑、运行时边界、工具协议、工作区策略、运维与结论。
- [docs][设计方案] 重构 docs/设计方案.md：将原第11节后“现状对齐/蜂巢与单蜂巢/Frontend TS/wunder-cli/wunder-desktop”补充并入正文（新增 3.3、5.2.2、5.11、5.12，补充 5.8/6/8/10），并删除末尾补充章节。
- [docs][系统介绍] 重构 docs/系统介绍.md：将第11节后的蜂巢/单蜂巢、前端栈与 server/cli/desktop 运行形态补充内容并入正文（核心能力、业务链路、运行入口），新增 4.4 蜂群协作链路与 9.4 运行形态章节，并删除末尾补充段。
- [docs][readme] 巡检文档一致性：核对 docs/系统介绍.md、docs/设计方案.md、docs/API文档.md 与 wunder-cli/wunder-desktop 方案文档后，确认与 README 的 server/cli/desktop 分层说明一致，本轮无需额外文档改动。
- [readme][docs] 将 README 末尾章节标题恢复为“wunder已吞噬核心”，并同步英文标题为“wunder Devoured Core”。
- [readme][cli][desktop][server] 调整 README 快速开始结构：将 CLI/Desktop 启动示例从“入口与使用”移动到“快速开始”，并按 server/cli/desktop 三条路径明确区分部署与本地运行流程，同时同步 README-English.md。
- [readme][docs][cli][desktop] 优化 README 后续章节：按 server/cli/desktop 重构能力与入口说明，补充 CLI/Desktop 启动示例、持久化目录约定与项目结构，并同步更新 README-English.md 英文版本。
- [desktop][docs][api] Update desktop API/design/system docs for remote_gateway phase-1: dual-token behavior, remote connection status fields, and fallback diagnostics details.
- [desktop][docs][api] 补充 desktop 本地设置接口说明（GET/PUT /wunder/desktop/settings）以及容器管理/系统设置的落地细节与后续远程接入节点。
- [docs][cli] 同步更新 wunder-cli 实现方案、API 文档、系统介绍与设计方案，补充输入区自动折行、Repeat 连续移动与新增键位说明，并清理方案文档中的乱码占位行。
- [docs][desktop] 同步更新 wunder-desktop 实现方案、设计方案、API 文档与系统介绍，明确 Tauri 架构、desktop_runtime_info command 与免登录桌面 UI。
- [docs][desktop] 同步更新 wunder-desktop 实现方案及 设计方案/API文档/系统介绍，明确 M0-M3 落地细节与接口约定。
### 工程
- [desktop][tauri] 将 Tauri 构建生成的 gen/schemas 产物统一约束到 wunder-desktop/gen 并加入 .gitignore，避免仓库根目录散落临时 schema 文件。
- [desktop][tauri] 将 build.rs、tauri.conf.json、capabilities、icons 统一迁移到 wunder-desktop/ 目录，并调整构建脚本兼容新路径。
### 移除
- [prompts] 移除 prompts 根目录旧版提示词文件，仅保留 prompts/zh 与 prompts/en 双语目录作为维护入口。
## 2026-02-10
### 新增
- [desktop][backend] 新增 wunder-desktop 可执行入口与运行时骨架：自动初始化 WUNDER_TEMPD/WUNDER_WORK、加载 desktop.settings、复用 core 编排并启动本地 /wunder 桥接服务（含本地 token 鉴权）
- [backend][cli][docs] 新增 wunder-cli 可执行模块（根目录 wunder-cli），默认交互式会话并支持 ask/chat/tool/exec/mcp/skills/config/doctor 命令；新增 AppState CLI 轻量初始化选项，并通过环境覆盖实现 WUNDER_TEMP 本地持久化、单根工作区与 tool_call/function_call 切换。
- [backend][web][docs] 新增管理端 Simulation Lab：提供 /wunder/admin/sim_lab/projects 与 /wunder/admin/sim_lab/runs 接口，并在调试导航接入可切换项目的模拟测试页面，支持基于预置母蜂/工蜂流程的 swarm_flow 全链路仿真与报告展示。
- [backend][swarm] 智能体蜂群(agent_swarm)新增 batch_send/wait：一键并发派发多工蜂并基于 session_runs(run_id) 等待/收敛结果，减少母蜂手动轮询
### 变更
- [web][simlab] 蜂群测试左侧移除测试项目配置区并默认自动选中项目，进一步压缩设置区占用空间。
- [web][simlab] 蜂群测试页面改为表格化测试报告，隐藏测试项目选择区，并将测试历史改为自适应撑满剩余高度。
- [wunder-cli][tui] 新增 max_rounds 可视化：/status、config show 与 TUI 顶部状态栏均显示当前生效轮次，便于排查会话早停。
- [wunder-cli][tui] wunder-cli TUI 会话区新增可滚动能力（PageUp/PageDown/Home/End），状态栏显示滚动偏移，支持查看底部之外的历史内容。
- [swarm][sim_lab] 优化 agent_swarm 的 batch_send 派发逻辑，改为并发提交子任务并按原索引回填结果，减少批量下发阶段的串行阻塞。
- [sim_lab][web] 蜂群测试页移除保留测试产物选项；左侧底部改为测试历史（支持点击还原历史结果）；右侧新增详细报告面板并移除 点击标题可展开详细报告提示，报告列表改为一键查看详情。
- [wunder-cli] wunder-cli TUI 的 /config 新增分步引导配置（base_url -> api_key -> model），支持空输入或 /cancel 取消，并复用统一模型写入逻辑。
- [backend][cli] wunder-cli 交互命令与 codex-main 对齐升级：slash 命令统一路由，新增 /status /model /tool-call-mode(/mode) 的会话内配置能力，保留 chat 行式模式作为非 TTY 与脚本场景兜底。
- [backend][cli] wunder-cli 引入 codex 风格 TUI：无子命令默认进入全屏终端界面，新增 tui/mod.rs + tui/app.rs + tui/ui.rs 分层结构，支持状态栏/会话区/命令提示/输入区与流式事件实时渲染。
- [backend][cli] 对齐 codex-main 交互风格：wunder-cli 新增 slash_command 路由模块，统一解析 /help /status /model /tool-call-mode(/mode) /config /new /session /exit，并对未识别 /xxx 提示 unknown command。
- [backend][cli][docs] 增强 wunder-cli 运行时兜底能力：缺失仓库配置时自动生成 WUNDER_TEMP/config/wunder.base.yaml，prompts 路径缺失时自动回退内置模板，并优化 doctor 输出为 <embedded>。
- [wunder-cli][runtime] wunder-cli 启动时若缺少 config/wunder.yaml 将自动生成 WUNDER_TEMP/config/wunder.base.yaml，避免配置缺失告警；doctor 对 prompts_root 未配置场景显示为 embedded。
- [wunder-cli][prompting] 将核心提示词改为程序内置模板（支持外部覆盖回退），并改进 CLI 错误渲染：优先展示 message/detail/error，避免显示 unknown error。
- [sim_lab][swarm][admin-web] 蜂群测试改为单按钮开始/停止，并将模拟执行绑定真实 wunder-sim 账号重建工蜂应用，修复并发峰值受限与状态显示不一致问题。
- [wunder-cli][orchestrator][storage] wunder-cli 交互态新增 /config 三段引导配置（base_url/api_key/model），并完善 provider 推断与默认模型落库逻辑；同时修复 stream_events MAX(event_id) 空会话读取与 LLM unavailable detail 展示。
- [web] 优化管理端 Simulation Lab 页面：重构项目选择区为卡片布局避免内容挤压，新增测试摘要卡与项目级可折叠报告视图，并保留原始 JSON 报告按需展开查看。
- [frontend][chat] 聊天输入框新增命令候选列表：在输入 / 后显示 /new /stop /compact /help 提示，支持鼠标点选和 Up/Down + Enter/Tab 快捷补全，Esc 可收起提示弹层。
- [蜂群模拟][可观测性] 修复 swarm_flow_sim 指标不稳定：回归前主动 flush 写队列，工蜂轮次改为按已观测工具推进，并优先从母蜂 tool_result 映射 worker 会话；报告新增 P50/P95 队列/执行/端到端时延。
- [frontend][backend][docs] 用户侧聊天新增本地指令 /new /stop /help /compact（含输入框提示），/new /stop /help 在前端本地执行不再透传模型，/compact 通过新增 /wunder/chat/sessions/{session_id}/compaction 触发上下文压缩，并补充 README 与 API 文档说明。
- [frontend][chat] 聊天页面初始化后自动滚动到消息列表底部，确保进入页面可直接看到最新消息。
### 修复
- [wunder-cli][prompt] 修复在 target/debug 等构建产物目录启动 wunder-cli 时上下文树过大导致模型无回复的问题：工作区树新增目录跳过与行数/每层条目上限，避免首轮上下文异常膨胀触发空流。
- [web][simlab] 修复蜂群测试报告副标题分隔符编码，移除字面量转义导致的 \u00b7 显示异常。
- [wunder-cli][tui] 统一将 CLI/TUI 的有效 max_rounds 下限提高到 8（请求覆盖 + /config 写入 + 状态展示），修复 TUI 场景下仍出现‘未能在最大轮次内生成最终答复’的问题。
- [web][simlab] 修复蜂群测试页面中文文案乱码，恢复 i18n 与页面回退文案的可读中文。
- [wunder-cli][配置] wunder-cli 在请求覆盖中新增 max_rounds 兜底策略（缺省=8，最小=2），避免旧配置出现 未能在最大轮次内生成最终答复。
- [wunder-cli][orchestrator] 修复 wunder-cli 对话易触发 未能在最大轮次内生成最终答复：/config 写入模型配置时默认将 max_rounds 设为 8（至少 2），避免工具链路首轮后因轮次过低提前终止。
- [wunder-cli][tui][llm] 修复 wunder-cli 事件解析兼容：对 stream 事件统一解包 data.data 负载，解决配置后有 progress 但无正文/最终回复的问题。
- [wunder-cli][llm] 修复流式回包兼容性：当上游返回不带 data: 前缀的原始 JSON 块时，wunder-cli 仍可在 stream 模式解析正文并避免仅出现无回复告警。
- [wunder-cli][llm] 修复流式解析：支持 SSE 事件块解析、尾块无换行和无 [DONE] 场景，补齐 delta/message 文本回退，避免仅显示 progress 而无最终回复。
- [config][storage][docker] 修复配置合并策略：override 中空字符串不再覆盖基础配置，避免 data/config/wunder.override.yaml 的空 storage/sandbox 字段导致启动后误回退 SQLite、未按 config/wunder.yaml 使用 Postgres。
- [backend][cli] 修复流式响应尾缓冲解析：当 LLM 流结束但缺少 [DONE] 或末尾无换行时，补充解析剩余 SSE 数据行，避免 TUI/CLI 仅显示 progress 不输出最终回复。
- [backend][cli] 修复 wunder-cli 本地交互配置与错误反馈：/config 支持按 base_url/api_key/model 引导写入默认模型；流式错误事件可解析 message/detail/error，模型未配置时不再显示 [error] unknown error。
- [sim_lab][web] 修复蜂群测试页面缓存未刷新导致旧脚本残留：更新 app.js 版本戳并修正 sim_lab 预置上下文写入换行，确保开始/停止按钮状态与报告刷新按新逻辑生效。
- [sim_lab][frontend] 修复模拟测试页误判为“测试中”且按钮无响应：新增 run 状态探测接口 /wunder/admin/sim_lab/runs/{run_id}/status，前端进入页面自动校准卡死状态并在导航切换时刷新。
- [api][sim_lab] 修复 Axum 路由参数语法，/wunder/admin/sim_lab/runs/{run_id}/cancel 使用 {run_id} 避免启动时因 :run_id 触发 panic。
- [sim_lab][frontend][api] 修复模拟测试页在未激活时仍显示（系统提示词页乱入），默认工蜂改为100，并新增运行中动画与可停止（/wunder/admin/sim_lab/runs/{run_id}/cancel）能力。
- [core] 修复 src/core/state.rs 中注释与错误提示的乱码问号文本，统一为 UTF-8 可读中文提示。
- [frontend] 修复聊天页沙盒容器右键菜单在深色主题下 hover 视觉交互不明显的问题，并调整菜单阴影与选中性能使其更扁平。
- [backend][swarm] 修复 TeamRun 在任务尚未全部入库时被 Runner 提前拉起导致部分任务长期 queued 的并发竞态；新增 preparing->queued 发布流程、Runner 任务就绪等待与未终态任务兜底收敛，避免 run=success 但 task=queued；同时为 SQLite 连接增加 busy_timeout 提升高并发稳定性。
- [frontend][chat][workspace] 修复深色主题下聊天页沙盒临时文件区右键菜单悬停无反馈问题，并统一浅/深主题菜单为更扁平的交互样式。
- [backend][i18n] 修复 agent_swarm 新增文案的中文编码，确保 config/i18n.messages.json 中蜂群相关 zh-CN 文案为可读 UTF-8 中文且不出现字面量 Unicode 转义。
- [backend][i18n] 修复智能体蜂群新增文案的中文编码显示，移除 JSON 中 Unicode 转义并统一为可读中文，避免前端/配置查看出现\uXXXX 文本。
- [frontend][chat] 修复聊天页 MessageWorkflow visible 可能为 undefined 的传值问题，将 loading 与 visible 均显式归一化为布尔值，消除 Invalid prop 告警。
- [frontend] 继续收敛并清空 Vue SFC 类型错误：补齐组件与 API 参数类型、事件目标类型与上传配置类型，确保 typecheck/typecheck:ts/build:check 全部通过
- [frontend] 继续收敛 TS 迁移遗留并完成 Vue SFC 类型修复：npm run typecheck 与 npm run typecheck:vue 均通过，build:check 通过
- [frontend] 收敛用户侧前端 JS->TS 迁移遗留：修复类型漂移、移除隐藏 BOM/乱码前缀并清理 i18n 重复键，恢复 typecheck 与 build:check 可通过
- [frontend][docs] 移除前端 TS/Vue 文件中的 @ts-nocheck 标记并统一清理 TS 文件 BOM（U+FEFF 不可见字符）
### 性能
- [workspace][prompt] 限制工作区树快照规模（最大 320 行、每层最多 120 项），并过滤 .git/target/node_modules/WUNDER_TEMP 等高噪目录，显著降低提示词上下文占用。
### 文档
- [desktop][docs] 新增 wunder-desktop 实现方案，明确桌面端架构、目录落盘、WS/SSE 通讯、MCP/Skills 与 tool_call/function_call 切换节点
- [docs][cli] 同步 wunder-cli 实现方案/API/设计方案/系统介绍：补充默认 TUI 行为、tui 模块分层、slash 命令矩阵及 /config 在 TUI 与行式模式的差异。
- [docs][cli] 同步 wunder-cli 文档到最新交互能力：补充 slash_command.rs 模块、/status /model /tool-call-mode 命令说明与 codex 风格行为描述。
- [docs][cli] 修复 wunder-cli 相关文档中的中文问号乱码，统一更新 docs/方案/wunder-cli实现方案.md、docs/API文档.md、docs/系统介绍.md、docs/设计方案.md 的配置兜底描述。
- [docs][wunder-cli] 补充 wunder-cli 实现方案与 API/设计/系统文档：新增提示词内嵌策略、/config 交互命令行为、静态部署与故障修复说明。
- [docs][cli] 同步 docs/方案/wunder-cli实现方案.md 的命令面说明，补入 resume、mcp get 与 exec 别名 e 等已落地能力。
- [docs][cli] 修复 docs/API文档.md、docs/设计方案.md、docs/系统介绍.md 中 wunder-cli 章节中文乱码，恢复 UTF-8 文本表达。
- [docs][cli] 修复 docs/方案/wunder-cli实现方案.md 中文乱码，恢复 UTF-8 正文并保留用户原始任务段落。
- [docs][cli] 新增 docs/方案/wunder-cli实现方案.md，明确单用户本地模式、WUNDER_TEMP 持久化布局、tool_call/function_call 切换、MCP/skills 管理与分阶段实施节点。
- [docs][swarm] 补充 /wunder/chat/team_runs 创建阶段 preparing -> queued 两阶段发布语义，说明用于避免 Runner 并发扫描抢跑导致任务遗漏。
- [readme][channels] README 与 README-English 新增渠道控制命令说明，补充 /new、/reset、/stop、/cancel、/help、/? 的用途与生效范围。
- [backend][docs] 新增后端优化方案，完成 Rust 后端高并发与高稳定性瓶颈审查并给出分阶段落地计划（存储异步化、会话锁、流事件、队列与可观测性）
- [docs][系统介绍] 在 docs/系统介绍-简.md 新增对外宣传版（100字以内），用于官网与README快速引用。
- [docs][系统介绍] 新增 docs/系统介绍-简.md，补充智能体应用化、线程调度、模型动作循环、蜂群协作与长期运行能力的极简说明。
- [docs] 更新用户侧前端加速方案：移除部署模式相关内容，聚焦开发模式下绝对性能提升与可回归指标
- [docs][swarm] 更新API文档与i18n：智能体蜂群新增 batch_send/wait 动作说明与并发编排推荐流程
- [frontend][docs] 新增用户侧前端加速方案文档，明确秒进目标、分阶段改造路径与验收指标
- [skill][并发] 补充并发与会话排查经验到 EVA_SKILLS/wunder-agent-dev（session_id 粒度、/wunder 主会话忙时分叉、回归清单）
- [skill][并发] 补充 EVA_SKILLS/wunder-agent-dev 经验技巧：明确 session 粒度并发、隐式会话忙时分叉策略、前端切页误中止排查与并发回归清单。
### 重构
- [frontend][typescript] 继续收敛前端 TS 迁移遗留：统一补全 src/api 参数与载荷类型、移除业务代码显式 any/as any（含 chat/workspace/cron/channel 等关键路径），并将 vue-tsc/build 检查保持为 0 错误。
- [frontend][docs] 完成用户侧前端 JS 到 TS 全量迁移：src 下业务 JS 清零、全部 Vue 脚本改为 lang=ts，并新增 typecheck/build:check 工程门禁

### 工程
- [frontend][typescript] 新增严格类型检查脚本：引入 frontend/tsconfig.api-strict.json 与 npm script typecheck:api，用于在不影响现有构建的前提下对 API 层开启 noImplicitAny。
### 测试
- [wunder-cli] 回归验证 target/debug 目录直接运行 wunder-cli ask 你好 可正常返回回复，context_usage 从 ~86k 降至 ~6.6k。
- [wunder-cli] 回归验证低轮次配置（max_rounds=1）下 CLI 仍可正常返回回复，确认请求覆盖兜底生效。
- [wunder-cli] 新增 build_request_overrides 单元测试，覆盖 max_rounds 缺省/过低兜底与 tool_call_mode 覆盖行为。
- [llm] 新增 LLM 流式回归测试：覆盖无 [DONE] 且尾块无换行的 SSE 返回，确保仍能提取最终文本回复。
- [蜂群模拟][teamrun] 新增 swarm_flow_sim 端到端深度仿真：母蜂预制文本触发蜂群工具、工蜂两轮工具调用反馈、母蜂汇总收敛，全流程不依赖外部大模型输出。
- [backend][swarm] 新增 src/bin/swarm_flow_sim.rs：本地可执行的母蜂-蜂群-工蜂两轮工具调用全流程模拟（预制模型响应 + 真实工具执行 + 汇总收敛），可输出并发、轮次、工具调用与完成率指标，便于对齐 TeamRun Runner 真实体验与后续性能优化。
- [backend][scripts][docs] 完善 backend_sim 回归流程：新增 run_id 隔离运行目录、关闭 cron/agent_queue/channels/gateway 背景干扰，并在三场景工作流中加入基线比例阈值策略（effective p95=max(静态阈值, baseline*p95_ratio)）。
- [backend][scripts][docs] 新增 run_backend_sim_workflow.py 三场景回归脚本（baseline/compare/quick），并补充后端模拟测试说明中的一键工作流与场景阈值说明。
## 2026-02-09
### 新增
- [渠道][飞书] 飞书入站消息新增即时处理中回执：先回复 已收到消息，正在处理中，请稍后。再发送最终结果
### 变更
- [web][admin][ui] 管理员侧侧边栏导航滚动容器隐藏滚动条（保留滚轮滚动能力），避免滚动条挤压条目内容。
- [backend][frontend][swarm] 移除多蜂巢交互与接口依赖，统一回归单蜂巢 default 运行模式
- [frontend][web] 统一品牌文案：用户侧将蜂巢命名调整为世界，将智能体交互系统更名为智能体控制系统；管理员侧将 wunder终端 更名为 wunder引擎。
- [frontend][chat] 优化用户侧聊天会话外部消息同步：新增后台定时拉取会话更新并在活动会话更新时间推进时自动刷新详情，支持草稿态自动接入新会话，减少渠道消息需手动刷新才能看到的问题。
- [frontend] 用户侧前端根路由改为默认进入登录页；已登录则直接跳转蜂巢(/app/home)，并避免登录/注册页在已登录时可访问。
- [frontend][web] 用户侧蜂巢入口改为顶部标题悬浮面板（支持切换/创建蜂巢），并移除管理员侧蜂群运行与蜂巢概览页面入口。
- [channels] 飞书渠道入站统一落到智能体应用主线程会话：强制使用账号配置的agent_id，并将session_strategy固定为main_thread，群聊/单聊共享同一主会话承接上下文；同时在缺少绑定时将渠道工作区user_id稳定为 chan:{channel}:{account_id}。
- [frontend] 聊天页移除侧栏蜂群运行卡片，改为标题栏蜂群按钮并使用弹窗展示 SwarmPanel（含弹窗内列表与任务泳道样式）。
- [frontend][web/admin] 按反馈回退蜂巢页视觉：移除顶部统计卡片并恢复卡片式智能体列表（取消六边形样式），同时继续加固管理端中文编码兼容。
- [frontend][web/admin] 用户侧蜂巢页面卡片样式回退：移除六边形裁剪，恢复矩形卡片观感；同时为管理端 i18n 字典与页面增加 UTF-8 BOM 以减少中文乱码风险。
- [web/admin] 管理端蜂群面板增强：空态/提示语i18n化，支持蜂巢筛选记忆与语言切换后重渲染。
- [backend][frontend][web][docs] 完善蜂巢蜂群落地收尾：补齐管理端蜂群导航与面板接线、修复中文文案编码可读性，并完成全量校验。
- [backend][frontend][docs] 完成蜂巢化智能体蜂群落地：新增hives/team_runs后端模型与API，agent_swarm按hive_id隔离，前端新增Beehive页面（蜂巢切换/创建/统计/六边形卡片/批量迁移），聊天页新增SwarmPanel并补充team事件回放与相关文档。
- [frontend][世界页] 用户侧世界页将 更多应用调整为标题行按钮，点击后再展开外链应用列表，默认收起。
- [渠道] 用户侧渠道默认绑定支持写入agent_id，渠道账号按智能体隔离展示与路由
- [渠道][前端][管理端] 重构渠道体系：管理端渠道页改为纯监控视图（移除配置入口），用户侧渠道设置支持按渠道新增/编辑/删除账号并保留飞书长连接快捷配置。
- [backend/channels][web/admin][frontend][docs] 飞书接入流程简化：active 账号仅需 app_id/app_secret 即可自动长连接（不再依赖用户绑定）；管理端与用户端文案同步精简，并支持飞书账号为空时自动用 app_id 作为 account_id。
- [docs][架构图] 按旧版视觉风格回退架构设计的部署拓扑图，恢复分区配色与左右布局，同时保留当前模块命名。
- [backend/channels][web/admin][docs] 管理端渠道列表新增飞书长连接 runtime 展示：/admin/channels/accounts 返回 runtime.feishu_long_connection（状态与绑定计数），并在渠道管理页显示运行态，便于排查未启动原因。
### 修复
- [docs][frontend] 修复 docs/方案/用户前端JS到TS完全迁移方案.md 中文乱码，改为 UTF-8 正常可读版本
- [frontend][会话] 切换智能体时先进入目标草稿态并锁定自动回跳，避免异步加载期间误发到旧会话引发流取消，从而支持多智能体任务并行。
- [backend][并发] 调整隐式会话请求的调度策略：当主会话忙碌时自动分叉新会话执行，避免 /wunder 场景被主会话串行化导致多应用并行被中止。
- [frontend][chat] 修复切换到新建线程草稿时误中止当前会话流的问题，允许不同智能体/线程任务后台并行运行，不再被前端切页动作取消。
- [frontend][chat] 修复聊天页外部会话同步与新建线程冲突：新增手动新建线程保护标记，草稿态不再被后台自动同步回切旧会话，并在会话切换后自动解除保护，恢复多会话并行运行与新线程创建流程。
- [frontend] 路由守卫新增登录态校验：token 失效或缺失时不再弹出 error.auth_required，直接清理登录态并跳转登录页。
- [docs][encoding] 修复设计方案/系统介绍/API文档新增段落的中文乱码，统一 UTF-8 内容写入
- [frontend][beehive] 修复蜂巢标题悬浮菜单无法稳定点击的问题，优化悬浮过渡并保持弹窗可交互
- [backend][beehive] 修复蜂巢预置智能体并发初始化导致重复应用的问题，并在加载时清理默认蜂巢中重复预置项
- [docs][backend][frontend] 修复蜂巢相关文档与默认蜂巢文案的中文乱码（问号占位符）问题，恢复 UTF-8 中文文本。
- [channels][frontend] 渠道入站请求改为stream模式执行并保留连续event_id，修复前端watch/resume在处理过程中无增量更新的问题。 补充渠道最终回复兜底文案，避免模型异常返回空文本时飞书侧出现 (empty message)。
- [channels][orchestrator] 修复飞书渠道长连接回包解析错误，正确从流事件 data 字段提取 final/error 内容，避免回复 (empty message)。 修复会话流事件 ID 在多轮运行后回绕导致 watch/resume 无增量事件的问题，改为从存储连续续号，前端可实时看到渠道消息处理进度与最终回复。
- [frontend][i18n] 优化 chat glass-card 视觉层次（暗/亮主题与低功耗模式均保留卡片区分），并修复 config/i18n.messages.json 中 hive_id 文案被 Unicode 转义显示的问题。
- [frontend] 还原用户侧首页为原有卡片式 Portal 样式：撤回蜂巢页面路由替换与 beehive.css 样式注入，移除顶部统计卡片与六边形视觉回归风险。
- [web][外链管理] 管理员外链管理页面将保存按钮移到删除按钮左侧，并修复通知调用为统一 notify(type) 形式，新增外链 URL 格式校验与错误提示。
- [渠道][飞书] 渠道长连接加入消息去重与忙碌提示，支持 /new /stop /help 指令并补齐忙碌回复写入会话
- [frontend] 优化用户侧渠道设置布局：区分创建/详情区域视觉层级，简化渠道列表卡片信息展示。
- [backend][channels][storage] 修复渠道会话 thread_id 为空导致 channel_sessions 入库失败的问题，统一以空字符串持久化并在读取时还原；入站绑定增加按账号唯一 agent_id 回退，避免无法路由。
- [存储] 渠道 启动补齐channels相关表字段，避免旧库缺列导致db error
- [渠道] 修复渠道限流首次请求即被拒的问题
- [frontend] 修复用户侧渠道设置弹窗样式异常，恢复布局并统一关闭按钮显示。
- [backend][frontend] 修复聊天会话锁释放竞态导致的“用户会话运行中”误报，并完善刷新后流式续传对 llm_output_delta 分段事件的解析与续拉策略。
- [docs][架构图] 修复架构设计部署拓扑 Mermaid 子图标题包含括号导致的解析报错，改为兼容写法并统一关键节点标签引用格式。
- [backend/channels][frontend][docs] 飞书长连接启动策略调整：仅对 active 且存在用户侧绑定的账号启动长连接（用户保存渠道绑定后自动触发），并同步更新用户端提示与文档说明。
- [backend/channels][frontend][docs] 飞书渠道对齐：绑定 peer_kind 新增 direct/user 同义匹配并在用户侧保存时将 feishu 的 dm/direct/single 归一为 user，补充长连接事件与出站失败日志，修复用户侧飞书提示文案及相关文档乱码说明。
- [backend][channels][frontend] 修复飞书长连接仅连通不回包的问题：补齐TLS能力、增加长连接入站错误日志与sender_id回退匹配，并在用户侧渠道页按receive_id_type给出peer_id/peer_kind填写提示。

### 性能
- [渠道][会话] 渠道入站后主动touch会话更新时间，提升用户前端会话列表与详情渲染及时性
### 文档
- [frontend][docs] 补充用户侧前端 JS→TS 完全迁移方案（含节点拆分、优先级与验收门禁）
- [docs][叙事] 简化并美化《wunder隐喻》角色与约束关系示意图：改为单主链路+边界控制+资产回注结构，并加入分组配色提高可读性。
- [docs][叙事] 为 docs/wunder隐喻.md 补充三张 Mermaid 示意图：角色约束关系图、单次出击时序图、轮回迭代补完图。
- [docs][叙事] 优化《wunder意象对应》叙事基底：明确用户=指挥员、LLM=驾驶员（灵魂）、智能体=机体（被拘束的肉体），并补充朗基努斯之枪/心之壁/补完与系统边界治理映射。
- [docs][叙事] 新增《wunder意象对应》文档，补充系统页面、元素、模块、工具与概念的 EVA Wunder 舰船意象对应表。
- [docs] 调整蜂群方案为按蜂巢分组：取消容器id分组，新增蜂巢创建与切换流程，并同步重写R0-R8代码级改造清单。
- [docs] 新增《智能体蜂群R0-R8代码级改造清单》，细化后端/前端/web管理端分阶段文件级任务与验收清单。
- [渠道][api] 更新渠道接口文档与设计说明，补充用户侧多账号配置流程、带 account_id 的删除接口，以及管理端渠道监控定位。
- [docs] 重构《智能体蜂群落地方案》：新增中度重构蓝图（SwarmService/SwarmRepo/beehive store）、R0-R8里程碑与灰度回滚策略。
- [docs] 完善《智能体蜂群落地方案》：增加同 sandbox_container_id 蜂群作用域、接口与事件约束、蜂巢页面容器化展示与验收节点。
- [readme][docs] 按命名偏好调整 README-English 标题：Core Projects Devoured by wunder 改为 wunder Devoured Core。
- [readme][docs] 同步中英参考章节命名：README 中文改为 wunder已吞噬核心 后，README-English 标题调整为 Core Projects Devoured by wunder。
- [docs] 新增《智能体蜂群落地方案》，明确蜂群编排模型、数据结构、事件协议、前后端落地节点与验收标准。
- [readme][docs] 增强 README-English 参考项目章节语气：标题由 Projects Absorbed by wunder 调整为 Projects Devoured by wunder。
- [readme][docs] 调整 README 吞噬项目章节：移除中文说明句并同步到 README-English，新增同列表英文章节 Projects Absorbed by wunder。
- [readme][docs] 在 README 底部新增《wunder已吞噬项目》章节，补充 EVA、Codex、Claude Code、OpenClaw、OpenCode 的参考来源链接说明。
- [docs][readme] 修复文档一致性：统一 README/README-English 用户前端端口说明（开发18001、生产18002）并修正测试方案路径；更正用户手册旧命名与用户前端方案旧项目引用；修复 WebSocket-Transport 跨文档引用路径；同步中英叙事文档为 WS 优先、SSE 兜底表述。
- [docs][审计] 全仓文档一致性巡检：标记 README/README-English 端口与测试方案路径不一致、Wille 旧命名残留及 WebSocket-Transport 引用路径失效等待更新项。
- [eva_skills][wunder-agent-dev][skills] 在 EVA_SKILLS/wunder-agent-dev/SKILL.md 补充文档与图表维护经验，新增 Mermaid 兼容、mmd->svg/png 同步、paper 链接规范、DOCX 嵌图验收与渲染环境排障技巧。
- [docs][paper][docx] 重生成 docs/智能体调度平台的设计与实现.docx（来源 web/docs/paper.md），修复部署拓扑图链接参数导致的图片漏嵌入问题，确保 7 张系统图全部正确内嵌。
- [web/docs][paper][图表] 更新 web/docs/paper.md 论文内容以对齐当前架构：补充 AgentRuntime/ChannelHub/GatewayHub、WS优先SSE兜底、api/sandbox 双模式与 37 张核心表说明；并重绘系统介绍 01-07 图表后同步到 web/docs/diagrams/system-intro。
- [docs][架构][数据库][系统介绍] 将架构设计、数据库设计、系统介绍中的 Mermaid 图表从附录回填到对应章节，并按当前代码更新 AgentRuntime 队列、ChannelHub/GatewayHub 链路、向量知识流与数据生命周期图。
- [docs][图表] 恢复并补回架构设计、数据库设计、系统介绍中被删的 Mermaid 图表，按附录图表恢复区保留原始图示。
- [docs][架构][数据库][系统介绍] 重写架构设计、数据库设计、系统介绍文档并补充设计方案现状对齐，覆盖双模式运行、三链路入口、37张核心表与治理机制。
### 移除
- [frontend][chat] 移除用户侧聊天页顶部蜂群运行入口按钮与对应弹窗触发逻辑，简化聊天页面操作。
## 2026-02-08
### 新增
- [backend][web][docs] 新增内置工具智能体蜂群，支持跨智能体 list/status/send/history/spawn 管理，并为内部状态热力图配置蜜蜂图标。
- [frontend][backend][cron] 用户侧定时任务页面新增简化版新建入口，可填写模型消息、发送时间并选择一次性/重复任务；重复任务支持以指定发送时间作为首触发锚点。
### 变更
- [backend][config] 用户侧默认预置智能体改为读取 user_agents.presets 配置，支持按名称/提示词/图标/容器编号调整而无需改 Rust 代码。
- [mcp_server][database][docs] db_query按表工具新增强约束，仅允许访问绑定表；并完成独立MySQL双表示例联调验证
- [mcp_server][docs] MCP数据库与知识库工具改为按配置动态注册，db_query内置精简schema提示并压缩返回结构
- [backend][monitor][storage] 新增监控最近记录限量加载接口并在 warm_history 启用，避免冷启动默认全量拉取 monitor_sessions。
- [web][monitor] 新增本地 fa-bee 图标资源并为热力图补充自定义渲染样式，支持显示蜂群工具蜜蜂图标。
- [web][monitor] 将内部状态热力图 智能体蜂群图标从 fa-bug 调整为 fa-hexagon-nodes，以匹配蜂群协作语义。
- [web][monitor] 将内部状态热力图中 智能体蜂群图标由 emoji 蜜蜂改为 Font Awesome fa-bee，统一视觉风格。
- [backend][frontend][docs] Add global chat stream channel policy (ws/sse) in admin settings; user chat/send/resume/watch now follows the policy with consistent WS/SSE event semantics.
- [frontend][ui] 世界页面智能体卡片悬停取消位移动画，仅保留边框与阴影过渡，降低鼠标停留时的闪动感。
- [frontend][portal][chat][agent][ui] 统一用户侧新建智能体与聊天页智能体设置弹窗样式为同一编辑器；并将工具/技能挂载区前置到基础设置之上，合并共享与沙盒容器设置为同一卡片。
- [frontend][ui] 进一步将聊天页与世界页Topbar改为固定高度并统一响应式不换行策略，降低页面切换剩余抖动
- [frontend][ui] 统一用户侧聊天页与世界页Topbar的高度和内边距基线，切换页面时减少顶部抖动感
- [frontend][chat][cron][ui] 聊天页定时任务弹窗将 新建任务改为独立配置窗口（不再内联展开），并将功能菜单中的智能体设置调整为首项。
- [web][monitor][ui] 线程详情弹窗高度提升为 90vh，与线程状态弹窗保持一致，避免视觉高度落差。
- [web][monitor][ui] 线程详情事件标签调整为“#event_id 事件类型”并统一左对齐，提升多条事件纵向浏览时的工整度。
- [frontend][portal][ui] 调整智能体卡片闹钟布局，将闹钟与容器ID归为同一右侧分组显示，图标位置更靠近容器ID。
- [frontend][portal][ui] 将智能体卡片定时任务闹钟提示改为灰色，并恢复通用应用卡片底部元信息展示（默认入口与容器编号）。
- [frontend][portal][cron] 智能体应用卡片在容器编号行中间新增定时任务闹钟图标提示，并基于定时任务列表自动识别对应智能体。
### 修复
- [backend][channels] 补齐飞书渠道长连接客户端，active账号自动建立并维持长连接并将消息事件接入ChannelHub主链路，同时支持feishu.long_connection_enabled开关。
- [chat][orchestrator][frontend] 修复超长上下文触发报错后 WebSocket 流未自动收尾的问题：错误事件会结束本次流请求并自动清理运行态；同时将用户消息持久化延后到首轮模型调用成功后，避免失败轮次的超长消息再次被带入后续请求。
- [web][monitor] 按视觉反馈将内部状态热力图 fa-bee 自定义图标缩放调整为 1.45。
- [web][monitor] 继续放大内部状态热力图 fa-bee 自定义图标（scale 1.22 -> 1.32），改善与其他图标的视觉一致性。
- [web][monitor] 修复内部状态热力图自定义 fa-bee 图标视觉偏小：增加缩放系数并保持中心对齐。
- [web][monitor] 修复内部状态热力图 智能体蜂群图标不显示：改用 Font Awesome 可用图标 fa-bug。
- [管理端设置][聊天通道] 修复管理员系统设置中聊天通道文案乱码，并让用户侧 SSE 监看在空闲断开后自动重连，减少与 WS 行为差异。
- [frontend][chat][agent][ui] 修复聊天页智能体设置中头像面板默认折叠问题，改为打开弹窗时默认展开；头像颜色的默认项文案由 默认改为Aa。
- [backend][web][docs] 线程详情按用户轮次新增 user_input 事件，并在详情列表优先展示用户消息，便于快速定位问题。
- [frontend][chat][cron] 补齐聊天页定时任务弹窗的新建任务入口与创建表单，支持在会话内直接配置一次性/重复任务并在打开弹窗时初始化发送时间。
- [web][monitor][ui] 固定线程详情弹窗高度并将内部内容改为分区滚动，避免事件数量变化导致弹窗高度抖动；问题与事件列表改为各自滚动显示。
- [web][monitor][i18n][ui] 修复线程详情筛选栏 i18n key 直接显示问题，增加 monitor 详情过滤文案兜底翻译；并优化筛选栏与日志列表间距及事件标签固定宽度，提升可读性。
- [frontend][portal][cron] 修复通用应用卡片未显示定时任务闹钟图标的问题，默认会话定时任务（空 agent_id/session_target=default）也会正确标记。
- [frontend][chat] 修复定时任务回流期间并发发送消息导致的轮次错绑，避免用户消息重复渲染与历史助手回复被复用。
- [backend][frontend][cron][chat] 修复定时任务在管理员会话中的并发执行导致消息顺序乱序问题，并调整聊天消息渲染 key 生成策略以稳定工作流实时渲染。
- [backend][monitor][thread] 优化线程详情事件记录：非管理员会话默认不再写入 llm_output_delta，仅保留 llm_output 等汇总输出；管理员调试会话仍保留增量输出事件。
- [frontend][chat][cron] 修复聊天页定时任务功能弹窗运行记录左侧列表未撑满高度导致底部留白的问题，改为在双栏布局中随容器自适应填充。

### 性能
- [backend][monitor][workspace] 工作区容量统计改为增量计数+周期全量校准：监控按用户目录分批轮询更新容量，保留定时全量重建以控制误差与稳定性风险。
- [backend][auth][gateway] 将鉴权中间件、用户解析与网关握手中的同步存储调用改为 spawn_blocking 桥接，降低 Tokio worker 阻塞风险。
### 文档
- [mcp_server][docs] 将 mcp_server README 的 2.1-2.4 配置说明改为中文，补充多库多表与强约束用法示例
- [mcp_server][docs] 补充 mcp_server README：新增多库多表配置规则、强约束说明与单库/多库/多知识库完整示例
- [docs][backend] 新增《阶段123优化清单》，明确阶段1-3任务项、验收标准与完成状态。
### 重构
- [backend][web][monitor][observability] 重构日志与线程详情追踪体系：监控会话引入 normal/debug 日志画像、trace_id 与事件 event_id，普通画像自动聚合高频增量并递归裁剪字段；管理端线程详情新增事件类型筛选与关键词检索。
### 工程
- [backend][quality][clippy] 修复 clippy 告警并清理代码异味，确保 cargo clippy --all-targets -- -D warnings 通过。
### 测试
- [backend][monitor][observability] 新增监控日志画像回归测试，覆盖普通用户与管理员调试会话在 llm_output_delta/tool_output_delta 采集差异、log_profile 归类与事件 event_id 连续性。
## 2026-02-07
### 新增
- [backend][frontend][workspace][api][docs] 智能体应用新增 sandbox_container_id（1-10，默认1），工作区按 user+container 路由，支持同容器协作与跨容器隔离；同步完成前端配置入口、存储迁移与API文档更新。
### 变更
- [frontend][chat] 聊天页沙盒容器标题右侧容器ID改为紧邻标题的纯数字展示，不再右侧对齐。
- [frontend][portal][chat] 优化容器ID展示为右侧文本样式（去徽章化），并修复世界页智能体卡片 hover 上浮时顶部被滚动容器裁切的问题。
- [frontend][chat][portal] 用户侧前端智能体卡片显示容器ID并按容器ID聚合排序，聊天页沙盒容器标题展示当前容器ID。
- [backend][agent][skill] 预置示例智能体容器编号改为从2开始顺延（文稿校对到公文写作为2~6），保留通用应用/默认工作区容器为1。
- [frontend][portal] 世界页主区域改为分层比例布局（智能体应用区:更多应用区≈2:1），并让两个区域各自滚动，减少更多应用上移导致的主区局促感。
- [backend][api][agent] 预置示例智能体默认分配不同 sandbox_container_id（文稿校对/数据分析/科学绘图/政策分析/公文写作分别为2~6）；对历史用户执行一次容器布局迁移（仅修正仍为默认容器1的预置项），避免覆盖用户自定义容器设置。
- [frontend][chat] 聊天页功能菜单新增当前通讯通道展示（WS/SSE）：点击功能按钮弹出菜单时在顶部显示实时通道状态，并适配深浅主题样式。
- [frontend][ui] 用户侧外链打开页改为全屏沉浸展示，移除顶部工具栏并新增可拖拽半透明世界浮标，点击浮标即可返回世界页面。
- [frontend][portal] 世界页智能体卡片的更新时间行新增底部对齐样式，统一放置在卡片底部，避免不同描述长度导致日期高低不齐。
- [frontend][chat] 聊天页顶部功能入口改为图标按钮（去除文字），并在删除当前智能体应用成功后自动返回世界页面，避免停留在失效聊天上下文。
- [frontend][cron] 优化定时任务运行记录展示：修复记录时间字段为 created_at（含格式化兜底），新增点击条目查看运行详情（状态/触发方式/耗时/摘要/错误/运行ID），并同步聊天页功能弹窗与定时任务页的布局和深浅主题样式。
- [frontend][chat] 智能体设置弹窗将‘共享给同等级用户’选项移动到挂载工具区下方，优化设置顺序。
- [backend][docs] 节点调用内置工具新增 action=list|invoke；支持列出在线节点清单并执行节点命令，兼容未传 action 但提供 node_id+command 的旧调用。
- [frontend][chat] 优化智能体设置弹窗可用性：头像设置默认折叠并支持点击头像展开；增强工具/技能挂载区可见高度与滚动策略，避免工具列表被压缩无法勾选；同步优化定时任务/渠道弹窗主体滚动容器。
- [frontend][web][api][observability] 前后端管理台错误提示新增 trace_id 展示与一键复制，统一提示中附带状态码/排障提示等可观测字段。
- [frontend][chat] 聊天页三类功能弹窗补齐交互与布局：智能体设置恢复头像配置、名称/描述同排、移除底部取消按钮，并统一关闭按钮悬停/聚焦反馈及列表滚动区策略（工具、任务运行、渠道绑定）。
- [web] 线程管理导航图标调整为分支线图标，强化线程语义识别。
- [frontend][chat] 统一聊天页定时任务/渠道设置/智能体设置弹窗为固定尺寸（1080宽、统一高度）并规范内部滚动区域，避免三类弹窗大小不一致。
- [web] 替换线程管理导航图标为会话图标，并优化内部状态热力图中的节点调用/子智能体控制图标为流程图标。
- [backend][api][ws][a2a] 统一 WS/Gateway/A2A 错误结构：补齐 status/hint/trace_id/timestamp 字段并对齐错误码映射。
- [web] 工具管理顶部模块按钮改为跨子模块统一导航：在内置/MCP/知识库/A2A/技能页面均显示切换条并高亮当前模块，避免切换后失去上下文。
- [frontend][chat] 重构聊天页功能弹窗主题体系：为定时任务/渠道/智能体设置弹窗引入独立主题变量与浅深色分离设计，移除 light.css 中旧的通用覆盖样式以避免混色。
- [frontend][chat] 聊天页智能体设置弹窗移除工具搜索框，并统一重构定时任务/渠道/智能体设置弹窗的深色主题配色，增强暗色层次与一致性。
- [web] 渠道管理页优化：配置预览改为浅色代码面板，详情配置区改为自适应撑满剩余高度，减少页面留白。
- [web] 优化管理员渠道管理页的区域分层样式：列表区与详情区采用独立卡片容器、强化边界与选中态，配置区改为高对比代码预览。
- [frontend][chat] 修复聊天页功能菜单中智能体设置/删除按钮可点击性；扩展定时任务与渠道设置弹窗为大尺寸双栏布局并完善深色/浅色主题样式。
- [backend][api][docs] 统一HTTP错误响应结构，新增error.code/status/hint/trace_id/timestamp及x-trace-id/x-error-code响应头，并保留detail.message兼容字段。
- [web][frontend][backend][docs] 外链图标配置改为表单内隐藏选择区，点击图标按钮弹窗挑选图标并可设置颜色，表单展示当前图标标识与预览。
- [frontend][chat] 聊天页功能菜单改为弹窗式管理：定时任务与渠道设置不再跳转新页面，新增当前智能体设置/删除入口；世界页智能体卡片移除编辑与删除按钮。
- [frontend][channels] 用户侧聊天页顶部新增功能菜单，承载定时任务与渠道设置入口并移除工具调整弹窗；Cron/渠道页面支持从聊天页携带 agent_id 上下文并默认按当前智能体加载。
### 修复
- [backend][工程] 批量修复 Rust Clippy 告警并完成语义等价优化，cargo clippy -q 告警数从 243 降至 0。
- [backend][工程] 继续清理 clippy 低风险告警：services/workspace.rs 语义等价优化（map 替代 and_then(Some)、sort_by_key、移除无效 max(0)、? 简化等）；验证通过，clippy 告警数 231→222（累计 243→222）。
- [backend][工程] 修复 clippy 低风险告警：main.rs CORS contains 优化、api/a2a 版本解析与闭包简化、api/admin clamp/map_or/first/from_ref 等语义等价调整；执行 cargo fmt/cargo clippy/cargo test 验证通过，clippy 告警数 243→231。
- [frontend][i18n] 修复 zh-CN 文案中 portal.agent.share.title / portal.agent.share.label 出现问号占位符的乱码问题，恢复为中文‘共享设置’与‘共享给同等级用户’。
- [backend][channels] 修复用户侧渠道设置在仅开启 gateway.enabled 时误报 channels disabled：渠道开关判断改为 channels.enabled 或 gateway.enabled 任一开启即可，避免点击渠道设置即报错。
- [web][frontend][observability] 修复 trace_id 一键复制通知的国际化字段缺失问题，统一复制成功/失败提示与 trace 标签文案。
- [frontend][build] 修复 UserSkillPane 与 CronManagerView 的 showApiError 导入插入位置，解决 Vite SFC import 语法错误并恢复前端构建。
- [frontend][chat] 修复功能弹窗主题混用问题：将弹窗根节点主题选择器改为全局选择器，确保浅色仅在 light 主题生效、深色主题恢复独立样式。
- [docs][api] 修复 API 文档统一错误响应章节乱码并补齐字段说明。
- [backend][doc2md] PPTX兜底解析的正则初始化改为容错模式，初始化失败时记录告警并安全降级，避免因regex构建异常导致进程panic。
- [backend][stability] 增强关键链路容错：移除运行时unwrap风险，补充认证/出站/压测/附件清理等异常分支处理与日志提示，降低线上异常崩溃概率。
### 文档
- [docs] 修复 Clippy 告警修复清单中的乱码段落，重写第6轮条目并校验 UTF-8 可读性。
- [docs] 补充 Clippy 告警修复清单，记录第3-5轮修复路径、验证结果与后续重构建议。
- [backend][工程] 新增 Clippy 告警修复清单（docs/Clippy告警修复清单.md），用于分阶段清理 cargo clippy 告警并规定回归验证流程。
- [skill][devx] 补充 EVA_SKILLS/wunder-agent-dev：新增智能体沙盒容器协作/隔离经验总结，并加入 agent_sandbox_collab_check.py 回归脚本用于校验预置容器分配与同容器共享、跨容器隔离。
- [config][docs] 澄清 wunder-example 配置中 gateway 与 channels 的职责边界：gateway 为控制层（节点接入），channels 为业务层（绑定/路由/出站/多模态），并将示例默认改为联动开启以避免误解为冗余。
- [docs][api] 补充 WebSocket/Gateway/A2A 错误可观测字段说明，明确 trace_id 与错误载荷字段。
### 重构
- [backend][storage] 完成存储层接口参数对象化重构，统一更新 Postgres/SQLite 实现与上层调用链，降低参数耦合复杂度。
- [web][observability] 管理端错误处理统一收口到 resolveApiErrorMessage：集中拼接 trace_id 后缀，减少各模块重复解析逻辑并保持提示一致。
### 工程
- [backend][lint] 将 too_many_arguments 抑制策略从 crate 级收敛为函数级定点标注，仅保留 result_large_err 的 crate 级抑制，便于后续分模块持续重构。
### 测试
- [frontend][web] 验证用户侧前端构建通过，并对错误提示相关 JS 模块执行 node --check 语法校验。
- [backend][a2a][api] 新增 A2A JSON-RPC 错误观测字段单测，验证业务字段保留与 trace_id/status/hint 补齐。
- [backend][api] 补充错误码映射单测，覆盖自定义错误码到 HTTP 状态的归一化规则。
- [backend][api] 新增统一错误响应单元测试，覆盖错误码头、trace_id 头与 detail.message 兼容字段。
- [backend][gateway][scripts] 新增网关回归测试脚本，覆盖握手超时、Origin拦截、慢客户端剔除与node.invoke伪造响应拦截，并提供一键执行脚本。

## 2026-02-06
### 新增
- [backend][frontend][web][docs] 新增外链管理：管理员可配置外链并按单位层级开放；用户世界页新增更多应用并在 wunder 内嵌打开外链。
- [backend][channels] 新增飞书/QQBot渠道入站与出站能力，支持/wunder/channel/feishu/webhook与/wunder/channel/qqbot/webhook以及账号级直连发送。
- [backend][frontend][admin][docs] 新增用户侧渠道绑定接口与渠道管理页面，补齐管理端渠道账号管理面板与文档说明
- [channels][whatsapp][docs] 新增 WhatsApp Cloud Webhook 接入与 Graph API 出站投递，并补充渠道/前端设计说明
- [eva_skills][docs] 新增『wunder智能体开发』技能，提供开发流程、规范要点与网关回路测试脚本
- [backend][gateway][admin] 新增 gateway invoke 管理接口用于触发节点调用回路
- [backend][gateway][ws][admin][tools] 新增网关控制面 WS 入口、节点调用工具与管理接口，支持节点/客户端在线态与调用回执
- [backend][channels][gateway] 新增渠道用户绑定与主线程会话策略
- [backend][frontend][ws][docs] 新增 workspace_update 流式事件并仅在工作区变更时刷新沙盒容器，避免每次消息结束刷新卡顿
- [frontend] 前端新增后端不可用时维护提示页
### 变更
- [backend][gateway][docs] Gateway hardening: strict connect handshake timeout/field validation, trusted origin+proxy checks, invoke response binding, maintenance health events, and slow-client eviction.
- [web][docs] 优化外链管理页面：新增图标可视化选择器与实时预览，重构列表/详情样式为更专业的管理台风格。
- [frontend][admin] 管理员渠道新增弹窗支持按渠道自动填充配置模板，并联动账号占位提示。
- [frontend][admin] 管理员渠道管理页新增渠道改为下拉选择系统支持渠道，并优化左右区域视觉分区样式。
- [backend][channels] 补齐飞书encrypt事件解密能力，支持AES-CBC/PKCS7解密后进入统一渠道主链路处理。
- [frontend] 编辑文件窗口按钮交互改为扁平风格并提升深色主题保存按钮亮度
- [frontend] 扩展沙盒文件图标保留数量（约100个常见类型）
- [frontend] 精简沙盒文件图标资源至常用集合（<=100个）
- [frontend] 用户侧聊天顶部栏隐藏传输切换按钮，智能体标签改为标题下小标题并将通用聊天更名为通用应用
- [backend] 管理员用户取消 max_rounds 限制，工具调用支持无限轮次
### 修复
- [frontend][backend] 修复渠道页面导入热更新与 user_channels 无用导入告警
- [config][i18n] 修复节点调用工具中文文案与配置显示乱码
- [frontend] 修复深色主题编辑窗口保存按钮悬停/按下反馈不明显的问题
- [frontend] 用户侧编辑文件窗口关闭/保存按钮补充悬停与按下交互反馈
- [frontend] 用户侧 workspace-panel 删除确认占位符显示正确文件名，并支持双击文本文件进入编辑
- [frontend] 补全沙盒文件列表常见文件图标资源（vscode-icons）
- [backend] 线程管理统计合并聊天会话 agent_id 并将监控记录补齐 agent_id
- [backend] 补充监控线程记录的 agent_id 并修正线程管理智能体数统计
- [backend] 修复线程管理智能体数统计仅显示默认值的问题
### 文档
- [eva_skills][agent] 补充 EVA_SKILLS/wunder-agent-dev 开发经验，新增网关回路、渠道路由、管理端导航重构注意事项，并新增 admin_nav_sanity.py 一致性检查脚本说明。
- [docs][channels] 补充飞书与QQBot渠道Webhook/API设计说明，明确账号配置字段与入出站链路。
- [docs][system][design][api] 更新系统介绍/设计方案/API文档并同步英文版前端入口说明
- [docs][architecture] 更新架构设计：补充网关/多租户/智能体应用/前端与部署说明
- [docs][readme] 同步 README-English 与中文版本
- [docs][readme] 更新 README 描述为智能体调度系统并补充用户/管理/网关能力说明
- [docs][channels] 同步渠道用户绑定与主线程策略文档说明
- [docs][gateway] 新增 wunder 网关系统落地方案文档
- [docs] 同步英文会话状态机图，补充 waiting 状态

### 重构
- [web][admin] 管理端导航重构为系统/智能体/调试/文档四分组，模型配置、线程管理、记忆管理、渠道管理与工具管理统一归入智能体分组；工具管理页新增内置工具/MCP/知识库/A2A/技能快捷入口。
## 2026-02-05
### 新增
- [backend][frontend][docs] 智能体主线程与队列落地，接口与前端时间线支持主线程设置
- [backend][frontend][docs] 定时任务工具与调度器落地，新增cron API与用户侧管理页

### 变更
- [web] 优化记忆管理页面列表与队列区域的对比度与操作列显示
- [web] 优化线程管理页面表格操作列遮挡与面板对比度
- [web] 优化线程管理页面线程统计表格的扁平与紧凑样式
- [frontend] 时间线为空时显示居中图标
- [frontend] 主线程书签标识阴影增强立体感
- [frontend] 主线程书签标识改为与五角星一致的实色
- [frontend] 主线程书签标识调为淡黄色
- [frontend] 主线程书签标识调为橘色淡透明并移至左侧
- [frontend] 时间线主线程标识改为书签挂带样式并移除文字
- [frontend] 用户侧新建会话改为新建线程，时间线主线程标识改为条目内标签
- [web][backend] 强化线程管理页面：列调整为用户/智能体数/总线程/活动线程/上下文并优化样式
- [web] 管理员侧系统导航顺序调整
- [web] 管理员内部状态工具热力图定时任务图标改为闹钟
- [backend][frontend] 简化定时任务工具提示/返回，优化定时任务页面表格与运行记录滚动
- [backend][ws][docs] WebSocket 增加 connect 协议握手、协议版本/传输策略下发并补充结构化日志
- [backend][cron] 删除会话时级联删除关联定时任务
- [backend][frontend][ws] 聊天 WebSocket 新增 watch 订阅会话事件，用于实时推送后台消息
### 修复
- [backend] 修复流式事件持久化日志的借用生命周期错误
- [backend] 增强LLM与Sandbox响应解析失败处理并补齐LSP/Channels/历史加载错误日志
- [backend] 增强流式事件、日志与会话锁错误日志并收紧配置持久化失败处理
- [backend][queue] 问询面板等待状态视为可继续处理，避免用户选择后被判定会话繁忙进入队列
- [backend][session] 并发请求未提供 session_id 时自动分叉独立会话，避免不同智能体会话互相中止 移除自动结束其他等待问询面板会话的逻辑，避免并发问询被误终止
- [backend] 梳理智能体线程：显式 session 不再覆盖主线程；线程状态仅在主会话更新；队列任务按 session 生成 thread_id 以避免串扰
- [backend][config] 修复 SessionLease 未实现 Debug/Clone 导致 sandbox 编译失败，补齐本地 override API key 以支持 /wunder/ws 调试
- [backend][ws][frontend][chat] /wunder/ws 走 agent_runtime 队列并增加会话租约，降低并发下 USER_BUSY 与误中止；前端流式失败时自动清理问询面板待选状态
- [backend][ws][docs] 修复 WS cancel 误取消会话：watch/resume 中止不再触发会话级取消，request_id 仅停止当前流
- [web] 线程管理表格列顺序修复：活动线程数与上下文对齐
- [backend][storage] 放宽 session_locks 为会话级互斥，允许同一用户并行多个会话
- [web][debug] 调试面板空 session_id 自动生成唯一会话，避免历史记录被覆盖
- [frontend][chat] 修复聊天快照合并逻辑，刷新后多轮工作流信息丢失与输出顺序异常的问题
- [frontend][web][debug] 修复聊天 watch 重用流式消息避免重复输出卡住，并修复调试面板自动写入 session_id 导致历史覆盖
- [frontend] 修复定时任务触发消息乱序与工作流事件丢失，按用户轮次分流监控事件并插入用户气泡。
- [backend][frontend][ws] watch 订阅避免历史事件回放并补充定时任务用户气泡
- [frontend][backend][cron] 定时任务实时消息补充用户气泡与 watch 去重处理
- [backend][frontend][cron] 优化定时任务触发回复的实时展示（cron流式事件落库 + 会话监听自动续流）
- [backend][cron] 定时任务执行结束后基于最新记录更新状态，避免停用/删除后被回写复活
- [backend] 构建全目标时抑制dead_code告警
- [backend] 修复集成测试lib构建dead_code告警
### 文档
- [docs] 更新错误处理与提示增强审查文档的落地进展
- [docs] 更新会话状态机图，补充 waiting 状态
- [docs] 补充论文主链路概念与并发/等待/排队语义说明
- [docs] 更新系统介绍/系统概览/WS 传输文档的 waiting 状态与并发说明
- [docs] 更新系统介绍/设计/架构/英文概览文档的并发与队列说明，补充 session_id 互斥、自动分叉与问询面板 waiting 行为
- [docs] 补充 /wunder 忙时队列与问询面板 waiting 状态的处理说明（含自动分叉会话行为）
- [docs] 架构设计补充主链路原样表述
- [docs] 架构设计补充 user→agent→session→agent_loop→WS/SSE 关系图
- [docs] 新增错误处理与提示增强审查文档
- [docs] 架构设计补充主链路 user→agent→session→agent_loop→WS/SSE
- [docs] 更新架构设计补充用户-智能体-线程关系图
- [docs][readme] 精简 README，移除请求示例与 API 入口概览，补充用户侧功能与使用说明
- [docs][frontend] 补充主线程/时间线交互规则与前端落地路径
- [docs] 新增《强化智能体落地方案.md》并明确默认会话+异步队列落地路径
### 测试
- [tests][cron] 新增会话删除级联定时任务的存储测试
- [tests][cron] 补充定时任务结束逻辑测试，覆盖删除与停用场景
- [backend] 新增定时任务工具集成测试
## 2026-02-04
### 新增
- [backend][frontend][chat] 新增慢客户端告警事件并在前端提供续传提示
### 变更
- [frontend] 用户发送消息后自动居中当前智能体输出区域
- [frontend] 沙盒容器空状态提示改为天蓝色
- [frontend] 调整沙盒容器空状态提示字体与居中样式
- [frontend] 沙盒容器为空时提示临时文件区及24小时清理说明
- [frontend] 调整工作区文件夹图标并裁剪 VSCode 图标集
- [frontend] 沙盒列表图标切换为 VSCode file icons 主题并使用扩展名/文件名映射
- [frontend] 沙盒列表收紧间距并为代码类文件映射文本图标
- [frontend] 沙盒列表图标统一改用 doc-icons 图标集
- [frontend] 沙盒列表条目扁平化并为文件夹/文件图标加入拟物效果
- [frontend] 沙盒容器区改为单位管理树状容器风格（简洁虚线边框）
- [frontend] 资源文件卡片标题区与图标区分离并调整左对齐大图标样式
- [frontend] 资源文件图标改用本地 PNG 文档图标并兼容部署基路径
- [前端] 聊天标题传输状态灯支持点击切换
- [frontend] 资源文件链接统一渲染为带标题的文档图标卡片
- [前端] 聊天标题增加SSE/WS传输状态灯
- [frontend] AI 资源文件卡片改为图标化展示并支持点击下载
- [backend][frontend][docs] WebSocket 升级为多路复用协议并支持 Sec-WebSocket-Protocol 鉴权
- [frontend][portal] 世界页智能体卡片精简元信息为单一时间字段，并移除默认入口说明
- [frontend][portal] 世界页智能体卡片 meta 信息调整至编辑操作左侧
- [frontend][portal] 世界页智能体卡片状态仅保留单一标识并新增空闲待命提示
### 修复
- [frontend] 修复沙盒容器空提示中文乱码
- [frontend] 统一工作区图标样式并补齐 txt/log 文本图标映射
- [frontend] 修复工作区文件图标映射与列表紧凑度
- [frontend] 修复资源文件图标路径正则导致的前端语法错误
- [frontend][chat] WebSocket 连接失败时自动降级 SSE 一段时间，减少重复报错
- [frontend][chat] 修复多会话切换时后台流式更新丢失并在会话列表提示运行状态
- [附件解析] 调试面板附件解析接口提升上传上限至10MB，避免大体积PPTX/DPS解析失败

### 性能
- [backend][ws] 优化 WebSocket resume 轮询退避与慢客户端丢弃增量事件，降低空转与阻塞开销
- [frontend][chat] 用户侧聊天流式 WebSocket 连接复用与多路复用，减少握手与连接开销
### 文档
- [docs][cron] 新增定时任务落地方案文档
- [docs] 补充 WebSocket slow_client 告警事件说明
- [docs] 修复 API文档 与 WebSocket-Transport 中文乱码
- [docs] 补充架构与系统介绍中的 WebSocket 默认传输说明
## 2026-02-03
### 新增
- [backend][docs] 新增 /wunder/ws WebSocket 统一入口并补齐协议说明
- [backend][frontend][docs] 新增 WebSocket 流式传输并在用户侧默认启用
### 变更
- [backend][doc2md] doc2md 上传大小上限调整为 10MB
- [backend][doc2md] xlsx 解析改用 rlsx 并在失败时回退 calamine
- [frontend] 用户侧聊天页间距更紧凑
- [frontend][portal] 对齐聊天与世界页顶栏样式（渐变与间距统一）
- [frontend][portal] 恢复浅色主题世界页顶栏原有渐变样式
- [skills][pptx] PPTX生成技能新增代码模板库版式与多类型布局脚本
- [frontend][portal] 浅色主题下世界页顶栏改为更素的纯色背景
- [frontend][portal] 浅色主题优化世界页智能体卡片视觉样式
- [frontend][chat] 仅最新智能体消息的状态灯保留动效
- [frontend][chat] 聊天消息头状态灯完成态改为绿色
- [frontend][chat] 聊天消息头增加智能体状态灯并与世界页样式对齐
- [frontend][chat] 浅色主题下移除计划浮动标签阴影
- [frontend][chat] 降低计划面板浮动标签阴影强度
- [frontend][chat] 计划面板浮动标签改为矩形样式
- [frontend][chat] 优化计划面板浮动标签外观，柔化两侧切角
- [frontend][chat] 用户侧聊天计划面板改为单一浮层，输入框上方展示进度并可展开全部计划
- [frontend] 用户侧前端工作流默认收起，并在标题行显示最新一条记录
- [web] 吞吐量线程监视速度值移除 token/秒单位显示。
- [web] 吞吐量测试线程监视改为展示单预填充/单解码速度，并限制性能曲线区域高度。
- [web] 调整吞吐量测试线程监视高度分配，释放性能曲线溢出空间。
- [web][throughput] 精简吞吐量表单并将线程统计移至左侧底部
- [web][throughput] 压缩线程监视空间并移除筛选按钮，提升统计卡片可读性
- [web][throughput] 吞吐量线程监视区改为统计信息展示
- [frontend][chat] 修复浅色主题工作流列表背景过深问题
- [frontend][chat] 紧凑化工作流条目间距并将列表呈现为统一块
- [frontend][ui] 调整用户侧图标尺寸整体缩小一档
- [frontend][tools] 更换浅色主题 user-tools-sidebar 风格为明亮渐变与柔和高光
- [frontend][tools] 美化浅色主题 user-tools-sidebar 视觉层次与阴影
- [frontend][tools] 移除工具管理页 user-tools-content 额外外框
- [frontend][chat] 调整浅色主题聊天面板亮度与沙盒侧栏阴影，并统一聊天与世界页顶栏高度
- [frontend][chat] 调整浅色主题阴影强度，避免沙盒容器呈现凹陷感
- [frontend][chat] 默认启用高性能视觉主题并迁移旧低功耗设置
### 修复
- [frontend] 修复多会话并发时流式状态互相干扰与续传失败提示
- [backend][doc2md] OLE 读取补充流名模糊匹配以兼容 WPS 文档
- [backend][doc2md] PPTX 解析容错并在 XML 异常时回退文本提取
- [backend] 消除 websocket 解析的未使用字段与导入警告
- [backend][doc2md] xlsx 缺失 workbook.xml.rels 时启用回退解析
- [web] 修复线程管理统计表操作列被裁剪，放宽操作列宽度并压缩内边距。
- [web] 系统设置布局改为自适应行高并允许滚动，避免窄屏重叠与顶部截断。
- [web] 优化系统设置页面在窄屏时的布局，避免卡片重叠并允许滚动。
- [web] 限制吞吐量性能曲线图表容器高度，避免卡片底部溢出。
- [web] 限制吞吐量性能曲线卡片溢出，确保卡片底部闭合。
- [skills][pptx] 修复 PPTX生成 技能文档中文乱码
### 文档
- [docs] 校准 WebSocket 传输文档的消息字段与心跳说明
- [docs] 补充 WebSocket 可选传输方案文档与接口说明
- [docs][prompts] 翻译 codex-main 提示词为中文
- [prompts] 对比 openclaw 与 wunder 提示词并输出补充建议
- [docs][prompts] 恢复 openclaw 提示词中文译文完整版
- [docs][prompts] 精简 openclaw 提示词内参文档为中文要点
- [docs][prompts] 整理 openclaw 提示词参考文档
- [docs][prompts] 整理 codex-main 提示词参考文档
- [skills][pptx] 优化 PPTX生成 技能流程，强调需求要素收集、大纲确认与按纲交付

### 安全
- [backend][docs] WS 入口补充错误码并增加会话校验
### 移除
- [frontend][docs] 移除像素风主题与用户侧前端重构方案文档
## 2026-02-02
### 变更
- [frontend][ui] 优化用户侧 message box 关闭按钮尺寸与深色主题文字对比度
- [frontend][portal] 智能体编辑页提示词与基础设置对调位置，并将提示词标题简化
- [frontend][portal] 智能体编辑页头像设置默认展开
- [frontend][portal] 增强深色主题下智能体编辑弹窗各区域层级与分区对比度
- [frontend][portal] 提升智能体编辑弹窗深色主题表单与选项文字对比度
- [frontend][portal] 编辑智能体应用基础设置移除展开按钮，改为点击头像图标展开
- [frontend][portal] 提升世界页智能体编辑弹窗的头尾区与按钮质感，强化表单与工具分组层次
- [frontend][portal] 优化世界页智能体编辑弹窗的布局层级与表单样式
- [frontend][backend][auth] 注册与资料编辑支持选择单位，新增用户侧单位列表接口并完善暗色资料编辑弹窗样式
- [frontend][profile] 优化用户侧我的概况页面布局与视觉层级，补充额度明细展示

### 修复
- [frontend][ui] 增强浅色主题 el-dialog 关闭按钮悬停与按下交互
- [frontend][ui] 修复 el-dialog 关闭按钮样式与交互状态
- [frontend][workspace] 修复沙盒容器清空提示占位符未替换的问题
- [frontend][ui] 修复用户侧 message box 关闭按钮未对齐标题行的问题
- [frontend][portal] 修复智能体工具勾选的 Checkbox value 警告，并统一美化对话框头部样式
- [frontend][chat] 修复流式聊天请求未应用 API base 导致指向前端端口
## 2026-02-01
### 新增
- [backend][channels] 多渠道接入、绑定路由、会话映射、出站重试与多模态处理基础链路落地
### 变更
- [docker][frontend] wunder-nginx 挂载 frontend/public/config.json 以支持运行时配置
- [frontend][config] 前端支持运行时 config.json 配置 API 基址，并统一请求与 i18n 使用
- [config][docker] 统一 compose 默认值与 .env.example，并通过 WUNDER_LOG_LEVEL 统一日志级别
- [config] 整理示例配置，将可外置的变量迁移到 .env.example
- [frontend] 工具管理页去除多余外框，界面更清爽
- [frontend] 精简工具管理页容器结构，去掉多余包裹层并合并样式作用域。
- [frontend] 精简工具管理页容器类名，合并页面容器样式。
- [frontend] 工具管理页去除冗余区块标题，将状态提示放到各工具标题行右侧并提升区域区分度。
- [frontend] 将用户工具状态提示移动到工具管理页面区块标题栏右侧。
- [frontend] 优化用户工具面板：状态信息挪至分类标题行，统一标题/提示字号，并改善浅色主题下技能目录与编辑区背景。
- [frontend][backend][docs] 对齐用户侧技能管理，新增技能目录/文件编辑与删除能力，并补充用户技能文件接口与文档。
### 修复
- [docker][frontend] 调整 nginx config.json 挂载路径以避免只读目录挂载失败
- [frontend] 工具管理页恢复 user-tools 主题变量以修复 MCP/技能样式
- [frontend] 工具管理页恢复侧边栏布局并移除外层边框
- [backend][channels] 修正渠道处理代码的告警与字段冗余
- [backend][deps] 补充 reqwest multipart feature 以支持 ASR/TTS 多部件请求
- [子智能体] 子智能体控制忽略无效agentId并补充等待进度心跳

### 文档
- [docs] 补充多渠道与多模态接入相关设计与 API 文档说明
## 2026-01-31
### 新增
- [backend][docs] 新增子会话会话工具与运行记录，支持派生子智能体并回传结果，并补充设计/API/系统文档说明
### 变更
- [backend][docs] doc2md/attachments/convert 支持多文件上传并返回 items 列表
- [frontend] 统一用户侧顶部导航图标尺寸，并将聊天页工具管理按钮更名为工具调整并更新图标
- [管理端] 内部状态热力图子智能体控制使用机器人图标
- [子智能体控制] 子智能体控制 spawn 支持等待子会话完成并返回结果
- [frontend] 用户侧世界/工具管理图标调整并放大顶部导航按钮
- [backend][docs] 合并会话列表/历史/发送/派生为子智能体控制工具，调整配置与文档说明
- [frontend] 用户侧世界/工具管理按钮改为纯图标显示
- [frontend] 用户侧世界与工具管理按钮恢复文字并统一地球图标
- [frontend] 导航中的广场改名为世界
- [frontend] 用户侧前端将临时文件区改名为沙盒容器，功能广场改名为世界
- [frontend] 管理员开放工具区改为网格布局并限制滚动不超出侧栏
- [frontend] 调整功能广场搜索区与数量标签的排布顺序
- [backend] 替换智能体应用示例为科学绘图与政策分析
- [frontend] 暂时隐藏功能广场的共享智能体应用区域
- [frontend] 将功能广场搜索栏移至我的智能体应用标题行右侧

### 修复
- [frontend] 修复 en-US locale 文案中的单引号导致的构建语法错误
- [子智能体控制] 子智能体控制子会话使用独立锁域，避免与父会话并发冲突
- [frontend] 修复用户侧 i18n 中文文案写入乱码问题
- [frontend] 补齐用户侧 i18n 文案与系统工具字段，修复界面显示原始 key
- [frontend] 修复 i18n 接口地址正则包含未转义斜杠导致的构建语法错误
- [知识库][web][frontend] 完善向量知识库上传失败提示，展示后端错误详情
### 文档
- [docs] 新增多渠道与多模态集成落地方案
- [docs] 新增子agent落地方案文档
- [docs][web] 论文补充热门项目 OpenClaw 案例
- [docs] 修正用户手册：合并工作区与沙盒容器说明
- [docs] 重构用户侧使用手册，补充更细致操作并更新命名
- [docs] 新增用户侧使用手册
### 工程
- [backend] 清理 user_tools 未使用导入，消除编译告警
## 2026-01-30
### 变更
- [知识库][backend][web][frontend] 向量知识库上传自动切片嵌入并增加上传动画
- [web] 用户管理页面新增单位等级列
- [backend][docs] 管理员会话跳过配额、会话锁、历史/监控裁剪、超时与保留清理，记忆不设上限以支持长期运行
- [frontend] 合并用户侧工具管理页面的管理员开放工具与自建工具展示，新增只读查看分类
- [frontend][backend] 修复新增字面知识库路径越界校验并调整字面知识库操作按钮布局
- [frontend] 调整用户侧知识库按钮布局与批量嵌入动画表现
- [frontend][backend][docs] 对齐用户侧知识库页面交互与样式，新增切片批量嵌入/删除与测试接口
- [web][backend] 字面知识库测试返回模型原始输出并列出命中文档内容
- [web][backend] 字面知识库测试改为输出大模型原始回复
- [web][backend] 知识库测试弹窗固定尺寸，重建嵌入显示切片动画，并支持字面知识库测试
- [frontend] 对齐用户侧自建工具知识库按钮样式，补齐图标按钮布局
- [web] 用户管理列表所属单位列仅显示当前单位名称
- [知识库][backend] 向量知识库关键词列表检索去重重复切片以节省上下文
- [backend][storage][知识库] 向量知识库文档与切片元数据改为数据库存储并支持旧文件迁移
- [知识库][向量知识库][工具] 向量知识库工具新增 keywords 列表检索并批量嵌入查询
- [web][admin] 单位树支持一键展开/折叠并统一为文件树图标风格
- [知识库][向量知识库][性能] 向量知识库写入加文档锁与原子写入，Weaviate 查询变量化并优先批量删除，索引重建改为先写后删，上传增加大小与内容上限
### 修复
- [backend] 用户工具调用统计过滤内部工具与技能读取日志
- [web][docs] 部署拓扑图 SVG 增加版本参数以绕过浏览器缓存
- [web][docs] 修复部署拓扑图 SVG 解析错误导致的显示失败
- [web] 修复性能测试耗时表头与向量知识库流程列的匹配
- [知识库][backend] 修复 Weaviate GraphQL limit 变量类型解析导致的检索失败
- [知识库][backend] 修正 Weaviate GraphQL Text 变量类型以匹配过滤器
- [知识库][backend] 修复 Weaviate GraphQL 文本过滤变量类型导致的向量检索失败
- [backend] 修复向量知识文档锁闭包借用导致的编译错误
- [backend] 手动触发压缩在有历史但无候选时仍执行，避免强制压缩被跳过
- [backend][debug] 强制压缩前刷新历史写入队列，避免压缩被跳过
### 性能
- [web] 用户管理列表加载加入加载锁并简化单位列渲染，翻页更顺滑
- [web][admin] 用户管理翻页保留表格内容，降低加载抖动
- [backend][storage] 批量写入测试用户，减少批量生成耗时
### 文档
- [docs][web] 同步论文图示资源并重新生成《智能体调度平台的设计与实现》DOCX
- [docs][架构设计] 部署拓扑图调整 MCP 服务与向量数据库节点间距
- [docs][架构设计] 部署拓扑图调整 wunder-server 与向量数据库节点宽度，确保文字完整显示
- [docs][知识库] 更新设计/API/系统介绍与方案说明以同步向量知识库改为数据库存储
- [docs][api][知识库] API 文档补充知识库工具 keywords 入参与 queries 返回说明
- [docs][web][部署拓扑] 更新部署拓扑图将向量数据库并入运行服务并同步论文描述
- [docs][架构设计] 调整架构设计为原理阐述并补充向量知识库流程图与配置治理说明

### 移除
- [backend][storage] 移除用户工具禁用黑名单字段与存储逻辑，仅保留可用工具白名单
## 2026-01-29
### 新增
- [web][backend][admin] 用户管理新增按单位批量生成测试用户
- [后端][前端][文档] 新增向量知识库支持（Weaviate + 嵌入模型），补充上传切片索引与可视化管理
- [backend][web][config][admin] 新增单位层级体系，启动根据单位结构配置初始化组织树并提供管理端单位管理页面与负责人管理能力
- [backend] 新增用户资料更新接口并预置办公智能体模板

### 变更
- [管理端][知识库] 知识库详情操作按钮改为图标并统一尺寸
- [web] 管理端知识库操作按钮移至详情头部，并将切片全选按钮调整到原文档操作区
- [web] 管理端知识库新增弹窗在字面类型时隐藏并禁用嵌入相关配置项
- [web][backend] 知识库文档上传支持多选，性能测试新增向量知识库流程耗时指标
- [web] 管理端向量知识库切片操作按钮改为图标样式并新增全选功能
- [web][backend][docs] 向量知识库管理改为原文弹窗与批量嵌入/删除，新增测试入口和嵌入动画提示并修复删除后残留目录，吞吐/评估模型仅展示LLM
- [config][backend] 将单位结构配置文件改名为org_units.json
- [backend][web][docs] 向量知识库上传改为仅切片待嵌入，新增切片编辑/嵌入/删除与原文折叠查看
- [web][backend][admin] 调试面板新增上下文压缩按钮并支持手动触发会话压缩
- [用户侧前端] 用户侧替换为 Font Awesome 图标体系，统一聊天/广场/工具与工作区等图标
- [前端] 管理员侧模型配置嵌入模型精简字段与默认限制，知识库列表加入类型图标并修正字面布局
- [web][admin] 单位管理树支持折叠/展开以便快速浏览层级
- [web][admin] 单位管理树形目录改为简洁列表样式，视觉对齐技能文件树
- [web][admin] 用户管理设置移除禁用工具配置，仅保留可用工具白名单
- [frontend] 智能体头像设置区域紧凑化并将预览与按钮聚合
- [backend][frontend][web] 访问级别改为单位体系统一全量权限，工具权限改用白名单/黑名单与单位默认配额
- [frontend] 智能体头像设置改为折叠面板并支持自定义颜色与更多图标
- [frontend] 智能体编辑弹窗整合头像与共享设置并压缩空间
- [backend] 预置智能体将邮件写作替换为公文写作并自动迁移旧条目
- [frontend] 统一智能体卡片头像尺寸为方形
- [frontend] 调整广场搜索栏位置与概况布局，新增资料编辑入口并优化会话工具应用按钮可见性
### 修复
- [backend] 调试面板手动压缩时保留最近用户消息避免历史压缩被跳过
- [backend] 修复 Weaviate GraphQL 查询语法导致向量知识库检索失败的问题
- [backend] 修复向量知识库 Weaviate 批量写入与查询错误未暴露导致召回为空的问题，并补充 schema 属性自动补全
- [frontend] 功能广场搜索框调整为标题行居中布局
- [frontend] 修正功能广场搜索框位置避免标题换行
- [frontend] 将功能广场搜索框调整到标题右侧
### 性能
- [backend][web] 用户管理批量测试用户生成与分页渲染性能优化
### 文档
- [docs][架构设计] 更新架构设计补充智能体广场、多智能体并行与向量知识库
- [docs] 更新设计/API/系统/数据库/用户前端文档以覆盖单位层级、权限策略与管理端页面
- [docs] 移除向量知识库方案中的待确认事项段落
- [docs] 更新向量知识库方案明确存储目录与模型约束
- [docs] 新增向量知识库实现方案文档
## 2026-01-28
### 新增
- [frontend][backend][docs] 新增共享智能体能力：支持共享标记与共享列表接口，同等级可见，并在功能广场新增共享智能体区域与共享开关
- [mcp_server] 新增知识库检索 MCP 工具 kb_query 并接入 RAGFlow 配置
### 变更
- [backend] 进一步缩短智能体工作区标识长度（3+5 哈希）
- [backend] 进一步缩短智能体工作区标识长度
- [backend] 缩短智能体工作区标识并在删除智能体时清理对应工作区
- [frontend] 智能体应用支持头像图标/颜色选择，通用聊天头像改为纯图标
- [frontend] 功能广场移除智能体空态提示，调整共享区域间距并为智能体卡片添加头像与质感样式
- [frontend] 功能广场搜索框移至标题栏中部并将智能体卡片编辑/删除改为图标按钮
- [frontend][backend][api] 智能体会话支持按智能体恢复上次会话，并在问询面板等待时保留提示与广场状态展示
- [frontend] 优化功能广场顶部栏搜索位置与智能体卡片操作交互，调整工具管理布局留足自建工具空间
- [frontend] 补充广场智能体卡片操作按钮悬停反馈并提升浅色主题删除按钮可读性
- [mcp_server] 精简 kb_query 描述，移除数据集ID显示
- [mcp_server] 配置 kb_query 连接到 RAGFlow 知识库并完成连通性验证
- [frontend] 修复智能体会话新建跳回通用聊天的问题，并按智能体隔离历史记录与草稿会话
- [frontend] 对齐用户侧今日额度与管理员口径，并加粗概况页额度环图
- [frontend] 概况页额度环改为 ECharts 环图以对齐管理员侧线程状态展示
- [frontend] 概况页额度环样式调整为更接近管理员侧线程状态环图
- [frontend] 调整功能广场搜索框从标题区移出并优化顶部栏布局
- [frontend] 调整聊天页顶部布局与按钮排序，收紧功能广场搜索位置，并优化概况页额度环样式与导航入口展示
- [frontend] 工具管理将共享工具并入自建工具分类并压缩左栏宽度，功能广场标题栏移除新建与聊天入口，聊天工具调整面板移除搜索/禁用开关并优化暗色按钮样式
- [frontend] 对齐用户侧标题栏样式与布局，聊天页补回广场入口并将工具调整改为图标按钮，智能体创建工具分组支持全选/取消，问候语采用智能体描述

### 修复
- [backend] 发送消息时自动结束同智能体的问询等待会话
- [backend] 修复监控线程强制清理时的编译错误
- [backend] 线程管理删除改为强制清理监控/会话数据，等待态线程可终止
- [backend] 通用聊天运行状态补充监控兜底，避免卡片不显示
- [frontend][backend][api] 通用聊天卡片联动运行中/待选择状态展示
- [frontend][backend][tools] 问询面板待选择状态默认保持开启并确保工具事件/历史记录携带面板信息
- [frontend] 修复智能体聊天保持 agent_id 避免新建会话跳回通用，并对齐今日额度展示与环图表现
- [docs] 修复架构设计图 Mermaid 语法以避免解析错误
### 文档
- [docs] 新增数据库设计字段级ER图
- [docs] 补充数据库设计图示
- [docs] 补充数据库设计逻辑关系图
- [docs] 新增 wunder 视频介绍 PPT 初稿
- [docs] 新增数据库设计文档
- [docs] 新增 wunder 视频介绍脚本
- [docs] 更新 API 文档、系统介绍与智能体拓展方案的 agent_id 工作区与运行中智能体说明
- [mcp_server] README 补充数据库描述建议以提升表选择准确性
- [web][docs] 论文部署拓扑改为引用图片并补充对应图文件
- [web][docs] 补充论文架构设计章节并追加部署拓扑图
- [docs] 重构部署拓扑布局，保持外部依赖置顶并与运行服务对齐
- [docs] 调整部署拓扑为上下分区布局以对齐挂载目录与运行服务
- [docs] 调整部署拓扑运行服务命名，并将 Workspaces 卷移到外部依赖下方
- [docs] 回退部署拓扑布局为上一版
- [docs] 简化部署拓扑节点命名并优化分组布局
- [docs] 调整部署拓扑运行服务与外部依赖配色，突出 Rust 区域
- [docs] 调整部署拓扑分组标题颜色以提升可读性
- [docs] 美化部署拓扑图样式，区分内部服务与外部依赖
- [docs] 新增架构设计文档，补充部署拓扑与组件说明
- [docs] 补充 UserProfile 额度字段说明，并更新智能体拓展方案的等级与工具描述
## 2026-01-27extra-mcp
### 新增
- [mcp] 新增 mcp_server MCP 配置文件并支持 MCP_CONFIG_PATH
- [eva_skills][人员成长路径规划] 新增人员成长路径规划技能，补充分析流程与图表生成脚本
- [docker][mcp] 新增 extra-mcp 服务与 mcp_server MCP 示例脚本
- [scripts] 新增人员数据库 FastMCP 示例脚本
- [eva_skills][电子表格处理] 生成电子表格技能评估样例（temp_dir/spreadsheet_skill_review.xlsx）
- [PPTX生成][eva_skills] 生成环保主题PPTX示例（含图表）用于技能评估
- [eva_skills][电子表格处理] 生成电子表格处理示例报表与图表（temp_dir/spreadsheet_analysis_demo.xlsx）
### 变更
- [frontend] 功能广场恢复通用聊天卡片并移除欢迎文案，工具管理页面去掉介绍标题并让自建工具区撑满高度
- [web][docs] 管理端移除附加提示词输入与接口文档说明
- [frontend][backend][config] 清理智能体广场页面入口与路由，移除用户额外提示词接口/存储，i18n 读取支持 BOM 防止乱码
- [mcp_server] 精简 mcp_config.json，移除 mcp 运行配置段
- [frontend][backend][docs] 功能广场聚焦智能体应用入口，工具管理重排并移除额外提示词
- [mcp_server] 数据库配置仅从 mcp_config.json 读取，移除 PERSONNEL_DB_* 环境变量
- [mcp][db] 数据库工具移除 db_key 入参
- [backend][frontend][docs] 智能体广场与工具管理落地，新增会话工具调整与ABC等级覆盖策略
- [mcp][db] 数据库用途说明支持 target_descriptions 补充
- [mcp][db] 数据库工具描述支持从配置文件读取用途说明
- [mcp] 精简 MCP 数据库工具并改为中文输入描述
- [mcp][db] 人员数据库 MCP 支持 MySQL/PostgreSQL 多库配置
- [PPTX生成][eva_skills] PPTX模板中文黑体英文Times New Roman并自动按字符切换字体
- [PPTX生成][eva_skills] PPTX模板标题条置顶并改为全幅内容区布局
- [eva_skills][电子表格处理] 优化电子表格处理技能文档，补充快速流程/图表模板/质量检查并完成测试
- [PPTX生成][eva_skills] PPTX生成脚本新增图表支持并瘦身标题栏布局
- [frontend] 调整个人概况信息卡布局并改进额度环形图展示
- [frontend] 优化今日额度环形图尺寸与样式，移除中心文字
- [frontend] 调整个人概况额度卡片拉伸与统计卡片网格布局
- [frontend] 概况页精简统计项，新增今日额度环状图并修复刷新后统计归零
- [orchestrator][tool_result] 工具结果截断改为保留前后各 2000 字符，便于定位常见报错
- [frontend] 我的概况补充额度与上下文占用统计，支持工具/Token汇总
- [frontend] 聊天页用户信息支持直达我的概况，概况页补充对话统计数据
- [frontend] 聊天页隐藏功能广场按钮，主题切换改为太阳/月亮按钮
- [frontend] 广场搜索移至标题栏，移除设置按钮与概况卡片，概况入口改为用户信息区
- [frontend] 广场入口改为单列展示，移除核心功能/设置与侧边栏入口，外链统一合并到主入口列表
- [frontend] 聊天广场调整为 /home 并移除临时文件区入口

### 修复
- [mcp_server] 调整 MCP 数据库连接配置以通过鉴权
- [mcp_server] extra-mcp 默认不再注入 PERSONNEL_DB_* 环境变量，优先使用配置文件数据库地址
- [mcp][db] 默认数据库 description 会自动用于多库描述提示
- [mcp][db] MCP PostgreSQL 非查询语句兼容缺失 lastrowid
- [frontend] 优化图片预览放大尺寸并防止历史问询面板复显
- [frontend] 修复图片预览弹窗宽度与历史问询面板重复弹出
- [frontend] 修复聊天图片资源卡片对 SVG 预览的兼容性
- [frontend][backend] 优化个人概况统计布局并修复上下文占用刷新后缺失
- [frontend] 资源图片缺失时提示已移除并同步下载错误提示
- [frontend] 修复 portal.css 多余括号导致的构建错误
- [docs][readme] 修复README中文乱码并重写中文版说明
- [docs][readme] 修复README增量编译说明中文乱码
### 性能
- [sandbox] 沙盒规则与路径派生结果加入 LRU 缓存，降低高并发重复归一化开销
- [sandbox][tools] 沙盒命令执行优先直通启动，减少 bash 解析开销以降低高并发延迟
### 文档
- [docs] 清理设计方案与工具调用文档中已移除的附加提示词描述
- [docs] 更新 MCP 数据库配置说明为仅使用 mcp_config.json
- [mcp] 更新 mcp_server README 连接示例名称
- [mcp] 更新 mcp_server README：补充 MCP 连接示例并精简说明
- [mcp] 补充 mcp_server README 部署与 IP/DB 配置说明
- [docs][智能体] 补充智能体功能拓展方案的ABC等级与管理员覆盖策略
- [docs][智能体] 新增智能体功能拓展方案文档
### 工程
- [sandbox][build] 移除 tools.rs 中未使用的 Command 引用以清理编译告警
## 2026-01-26
### 新增
- [frontend] 新增用户侧功能广场与个人概况页，默认入口切换为广场并支持模块化外链配置
### 变更
- [frontend] 优化功能广场布局为单页内滚动面板，外链入口改由 external-links 配置集中管理
- [sandbox][admin][docs] 移除沙盒镜像配置项并同步配置示例与接口文档
- [skills][公文写作] 公文写作默认字体名称修正为仿宋_GB2312与楷体_GB2312
- [优化wunder] PPTX 视觉评分口径补充：空文本形状计入 non_text_shapes
- [技能][PPTX生成] PPTX 生成模板新增多套内置版式（report/lecture/education/defense/simple）并补充背景卡片
- [优化wunder] PPTX 熟练度评分权重调整：强调视觉与样式，降低流程/产物/内容权重
- [web] 为工作区文件读写接口补充 Python 示例
- [优化wunder] PPTX 评分用例增加前置清理要求：请求前删除 user_id 工作区与历史
- [优化wunder] PPTX 熟练度评分增加门槛：无非文本形状时视觉与样式整块记 0 分
- [web] 将接口示例从 curl 替换为 Python requests
- [web][docs] 重构管理端接口文档页面，改为左侧接口列表+右侧详情，并将接口信息维护到 web/docs/api-docs.json
- [技能][优化wunder] 调整PPTX熟练度评分权重并强调视觉样式
- [frontend][chat] 用户侧聊天输入支持拖拽上传，并将问询面板选择改为随发送按钮一起提交
- [技能][优化wunder] 补充PPTX生成任务的熟练度评分机制
- [技能][PPTX生成] 补充PPTX生成技能编辑约束与失败处理说明
- [技能][PPTX生成] 拆分字体与颜色常量并加标记，降低样式修改出错率
- [技能][PPTX生成] 简化PPTX生成模板输出路径，避免路径模块导致脚本失败
- [技能][PPTX生成] 优化PPTX生成技能模板与流程，增加可替换标记与输出文件变量
- [frontend] 前端支持从仓库根目录 .env 读取 VITE_API_BASE 作为 API 基础地址
- [web][debug] 调试面板稳定性按钮移至操作行最左侧

### 修复
- [技能][PPTX生成] PPTX 模板兼容旧版 PptxGenJS：ShapeType 缺失时回退为字符串形状
- [web] 修复工作区文件读写示例标题乱码
- [web] 修复接口文档 Python 示例中的中文乱码
- [web] 修复接口列表点击后折叠状态被重置导致跳回核心对话的问题
- [frontend][chat] 修复问询面板在同会话内二次弹出不显示的问题
- [公文写作] 二级/三级标题改为加粗并取消三级标题斜体
- [公文写作] 修复公文写作 DOCX 标题颜色默认变蓝的问题
### 性能
- [storage][postgres] 优化Postgres存储连接池与日志索引并改进会话锁并发
### 文档
- [docs][readme] 补充 docker compose 启动时增量编译判断说明
- [docs] 智能体调度平台的设计与实现 DOCX 补齐图片并通过 pandoc 重新生成
- [web][docs] 调整 paper2.md 的本体论表述为轻量补充
- [web][docs] 优化 paper2.md 结构，弱化本体论并作为补充说明
- [web][docs] 重构 paper.md，强化本体论语义层叙事与结构
- [readme] README-English 补充前端 API 基地址使用根目录 .env 配置说明
## 2026-01-25
### 新增
- [工具] 增加技能调用内置工具用于按技能名返回SKILL.md与目录结构
- [frontend] 聊天消息内的工作区资源链接支持图片预览与下载。
- [skills][优化wunder] 新增调试技能优化wunder，沉淀wunder调试流程与注意事项
- [skills][公文写作] 新增一键嵌图 DOCX 转换脚本并补充使用说明
- [web][debug] 调试面板新增长对话稳定性预设与自动化执行
### 变更
- [工具][sandbox] 执行命令移除shell参数并默认使用shell执行
- [工具][sandbox] 执行命令默认启用shell并放开限制
- [提示词][工具] 执行命令工具说明补充workdir仅限工作区相对路径且content不限制
- [工具][技能] 技能调用返回SKILL.md路径与技能根目录的绝对路径
- [提示词][技能] 技能使用协议移除第五条并同步英文描述
- [提示词][技能] 已挂载技能列表恢复输出SKILL.md路径与Frontmatter
- [提示词][技能] 已挂载技能列表补充描述字段展示
- [docker] wunder-server 启动前检查目标二进制是否过期，等待 sandbox 重新编译后再启动
- [web][monitor] 内部状态工具热力图中技能调用使用魔法棒图标
- [提示词][技能] 已挂载技能列表不再输出SKILL.md路径与Frontmatter
- [frontend] 窄屏时侧栏改为顶部按钮并弹窗展示临时文件区/历史记录
- [frontend] 窄屏时隐藏侧栏并在顶部提供临时文件区/历史记录按钮弹窗查看
- [提示词][工具] 技能提示词规则改为使用技能调用获取SKILL.md
- [frontend] 图片资源卡片标题与元信息合并同行展示，缩紧图片信息区
- [frontend] 优化图片资源卡片尺寸贴合预览，并支持点击放大查看
- [docker] wunder-server 不再等待 sandbox 健康检查，改为 service_started 以适配首次编译耗时
- [docker] 将 sandbox 的 CARGO_HOME 调整为 /app/.cargo，统一使用项目内 .cargo
- [docker] 放开 sandbox 容器对 /app 的只读挂载，允许写入 target 产物
- [docker] 调整 x86/arm compose 的 CARGO_TARGET_DIR 为项目内 target/x86 与 target/arm 目录，便于打包移植
- [prompt] 系统提示词补充资源输出指引，要求提供可访问的工作区路径与预览/下载链接。
- [frontend] 缩小聊天资源图片预览尺寸以避免占用过多空间。
- [frontend] 优化用户侧聊天窄屏布局：临时文件区与历史记录顶部并排，聊天区下置。
- [skills][优化wunder] 将实战示例移动至 examples 并细化流程
- [skills] 补充技能创建器脚本参数约束与最短执行清单
- [skills][优化wunder] 补充优化wunder技能的上下文压缩实战示例
- [prompts][skills] 优化问询面板规则与技能脚本指引，补充python3与路径/依赖检查要求
- [skills][优化wunder] 强调调试时必须设置 debug_payload 为 true
- [skills][公文写作] 代码块段落增加边框与底色
- [skills][公文写作] 代码块英文字体改为 Times New Roman
- [prompts] 系统提示词补充上下文摘要使用规则，避免摘要结构被直接复述
- [backend][prompts] 优化上下文压缩摘要结构并将摘要按系统上下文注入
- [skills][公文写作] 补充引用上标规范并在转换后自动将正文[数字]转为上标
- [skills][公文写作] DOCX 转换改用 pypandoc 并统一表格字体小一号/表头居中
- [skills][公文写作] 合并嵌图流程到 convert_markdown_to_docx 并移除独立嵌图脚本
- [web][debug] 调试面板模型输出轮次展示补齐总轮次/用户轮次/模型轮次三段信息
- [skills][公文写作] 一键转换脚本自动将 SVG 渲染为高分辨率 PNG 并移除手动嵌图说明
- [web][useraccounts] 用户管理设置的用户权限改为下拉选择 user/admin
- [backend][api] 事件流与会话事件移除 round 兼容字段，仅保留 user_round/model_round。
- [轮次] 明确用户轮次与模型轮次定义并在事件流监控与会话事件中补充 user_round/model_round 字段
- [web][debug] 增强长对话稳定性测试为图表与打包自动化流程
- [web][debug] 增强长对话稳定性测试题目难度与步骤
- [web][debug] 调试面板将长对话稳定性测试折叠为按钮并隐藏流式/新会话/锁定工具集选项
### 修复
- [frontend] 修复历史会话重放工作流事件时耗时统计被当前时间拉长的问题
- [docker] 修复 ARM 版 compose 复用 x86 构建产物导致的启动失败，隔离 CARGO_TARGET_DIR
- [frontend] 补齐浅色主题下发送/上传按钮悬停反馈样式
- [frontend] 模型输出结束后自动刷新临时文件区并重试资源卡片加载
- [frontend] 修复历史会话加载时按 user_round 关联工作流事件，避免工作流信息丢失
- [frontend] 修复工作区资源中文文件名显示与下载乱码问题。
- [frontend] 修复浅色主题下资源卡片样式与非图片资源误渲染为图片的问题。
- [skills][公文写作] pypandoc 调用增加 --quiet 以避免非 UTF-8 输出导致失败
- [skills][公文写作] 参考文献自动分段并优化代码块样式
- [skills][公文写作] 修正引用上标处理以覆盖表格并跳过参考文献段落
- [skills][公文写作] 表格单元格内容改为垂直居中
- [skills][公文写作] 清理样式主题字体并同步字符样式，避免标题回退到 MS 字体
- [backend][orchestrator] 修复上下文压缩在附件场景下可能遗漏当前问题，并裁剪摘要以确保回填后占用可控
- [skills][公文写作] pandoc 输出后补齐正文/标题样式字体并统一表格边框
- [web][debug] 调试面板 Token 占用改用上下文占用并补充计费 Token 消耗展示
- [web][debug] 调试面板统计信息 Token 文案改为占用用于上下文占用提示
- [skills][公文写作] 一键嵌图脚本优先复用已有 PNG 并修正 SVG 处理逻辑
- [web][debug] 调整调试面板模型输出按模型轮次渲染并展示用户轮次，避免不同用户轮次混淆
- [docs][web] 调整 docx 图片段落行距避免遮挡
- [web][backend] 修复管理端监控线程详情解码速度统计，按轮次累计排除工具耗时，并修复管理端中文文案乱码
- [docs][web] 修复 docx 表格样式与图片排版问题
- [frontend] 美化浅色主题系统提示词预览关闭按钮悬停交互样式
- [frontend] 浅色主题系统提示词预览关闭按钮补充悬停交互
- [frontend] 浅色主题下系统提示词预览关闭按钮改为浅色样式
- [skills][公文写作] 公文写作脚本识别已有标题编号避免重复编号
- [frontend][workspace] 用户侧临时文件区 SVG 预览改用 content 接口构建
- [frontend][workspace] 用户侧临时文件区 SVG 预览改用 iframe 并补白底
- [web][workspace] LSP 工作区双击非文本文件时改为预览而非编辑
- [web][frontend][workspace] 改用 Blob MIME 修正方式提升 SVG 预览兼容性
- [frontend][workspace] 用户侧临时文件区 SVG 预览补齐 MIME 处理
- [web][workspace] 修复临时文件区 SVG 预览未正确显示的问题
- [web][frontend] 修复管理端线程详情耗时与统计信息展示，并校准用户端会话耗时为完整交互时长
- [backend][orchestrator] 补齐工具执行结果截断与输出统计辅助，修正 llm_output_delta 回放过滤测试

### 性能
- [mcp][backend] MCP 工具清单拉取增加短 TTL 缓存，降低重复刷新开销
### 文档
- [prompts] 同步 system.txt 中英文提示词
- [docs] 重写系统介绍为管理层完整版，保留流程图并补充治理与工具细节
- [docs] 重写系统介绍为管理层版本，突出原理流程与价值
- [技能] 强化优化wunder对乱码样本的规避说明
- [技能][提示词] 补充优化wunder技能调试流程与实战示例
- [技能] 调整技能脚本执行示例，去除工作目录外的绝对路径
- [技能] 修正技能脚本执行说明，强调在工作目录执行
- [readme] 修复 README.md 中文乱码并统一为 UTF-8
- [readme][docs] 更新 README 与请求示例，补充 A2A/调试入口/存储与 Skills 说明并修正文档过时路径
- [skills][公文写作] 将图片段落修正流程设为必做并提供修复脚本
- [skills][公文写作] 补充 Linux 下 pandoc resource path 分隔与示例
- [skills][公文写作] 补充 pandoc 嵌图流程与图片段落排版说明
- [docs][web] 使用 pandoc 嵌入论文图示生成 docx
- [docs][web] 修复工具管理流程图中文乱码，新增 Agent Loop 图并同步论文 docx
- [docs][系统优化] 补充节点任务拆解与发布门槛三件套
- [docs][系统优化] 深化系统优化方案的可行性评估与节点细化
- [docs][系统优化] 补充系统优化方案的深入分析与持续推进节点
- [docs][web] 补充论文多轮对话 Agent Loop 与长期稳定运行方法说明
- [docs] 修复系统优化方案与设计/API文档中审批与缓存描述的乱码与字段说明
- [docs] 更新系统优化方案节点状态并补充审批缓存/MCP 缓存说明
- [docs] 同步 exec_policy_mode 与 context_usage/tool_result 事件说明
### 安全
- [backend][exec_policy] exec_policy 高风险命令支持审批标记与会话级缓存
### 工程
- [sandbox] 移除执行命令中未使用的shell解析辅助函数
- [backend] 移除提示词构建中的未使用路径辅助函数以消除编译警告
### 移除
- [skills][公文写作] 移除独立的 docx 图片修复脚本
## 2026-01-24
### 变更
- [管理端][性能测试] 性能测试增加权限/工具解析耗时指标
- [admin] 技能管理选择技能时默认打开 SKILL.md
- [admin] 内部状态热力图问询面板使用提问图标
- [skills][eva_skills] EVA_SKILLS 技能目录与名称统一为中文（公文写作、MCP服务构建、PDF处理、PPTX生成、SVG生成、技能创建器、电子表格处理）
### 修复
- [skills][公文写作] Markdown 转 DOCX 标题字体未按配置生效的问题
### 性能
- [sandbox][command_exec] 沙盒命令执行支持异步子进程，减少高并发排队
- [sandbox] 为沙盒命令执行增加线程池与 worker 可配置项
- [backend] 缓存工具路径根目录，减少高并发文件操作的路径归一化开销
### 文档
- [docs][系统优化] 新增系统优化方案文档
- [docs] 同步论文与架构图副本
- [docs] 更新架构图 SVG 与用户前端文档中的模块路径说明
- [docs] 更新设计/系统/API 文档与性能优化说明，补充 sandbox 模式与 prompts 路径。
- [docs] 补充沙盒命令执行并发优化说明
- [docs] 补充工具路径根目录缓存优化说明与指导
- [docs] 在AGENTS.md补充功能迭代类型清单
- [docs] 迁移旧记录至功能迭代-old.md并将记录规范移至AGENTS.md
- [docs][scripts] 建立分类化变更记录规范并升级写入脚本。
### 重构
- [backend][src] 整理 src 目录结构为 core/services/ops/sandbox，并移除未使用的旧后端代理代码。
- [sandbox][backend] 沙盒服务改为 Rust sandbox 模式运行，移除 app 并将提示词迁移至 prompts/。
### 工程
- [docker][sandbox] docker compose 改为由 sandbox 先编译共享产物，主服务直接启动 wunder-server。
- [infra] 补充沙盒并发调优环境变量示例
<!-- changelog:end -->




