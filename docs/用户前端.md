# 用户侧前端与桌面一体化说明（2026-02）

## 1. 当前定位

- 用户侧已从“单页聊天”升级为“通信/办公化消息工作台”，交互风格向飞书类产品靠齐。
- 前端能力统一沉淀在 Messenger 单壳中，优先服务 desktop 形态，同时兼容 web（`/app/*`）与 demo（`/demo/*`）。
- 体系目标保持与平台主定位一致：**形态协同 / 租户治理 / 智能体协作 / 工具生态 / 接口开放**。

## 2. 路由与壳层结构

- 默认入口：
  - web：`/app/home`
  - desktop：`/desktop/home`
- 统一壳层：`/app/home|chat|user-world|workspace|tools|settings|profile|channels|cron`（desktop 与 demo 同构）。
- 外链页：`/app/external/:linkId`（desktop 对应 `/desktop/external/:linkId`，demo 对应 `/demo/external/:linkId`）。
- 系统级 desktop 设置单独使用 `/desktop/system`，承载模型、容器映射与远端接入。

## 3. Messenger 单壳能力

- 三栏布局：左侧导航（messages/users/groups/agents/tools/files/more）+ 中栏列表 + 右侧会话与扩展面板。
- 双会话域并行：
  - 用户↔智能体：`/wunder/chat/*`
  - 用户↔用户（User World）：`/wunder/user_world/*`
- 右侧扩展区：沙盒、时间线、智能体设置等能力不再分散在多个页面，统一在会话上下文内操作。
- 用户工具体系内嵌：内置工具、MCP、Skills、知识库、共享工具在同一壳层可视化管理。

## 4. 桌面优先与端云协同

- desktop 默认通过本地桥接运行前端并注入 runtime（`window.__WUNDER_DESKTOP_RUNTIME__`）。
- 本地模式：自动使用本地 token，开箱可用。
- 远端模式：通过 `remote_gateway.server_base_url` 切到云端 `/wunder`，按常规登录鉴权，失败自动回退本地。
- 容器目录管理：`/wunder/desktop/settings` 提供容器映射与本地目录浏览，`/wunder/desktop/sync/seed/*` 支持本地目录初始化同步到云端工作区。

## 5. 关键前端模块（代码对齐）

- 路由总入口：`frontend/src/router/index.ts`
- 消息工作台主视图：`frontend/src/views/MessengerView.vue`
- 会话壳状态：`frontend/src/stores/sessionHub.ts`
- 用户世界状态：`frontend/src/stores/userWorld.ts`
- desktop 运行时与远端接入：`frontend/src/config/desktop.ts`、`frontend/src/views/DesktopSystemSettingsView.vue`
- 用户工具与频道管理：`frontend/src/api/userTools.ts`、`frontend/src/api/channels.ts`

## 6. 约束与维护要求

- 保持浅色/深色主题一致性，不使用 `backdrop-filter`。
- 默认传输策略保持 WebSocket 优先，SSE 兜底。
- frontend 检索时避免直接扫根目录，优先限定 `src/` 子目录范围。
- 质量门槛：`npm run typecheck` 与 `npm run build:check`。

## 7. 关联后端接口

- 认证：`/wunder/auth/*`
- 智能体会话：`/wunder/chat/*`、`/wunder/chat/ws`
- 用户世界：`/wunder/user_world/*`、`/wunder/user_world/ws`
- 用户工具：`/wunder/user_tools/*`
- 用户智能体：`/wunder/agents*`
- 用户渠道：`/wunder/channels/*`
- desktop 本地接口：`/wunder/desktop/*`（仅 desktop 本地桥接路由可用）
