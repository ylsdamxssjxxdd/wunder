# ????? JS ? TS ?????????frontend?

> ???v1.0  
> ???2026-02-09  
> ???? `frontend/src` ? JavaScript ????? TypeScript????????????? WebSocket ???SSE ???????

---

## 1. ???????

### 1.1 ??
- ??????? **100% TS ?**?`frontend/src` ???? `.js` ?????
- ??????????????????????????????????????
- ???????????????????????????????????????
- ???????`vue-tsc --noEmit` + `vite build` ??????

### 1.2 ??
- ?????????`frontend`?
- ????????? `web` ? TS ???
- ??? Rust ????????????????????????

---

## 2. ??????????

### 2.1 ??????
- `frontend/src` ?? **38 ? `.js` ??**?? **8900 ?**?
- ?? **49 ? `.vue` ??**?`<script setup>` ??? **11573 ?**?
- ????????? **2.0 ??**??????????

### 2.2 ???????????
- `frontend/src/stores/chat.js`?3442 ?????/??/??/?????????
- `frontend/src/components/chat/WorkspacePanel.vue`???? 1931 ??????????????????????
- `frontend/src/views/ChatView.vue`???? 1489 ????????????????????
- `frontend/src/components/user-tools/UserKnowledgePane.vue`???? 1398 ???????????
- `frontend/src/i18n/messages/*.js`?????? 2000 ???????????

### 2.3 ???????
- `@/i18n` ? 55 ?????????????????
- `@/utils/apiError` ? 20 ???????????????????
- ??????????? payload ???`?.`?`JSON.parse`?????????TS ??????
- ??? TS ?????? `tsconfig` / `vue-tsc` / `.d.ts`???????????

---

## 3. ??????????????

### 3.1 ???
- **????**??? TS ??????? JS/TS ??????? `allowJs`?
- **??????**????????????????
- **???????**?????? composable/?????? TS?????????
- **?????????**????????????????????????

### 3.2 ????????
```text
frontend/src/
  types/
    api.ts
    auth.ts
    agent.ts
    chat.ts
    workspace.ts
    user-tools.ts
    i18n.ts
  stores/
    chat/
      index.ts
      types.ts
      state.ts
      persist.ts
      stream.ts
      workflow.ts
      snapshot.ts
  composables/
    chat/
    workspace/
```

---

## 4. ????????????????

## ?? N0????????????0.5 ??
**??**?????????????????????

**??**
- ??????????`npm run build`?
- ?????????`.js` ??????? SFC ??????????/???/???????????
- ??????????? 6 ???

**??**
- ?????????
- `frontend` ???????????????????

**????**
- ????????????????

---

## ?? N1?TS ???????1 ??
**??**?? TS ???????????? JS?

**??**
- ?????`typescript`?`vue-tsc`?`@types/node`?
- ?????`frontend/tsconfig.json`?`frontend/tsconfig.node.json`?
- ?????`frontend/src/env.d.ts`?`import.meta.env`??`frontend/src/shims-vue.d.ts`?
- `vite.config.js` ? `vite.config.ts`????? alias ? envDir ???
- `package.json` ?????`typecheck`?`build:check`??? typecheck ? build??

**????????**
- `allowJs: true`
- `checkJs: false`
- `strict: true`
- `noEmit: true`
- `isolatedModules: true`

**????**
- `npm run typecheck` ??????????
- `npm run build` ?????

---

## ?? N2????????1.5 ??
**??**??????????? + ?????????????????

**??**
- ?? `src/types/api.ts`?
  - `ApiEnvelope<T>`?`PagedResult<T>`?`TraceableErrorPayload`?
- ?? `src/types/chat.ts`?
  - `ChatSession`?`ChatMessage`?`MessageStats`?`ChatStreamEvent`?SSE/WS ???????
- ?? `src/types/workspace.ts`?
  - `WorkspaceEntry`?`WorkspaceFile`?`WorkspaceFolderTree`?
- ?? `src/types/user-tools.ts`?MCP/??/??????
- ?? `src/types/i18n.ts`????????????

**????**
- ???? `data.data` ????? `ApiEnvelope<T>` ?????????????
- ???????????`type` / `event`????????????

**????**
- ?????? API ?? store ????
- ????????????????

---

## ?? N3???????????1.5 ??
**??**??????????? TS ?????

**????????**
- `src/config/*.js`
- `src/utils/clipboard.js`
- `src/utils/maintenance.js`
- `src/utils/workspaceEvents.js`
- `src/utils/workspaceResources.js`
- `src/utils/toolSelection.js`
- `src/utils/toolSummary.js`
- `src/main.js`?`src/router/index.js`

**????**
- ???? `.ts`????????????
- `CustomEvent` ? `window` ?????????
- ?? `meta` ???????`requiresAuth`?`requiresAdmin`?`demo`??

**????**
- ????? `typecheck` ????
- ???????????

---

## ?? N4?API ???? Store ???2 ??
**??**???????? ? store ???????

**??**
- API?? `chat.js` ???? API ???????`auth/admin/agents/channels/cron/swarm/userTools/workspace`??
- Store?`auth/agents/admin/workspace/theme/performance`?
- `utils/apiError.js` ???????

**????**
- ? axios ???? `AxiosInstance` ?????????
- ? `multipart/form-data` ???????????
- store ? state/getter/action ?????????? `any`?

**????**
- ???? `.js` ???
- ??/???????????????????????????

---

## ?? N5????? SFC ???2.5 ??
**??**????????? Vue ???? `<script setup lang="ts">`?

**????????**
- layouts?portal ?????admin ??????????
- ???????`PortalView.vue`?`CronManagerView.vue`?`ProfileView.vue`?

**????**
- `defineProps` ???????`defineProps<Props>()`?
- `defineEmits` ????????????????
- ?? `ref<T>`/`computed<T>` ????? `null | undefined` ???

**????**
- ?????? `lang="ts"`?
- ????????????????????

---

## ?? N6??????? + TS ???4 ???????
**??**???????????????? TS ??

**??????**
- `src/stores/chat.js`
- `src/api/chat.js`
- `src/utils/ws.js`
- `src/utils/sse.js`
- `src/views/ChatView.vue`
- `src/components/chat/WorkspacePanel.vue`
- `src/components/chat/*` ???????

**????????????**
1. `stores/chat` ??? `state/persist/stream/workflow/snapshot` ????  
2. `ChatView.vue` ?? composables???????????????????????  
3. `WorkspacePanel.vue` ?? composables??????????????????????  
4. WS/SSE ????? `ChatStreamEvent` ?????????????

**????**
- ?? WS ???SSE ???????
- ???????resume/cancel??????
- ?? token/context ??????????????????????

**????**
- ?????????/????/??/??/??????????
- ??? `typecheck` ?????? `@ts-ignore` ???

---

## ?? N7?i18n ????1 ??
**??**????? i18n ??????????

**??**
- `i18n/messages/*.js` ? `*.ts`??? `as const`?
- ? `zh-CN` ????? `I18nKey`??? `en-US` ????
- `i18n/index.ts` ? `t(key)` ???????
- ? `tsconfig` ????`allowJs: false`?

**????**
- `frontend/src` ? `.js` ?????
- ???????????

---

## ?? N8???????????1 ??
**??**?????????????????

**??**
- ?????`npm run typecheck`?`npm run build`?
- ?? CI ??????????????
- ????????????????????

**????**
- ???? 0?
- ?????
- ?????????

---

## 5. ???????????

### P0???????????
- `frontend/src/stores/chat.js`
- `frontend/src/views/ChatView.vue`
- `frontend/src/components/chat/WorkspacePanel.vue`
- `frontend/src/utils/ws.js`
- `frontend/src/api/chat.js`

### P1???????????
- `frontend/src/components/user-tools/UserKnowledgePane.vue`
- `frontend/src/components/user-tools/UserMcpPane.vue`
- `frontend/src/components/user-tools/UserSkillPane.vue`
- `frontend/src/views/PortalView.vue`
- `frontend/src/views/ProfileView.vue`
- `frontend/src/utils/markdown.js`

### P2???????????
- `frontend/src/config/*.js`
- `frontend/src/router/index.js`
- `frontend/src/main.js`
- `frontend/src/stores/{auth,admin,agents,workspace,theme,performance}.js`
- ??????

---

## 6. ??????????

- ????
  - `frontend/src` ???? `.js` ?? = 0?
  - `vue-tsc --noEmit` ?? = 0?
  - `vite build` ???
- ????
  - ???????????????????????WS/SSE ?????????
  - ???????????????????????????/???
  - ?????????????MCP/??/?????????
- ????
  - ??? `@ts-ignore`?????????????????????
  - ??? `backdrop-filter` ???????

---

## 7. ?????

- ?? 1???????????????????  
  ??????? N6?????????????????? `typecheck`?

- ?? 2?i18n ???????????? key?  
  ???N7 ?????????CI ???

- ?? 3?Axios/?????????????????????  
  ????? `ApiEnvelope<T>`????????? adapter ????

- ?? 4????????? JS?  
  ???`allowJs: false` + CI ??????????? TS?

---

## 8. ????????

- N0-N2?3 ?
- N3-N5?6 ?
- N6?4 ?
- N7-N8?2 ?

**???? 15 ??**???????????

---

## 9. ????

- ?????????????????????????
- ??????????????????
- ????????????? N6 ?????????????????????/??/????
