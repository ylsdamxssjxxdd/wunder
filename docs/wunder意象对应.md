# wunder 意象对应（EVA Wunder 版）

> 说明：本文是 **产品叙事意象映射**，用于命名、讲解、培训与演示，不是 EVA 正史设定考据。
> 目标：把 wunder 的页面、元素、模块、协议、流程、治理能力，尽可能映射到 EVA 里的「Wunder 号」舰船语义。

## 1. 总体系统意象（核心概念）

| wunder 元素 | EVA Wunder 意象 | 对应说明 |
| --- | --- | --- |
| wunder 平台整体 | Wunder 号空中战舰 | 统一承载作战（请求）、编排（调度）、兵装（工具）、保障（治理）。 |
| `/wunder` 统一入口 | 主登舰甲板/总进舰口 | 所有任务从同一入口进入，统一分流。 |
| 用户请求（question） | 作战指令 | 每次输入即一次任务下达。 |
| 用户轮次 | 指挥官口令轮次 | 每条用户消息算 1 次口令。 |
| 模型轮次 | 舰内动作轮次 | 模型调用/工具调用/最终回复都算动作。 |
| 智能体（Agent） | EVA 机体 | 执行任务的核心单元，具备独立配置与行为风格。 |
| 世界/蜂巢（Hive） | 作战编队/战区甲板 | 同一用户下的多编队容器，承载多机体协同。 |
| 蜂群（Swarm） | 多机编队突击 | 多智能体并行协作执行复杂任务。 |
| AgentRuntime | 出击管制系统 | 负责接收任务、判定排队、分发执行。 |
| Orchestrator 调度引擎 | 舰桥核心中枢（神经核心） | 决定每一轮该调用模型还是工具、何时收束为最终回复。 |
| LLM 调用层 | 机体神经中枢/驾驶同调层 | 负责理解与决策。 |
| 工具系统（Tooling） | 武装与作业挂点 | 所有能力统一成可调用武器/工装。 |
| MonitorState | CIC 态势屏 | 记录状态、事件、告警、取消等运行态。 |
| Memory | 战术记忆仓 | 保存长期记忆，支持后续任务注入。 |
| Context Compaction | 战报压缩归档 | 上下文超限时压缩摘要，保证长航续航。 |
| Workspace | 机库与整备舱 | 文件产物落地与持续复用区。 |
| PostgreSQL | 舰船主档案库 | 结构化核心状态与业务数据。 |
| Weaviate/向量检索 | 战术情报检索阵列 | 语义检索知识片段。 |
| Sandbox | 危险动作隔离试验舱 | 命令/ptc 等高风险执行的隔离层。 |
| GatewayHub | 联合舰队通信中继核心 | 连接 node/operator/channel，完成控制面路由。 |
| ChannelHub | 对外通信甲板 | 对接飞书/WhatsApp/QQ 等外部消息通道。 |
| A2A | 友舰协同协议 | 与外部智能体系统标准化协作。 |
| A2UI | 舰桥可视化战术投影 | 将结果直接转成结构化可渲染 UI。 |
| 定时任务（Cron） | 自动巡航时序器 | 定时触发任务，降低人工值守成本。 |
| 权限与组织治理 | 舰员编制与军令层级 | 按角色、单位、白名单做访问管控。 |
| 配额系统 | 能源/弹药配给制度 | 控制每日可用调用量。 |
| Token 占用统计 | 舱容占用计量表 | 统计上下文占用量（非总计费）。 |

## 2. 用户侧前端（`frontend`）页面与元素映射

| 页面/元素 | EVA 意象 | 说明 |
| --- | --- | --- |
| `/login` 登录 | 登舰闸门 | 身份校验后才可进入战舰操作域。 |
| `/register` 注册 | 新舰员入列 | 建立新身份与权限起点。 |
| `/app/home` 世界主页（Portal/Beehive） | 作战总览甲板 | 选择世界、查看智能体应用、进入任务。 |
| 世界切换器 | 编队切换旋钮 | 在不同作战编队间切换。 |
| 智能体应用卡片 | 机体停机位 | 每张卡就是一台可出击机体。 |
| 新建智能体应用 | 新机体建造工位 | 快速复制/组装能力。 |
| 共享智能体应用 | 联合作战机位 | 来自同级共享池的机体入口。 |
| `/app/chat` 聊天页 | 驾驶舱 | 任务实时执行与回传主界面。 |
| ChatComposer/输入框 | 发令终端 | 发出即时作战指令。 |
| MessageList/消息流 | 作战电台记录 | 过程与结果逐条回显。 |
| MessageThinking/Workflow | 战术推演轨迹 | 展示中间推理和工具动作。 |
| PlanPanel | 作战计划板 | 分步骤执行路线。 |
| InquiryPanel | 指挥确认回路 | 需要用户决策时的岔路确认。 |
| SwarmPanel | 编队协同态势窗 | 查看 TeamRun/TeamTask 进度。 |
| WorkspacePanel（聊天侧） | 机库快取托盘 | 对话内快速挂载/查看文件。 |
| `/app/workspace` 工作区 | 机库主整备区 | 文件浏览、编辑、上传、下载、批处理。 |
| 文件树/搜索/排序 | 仓储索引雷达 | 快速定位作业资产。 |
| 预览/编辑器 | 舱内检修台 | 文档检查与即时修改。 |
| `/app/tools` 工具管理 | 武装挂载台 | 管理 MCP/技能/知识库/共享工具等能力。 |
| UserSharedToolsPanel | 联合作战武器架 | 启用他人共享能力。 |
| `/app/cron` 定时任务 | 自动值守控制台 | 周期任务计划与执行开关。 |
| `/app/channels` 渠道管理 | 对外通信频段台 | 配置通道账号与路由。 |
| `/app/settings` 设置 | 舰桥参数舱 | 调整个人与系统偏好。 |
| `/app/profile` 我的概况 | 舰员档案室 | 个人资料、权限、状态展示。 |
| `/app/external/:linkId` 外链应用 | 友舰跳转舱门 | 跳转到外部协作应用。 |
| Demo 模式（`/demo/*`） | 训练模拟仓 | 演示流程，不影响正式战场。 |
| 主题切换（浅/深） | 日战/夜战照明模式 | 不同光照场景下保持可读性。 |
| 维护遮罩 | 红色警戒封舱 | 服务维护期间统一拦截提示。 |

## 3. 管理端（`web`）面板与元素映射

| 管理端面板 | EVA 意象 | 说明 |
| --- | --- | --- |
| 内部状态（Monitor） | CIC 总态势中心 | 运行状态、线程、事件、告警总览。 |
| 系统设置 | 舰桥总开关台 | 全局参数、轮询、执行策略。 |
| 单位管理 | 舰队编制管理室 | 组织树、负责人、层级治理。 |
| 用户管理（user_accounts） | 舰员花名册 | 账号、密码、权限、配额管理。 |
| 线程管理（users/sessions） | 出击记录室 | 会话/线程历史与行为追踪。 |
| 外链管理 | 对外联络登记台 | 控制可用外部入口。 |
| 渠道监控 | 通信塔值班席 | 监控飞书/WhatsApp/QQ 等接入状态。 |
| 模型配置（LLM） | 驾驶核心调校台 | 模型、温度、上下文、超时等参数。 |
| 记忆管理 | 战术记忆仓管控台 | 记忆队列、状态、启停与清理。 |
| 工具管理总面板 | 兵装总库 | 统一查看并管理所有工具类型。 |
| 内置工具面板 | 标配舰载武装库 | 系统原生工具集。 |
| MCP 面板 | 外接模块坞舱 | 挂载外部 MCP 服务。 |
| 知识库面板 | 情报档案室 | 文档、分块、Embedding、重建。 |
| A2A 服务面板 | 友舰协同通信台 | 对接外部智能体服务与 AgentCard。 |
| 技能管理面板 | 标准作战条令库 | SKILL.md 流程化能力管理。 |
| 系统提示词 | 指挥口令母版室 | 对系统行为进行顶层约束。 |
| 吞吐量测试 | 航速压测跑道 | 并发与速率极限验证。 |
| 性能测试 | 机能检测台 | 延迟、资源、稳定性采样。 |
| 能力评估 | 实战靶场 | 基准用例、回归评估、结果对比。 |
| 调试面板 | 现场指挥台 | 请求构造、流式日志、输出观察。 |
| LSP 面板 | 故障诊断台 | 代码诊断、语言服务能力观测。 |
| API 文档 | 舰内操作手册 | 接口定义与调用规范。 |
| 论文/幻灯片 | 战术简报室 | 对外说明与培训展示材料。 |

## 4. 协议与接口族映射

| 接口族 | EVA 意象 | 说明 |
| --- | --- | --- |
| `/wunder` | 主作战航道 | 通用请求入口。 |
| `/wunder/ws` | 主通信链路 | 实时事件流主通道。 |
| `/wunder/chat/ws` | 驾驶舱高速频道 | 聊天会话实时流。 |
| SSE 流式 | 备用通信频段 | 主链路不可用时兜底。 |
| `/wunder/chat/*` | 任务会话控制面 | 创建、发送、取消、附件处理。 |
| `/wunder/workspace/*` | 机库作业口 | 文件管理与资产沉淀。 |
| `/wunder/user_tools/*` | 个人兵装口 | 用户自建/共享工具能力管理。 |
| `/wunder/auth/*` | 门禁认证系统 | 注册、登录、身份查询。 |
| `/wunder/admin/*` | 舰桥高权限总线 | 仅管理席可调用。 |
| `/wunder/channel/*/webhook` | 外部电台入站口 | 渠道消息接入。 |
| `/wunder/channels/*` | 渠道配置总线 | 用户侧渠道配置与查询。 |
| `/wunder/gateway/ws` | 联合舰队控制链路 | node/operator 长连接通道。 |
| `/wunder/admin/gateway/*` | 舰队控制面控制台 | 节点管理、invoke、presence。 |
| `/a2a` | 盟舰标准协议口 | 外部 Agent 系统互操作。 |
| `/wunder/mcp/*` | 扩展坞协议口 | 外挂 MCP 服务调用与治理。 |

## 5. 代码目录与舰体分区映射

| 目录/模块 | EVA 意象 | 说明 |
| --- | --- | --- |
| `src/api` | 舷侧接口甲板 | 对外路由和协议适配。 |
| `src/orchestrator` | 核心反应中枢 | 模型-工具循环、上下文、事件流。 |
| `src/services` | 舰内子系统群 | 用户、工具、知识、工作区、记忆等服务。 |
| `src/channels` | 通信天线阵列 | 多渠道消息入站/回包。 |
| `src/gateway` | 舰队联控桥 | 节点连接管理与转发。 |
| `src/storage` | 黑匣子与档案层 | Postgres/SQLite 存储抽象。 |
| `src/ops` | 机务保障中心 | 监控、吞吐、性能、评估。 |
| `src/sandbox` | 隔离试验舱 | 高风险执行隔离。 |
| `frontend` | 舰员驾驶界面 | 用户任务执行与资产操作。 |
| `web` | 指挥官舰桥界面 | 管理、监控、调优、治理。 |
| `config` | 舰船参数蓝图 | 全局配置、模型与工具策略。 |
| `prompts` | 指挥口令模板库 | 系统提示词与行为规范。 |
| `knowledge` | 战术知识档案库 | 文档语料与检索输入。 |
| `mcp_server` | 外接补给接口站 | MCP 侧能力接入。 |
| `scripts` | 舰务自动化工具箱 | 运维脚本与流程辅助。 |
| `fonts` | 舰载渲染资源库 | 图形/文档生成字体保障。 |

## 6. 工具体系映射（全量）

### 6.1 六类工具体系

| 工具类型 | EVA 意象 | 说明 |
| --- | --- | --- |
| 内置工具 | 舰载标准武装 | 开箱即用，覆盖核心执行动作。 |
| MCP 工具 | 外接模组武装 | 通过标准协议挂载第三方能力。 |
| Skills | 标准作战条令 | 任务流程化、SOP 化执行。 |
| 知识库工具 | 战术情报检索器 | 将知识文档转为可召回能力。 |
| 自建工具 | 个人改装工位 | 用户自定义能力，隔离可控。 |
| 共享工具 | 联合舰队共享武器架 | 共享配置，不共享工作区本体。 |

### 6.2 20 个内置工具逐项映射

| 内置工具 | EVA 意象 | 作用说明 |
| --- | --- | --- |
| 最终回复 | 对外广播终端 | 发布最终作战结论。 |
| a2ui | 战术全息投影仪 | 输出结构化 UI 片段。 |
| 计划面板 | 作战步骤板 | 维护阶段任务与状态。 |
| 问询面板 | 指挥确认开关 | 将关键分歧回传用户决策。 |
| 定时任务 | 自动巡航时序器 | 创建/更新/执行周期任务。 |
| a2a观察 | 友舰侦察窗 | 观察外部 A2A 任务状态。 |
| a2a等待 | 通联待机通道 | 等待外部 A2A 结果回传。 |
| 执行命令 | 机舱操控杆 | 在策略约束下执行命令。 |
| ptc | 临时加工台 | 即席脚本执行与产物生成。 |
| 列出文件 | 舱内仓储扫描仪 | 查看目录与文件清单。 |
| 搜索内容 | 情报搜索雷达 | 在文件中快速检索目标内容。 |
| 读取文件 | 档案调阅终端 | 读取文本内容供推理。 |
| 技能调用 | 条令执行器 | 触发已登记技能流程。 |
| 写入文件 | 战报写入器 | 新建并写入文件产物。 |
| 替换文本 | 维修替换扳手 | 定位并替换目标文本段。 |
| 编辑文件 | 精修作业工位 | 按指令精确编辑文件。 |
| LSP查询 | 机体诊断仪 | 代码语义诊断与问题定位。 |
| 子智能体控制 | 单机出击控制台 | 列表/发送/历史/派生子智能体。 |
| 智能体蜂群 | 编队协同指挥盘 | 多智能体范围化协作。 |
| 节点调用 | 分舰远程指挥器 | 调用 Gateway 节点能力。 |

## 7. 数据、治理与运行规则映射

| wunder 概念 | EVA 意象 | 说明 |
| --- | --- | --- |
| `user_id`（可虚构） | 战术呼号 | 任务路由标识，不必是注册舰员。 |
| 注册用户账号 | 实名舰员档案 | 用户管理面板中的真实账号体系。 |
| `session_id` | 单次出击编号 | 会话级别的任务上下文容器。 |
| `agent_id` | 机体编号 | 指定由哪台机体执行任务。 |
| `hive_id` | 编队编号 | 限定蜂群/应用作用域。 |
| 主线程+队列 | 出击排班系统 | 忙时入队，空闲时出击。 |
| 断点恢复（stream_events） | 战斗日志回放 | 断线后按事件续接。 |
| 会话取消 | 紧急返航指令 | 终止当前执行链路。 |
| allow_paths/allow_commands | 安全闸门白名单 | 限制执行边界，避免误伤舰体。 |
| 角色（user/admin/super_admin） | 舰员/值班官/舰长权限层 | 按层级授予能力。 |
| 单位层级与配额 | 舰队补给优先级 | 不同层级拥有不同资源预算。 |
| 工具白名单/黑名单 | 武装授权卡 | 控制哪些能力可挂载。 |
| 渠道账号绑定 | 通信终端绑定表 | 将外部消息映射到内部会话。 |
| Outbox + Retry | 发报缓冲与重发机制 | 提升外发稳定性。 |
| Feishu 长连接 | 常驻通讯天线 | 持续在线接收外部消息。 |
| 可观测性指标 | 舰体健康仪表盘 | 速率、耗时、异常、占用可观测。 |

## 8. 典型链路意象：一次请求如何“出击”

1. 用户在聊天页下达指令（作战口令进入登舰口）。
2. AgentRuntime 判定机体是否忙碌（是否排队等候出击）。
3. Orchestrator 在舰桥核心循环决策（模型思考 ↔ 工具动作）。
4. 需要文件/知识/外部能力时，调用机库、情报阵列、外接模块。
5. 中间过程通过 WS 实时回传（主通信），必要时切到 SSE（备用频段）。
6. 任务结果落库并写入工作区（战报归档 + 产物入库）。
7. 监控与评估面板记录全流程（供复盘、压测、优化）。

## 9. 命名与叙事落地建议（可选）

- 用户侧可沿用“世界/机体/编队/机库/出击”术语，提高学习一致性。
- 管理端可沿用“舰桥/态势/兵装库/情报室/编制室”术语，突出治理定位。
- 对外文档建议加一句固定释义：**“对开发者一切是接口，对模型一切是工具；在叙事层上，wunder 像一艘持续作战的空中战舰。”**
