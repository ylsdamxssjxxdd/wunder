---
名称: 公文写作
描述: 这是一个用于生成标准公文格式文档的技能。适用于将 Markdown 内容转换为符合标准公文规范的 DOCX。
---

# 公文写作（Markdown -> DOCX）
## 概要
本技能用于将公文内容先以 Markdown 结构化输出，并保存为本地md文件，再通过脚本转换为标准 DOCX。优先保证结构清晰、格式可控、结果可复用。

## 快速流程
1. 明确公文要素：标题、主送、正文、附件、落款、日期、抄送、印发等。
2. 输出 Markdown 文本（结构见下）。
3. 保存为 `.md` 文件。
4. 运行 `scripts/convert_markdown_to_docx.py` 生成 DOCX。

## Markdown 结构约束
- 这里的“一级/二级/三级/四级”指公文层级，不是 Markdown 的 `#` 层级。
- `#` 只出现一次，为主标题（公文标题），不自动编号。
- `##` 为公文一级标题（自动补“一、”）。
- `###` 为公文二级标题（自动补“（一）”）。
- `####` 为公文三级标题（自动补“1.”）。
- `#####` 为公文四级标题（自动补“（4）”）。
- 因为脚本会自动将标题补全，所以你不需要再md中标上序号等。
- md的内容中不要有过多的换行，避免转换后的文档有冗余的换行。
- 需要自定义编号时请在标题中直接写编号，转换器会保留；若编号样式与层级不匹配则会自动纠正。
- 当标题名称包含“步骤/流程/要点/节点”等关键词时，紧随的编号列表会自动提升为下一级标题。
- 编号列表允许无空格写法，例如 `1.内容`、`2)内容`、`3、内容`。
- 正文不要手动硬换行，连续文本行会自动合并；空行代表新段落。
- 需要强制换行时在行末使用 `<br>`、`\\` 或两个空格。

## 版式规范（内置对齐）
- 纸张：A4。
- 页边距：上 37mm、下 35mm、左 28mm、右 26mm。
- 正文：仿宋GB2312 三号，首行左空二字，行距固定 28.9 磅。
- 标题：2号方正小标宋简体，居中。
- 一级标题：黑体三号；二级标题：楷体GB2312三号；三级/四级标题：仿宋GB2312三号；标题首行缩进与正文一致。
- 数字：默认 Times New Roman。

## 版头要素（可选，置于标题之前）
使用“键：值”单行写法，转换器会识别并排版：
- `份号：000001`
- `密级：xx★xx年`
- `紧急程度：xx`
- `发文机关标志：xxx文件`
- `发文字号：xx发〔2026〕6号`
- `签发人：张三`

说明：版头要素可选，缺省时不会自动插入红线。

红色分隔线触发条件：
- 当检测到版头要素且首次出现主标题时，会在主标题前插入一条红色分隔线（仅一次）。
- 文本中出现 `---`（或 `***`/`___`）会插入红线。
- 若使用 `--reference-doc` 自定义模板或 `--use-pandoc`，模板内的页眉/分隔线也可能导致“每页顶部有红线”。如遇此情况，请检查模板或移除多余分隔线。

## 主体结构建议（均为可选要素）
- 主送机关：以 `主送：` 行表示（顶格，不缩进）。
- 正文段落：保持自然段落即可，首行会自动缩进。
- 附件说明：使用 `附件：` 行。
- 落款与日期：用 `落款：` 开启右对齐块，后续非空行将右对齐直到空行。
- 抄送机关与印发：使用 `抄送：` / `印发：` 行。

## 表格
使用标准 Markdown 表格语法，转换器会生成真正的 Word 表格：
```
| 项目 | 说明 |
| --- | --- |
| 事项A | 内容A |
| 事项B | 内容B |
```

## 引用上标
- 文内引用使用 `[数字]` 形式，例如 `...实现开放式探索[21]`。
- 多个引用请写成连续形式，例如 `[2][3][5]`，不要写成 `[2,3]`。
- 参考文献列表统一放在 `## 参考文献` 标题之后，保持行首 `[数字]` 格式；转换器会自动将正文中的 `[数字]` 转为上标，并跳过参考文献列表。
- 参考文献每条占一行即可，脚本会自动补充段落间距，无需手工插入空行。

## 最小示例
```
# 关于开展年度检查的通知

主送：各业务部门：

## 正文
为规范管理，现开展年度检查，具体要求如下：
- 检查时间：2026年3月1日至2026年3月15日
- 检查范围：全体业务部门

附件：1. 年度检查清单

落款：
XX单位
2026年2月10日
```

## 转换脚本
脚本位置：`scripts/convert_markdown_to_docx.py`

基础用法：
```
python3 scripts/convert_markdown_to_docx.py draft.md --output draft.docx
```

## 一键生成含图 DOCX（推荐）
将 Markdown 与图片放好后，直接执行一次脚本即可生成“嵌图 + 版式修正”的 DOCX：
```
python3 scripts/convert_markdown_to_docx.py draft.md --output draft.docx --use-pandoc
```

说明：
- 需要安装 `pypandoc`，并确保 `pandoc` 可用（Windows/Linux 均可，PATH 或 `--pandoc` 均可）。
- Markdown 中的 SVG 会自动高分辨率转 PNG 并嵌入（默认 300 DPI）。
- 脚本会自动执行图片段落修正，避免固定行距导致的遮挡。
- 其他参数可运行 `python scripts/convert_markdown_to_docx.py --help` 查看。

## 常用参数（内置转换脚本）
以下参数用于 `convert_markdown_to_docx.py`：
- `--font`：正文字体（默认 `仿宋GB2312`）
- `--font-size`：正文字号（默认 `16`）
- `--title-font`：标题字体（默认 `方正小标宋简体`）
- `--title-size`：标题字号（默认 `22`）
- `--heading1-font`：一级标题字体（默认 `黑体`）
- `--heading2-font`：二级标题字体（默认 `楷体GB2312`）
- `--heading3-font`：三级标题字体（默认 `仿宋GB2312`）
- `--heading4-font`：四级标题字体（默认 `仿宋GB2312`）
- `--heading-size`：标题字号（默认 `16`）
- `--digit-font`：数字字体（默认 `Times New Roman`）
- `--line-spacing-pt`：固定行距（默认 `28.9`）
- `--chars-per-line`：字符网格宽度（默认 `28`）
- `--no-doc-grid`：关闭字符网格
- `--no-page-number`：不插入页码
- `--page-number-font`：页码字体（默认 `宋体`）
- `--page-number-size`：页码字号（默认 `14`）
- `--use-pandoc`：使用 pandoc 转换（默认内置转换器）
- `--pandoc`：pandoc 可执行文件路径（默认自动从 PATH 查找）
- `--image-width`：图片默认宽度（默认 `15.6cm`，可留空关闭）
- `--svg-dpi`：SVG 转 PNG 的 DPI（默认 `300`）
- `--svg-width-px`：SVG 转 PNG 的宽度（像素，优先级高于 `--image-width`）
- `--allow-missing-images`：允许图片缺失（pandoc 将跳过缺失图片）
- `--resource-path`：额外资源路径根目录（可重复传入）
- `--reference-doc`：自定义参考模板 `.docx`

## 注意事项
- 多行标题的“梯形/菱形”排列需在 Word 中微调。
- 若字体未安装，Word 会自动替换字体；在 Docker 环境需先安装字体。
- 严格版记位置、双面印刷与装订要求需在排版阶段最终校对。

## 质量检查
- 标题是否居中，版头要素是否完整。
- 主送/落款/日期是否位置正确。
- 行距、字号、页边距是否符合规范。
- 最终交付建议导出 PDF 复核。
